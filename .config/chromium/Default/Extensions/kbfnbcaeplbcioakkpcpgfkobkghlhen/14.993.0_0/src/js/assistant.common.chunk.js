(window.webpackChunk=window.webpackChunk||[]).push([[721],{39318:(e,t,i)=>{var s=i(66020),a="chrome-extension://__MSG_@@extension_id__/",r="moz-extension://__MSG_@@extension_id__/",n=window.GR_RESOURCE_ROOT||a,o=window.GR_RESOURCE_ROOT||r;e.exports={__css:s.toString().replace(new RegExp(a,"g"),n).replace(new RegExp(r,"g"),o),...s.locals}},26479:(e,t,i)=>{var s=i(66740),a="chrome-extension://__MSG_@@extension_id__/",r="moz-extension://__MSG_@@extension_id__/",n=window.GR_RESOURCE_ROOT||a,o=window.GR_RESOURCE_ROOT||r;e.exports={__css:s.toString().replace(new RegExp(a,"g"),n).replace(new RegExp(r,"g"),o),...s.locals}},83765:(e,t,i)=>{var s=i(55271),a="chrome-extension://__MSG_@@extension_id__/",r="moz-extension://__MSG_@@extension_id__/",n=window.GR_RESOURCE_ROOT||a,o=window.GR_RESOURCE_ROOT||r;e.exports={__css:s.toString().replace(new RegExp(a,"g"),n).replace(new RegExp(r,"g"),o),...s.locals}},65669:(e,t,i)=>{var s=i(20532),a="chrome-extension://__MSG_@@extension_id__/",r="moz-extension://__MSG_@@extension_id__/",n=window.GR_RESOURCE_ROOT||a,o=window.GR_RESOURCE_ROOT||r;e.exports={__css:s.toString().replace(new RegExp(a,"g"),n).replace(new RegExp(r,"g"),o),...s.locals}},57108:(e,t,i)=>{var s=i(80111),a="chrome-extension://__MSG_@@extension_id__/",r="moz-extension://__MSG_@@extension_id__/",n=window.GR_RESOURCE_ROOT||a,o=window.GR_RESOURCE_ROOT||r;e.exports={__css:s.toString().replace(new RegExp(a,"g"),n).replace(new RegExp(r,"g"),o),...s.locals}},20271:(e,t,i)=>{"use strict";i.d(t,{O:()=>s,I:()=>c});var s,a=i(27378),r=i(79844),n=i(57175),o=i(87088),l=i(35407);!function(e){e.Context=a.createContext(n.S.invariantContent("AssistantTextResources")),e.holder=o.asks((()=>({setGoalsTooltip:"Set goals to get tailored writing suggestions",proofitTooltip:"Expert writing help"})))}(s||(s={}));const c=l.P(l.G({denali:r.m.holder,assistant:s.holder}))((()=>({denali:{}})))},89822:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AssistantController:()=>mn,AssistantControllerInjectedParams:()=>s.AssistantControllerInjectedParams,AssistantService:()=>io,AssistantServiceInjectedParams:()=>a.AssistantServiceInjectedParams,LocalAssistantHighlightCollection:()=>n,getAssistantRPCClient:()=>so});var s={};i.r(s),i.d(s,{e:()=>mn});var a={};i.r(a),i.d(a,{e:()=>io});var r=i(41186);class n{constructor(e,t){this._textObserver=e,this._highlights=t}addHighlight(e,t,i){return this._highlights.addHighlight(e,t,this._textObserver.getCurrentTextMap(),i)}updateHighlight(e,t,i){return this._highlights.updateHighlight(e,t,this._textObserver.getCurrentTextMap(),i)}removeHighlights(e){return this._highlights.removeHighlights(e)}recalculateHighlight(e){return this._highlights.recalculateHighlight(e)}recalculateAllHighlights(){return this._highlights.recalculateAllHighlights()}maintainConsistency(e,t=(e=>e),i=!1){return this._highlights.maintainConsistency(e,this._textObserver.getCurrentTextMap(),t,i)}hasHighlight(e){return this._highlights.hasHighlight(e)}getSelectedHighlightsTracker(e){return(0,r.H)({...e,highlights:this._highlights,textObserver:this._textObserver})}getGeometryByHighlightId(e){return this._highlights.geometry.get().get(e)}}var o=i(73805),l=i(27378),c=i(32952),d=i(76974),p=i(49708),h=i(66310),m=i(93508),u=i(41398),g=i(77176),f=i(2768),_=i(2834),v=i(16118),w=i(85985),y=i(74850),E=i(85904),C=i(46861),b=i(79921),S=i(19217);const k=({message:e,emoji:t,icon:i})=>l.createElement("div",{className:S.insight},t&&l.createElement("div",{className:S.insight__inline_icon},l.createElement(b.dy,{unicodeHexArray:null,unicodeLiteral:t})),i&&l.createElement("div",{className:S.insight__inline_icon},i),l.createElement("div",{className:S.insight__inline_text},e));var x=i(53112);const M=()=>l.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16Z",fill:x.Z.green50}),l.createElement("path",{d:"M5.03033 8.46967C4.73744 8.17678 4.26256 8.17678 3.96967 8.46967C3.67678 8.76256 3.67678 9.23744 3.96967 9.53033L5.03033 8.46967ZM7 11.5L6.46967 12.0303L7 12.5607L7.53033 12.0303L7 11.5ZM13.0303 6.53033C13.3232 6.23744 13.3232 5.76256 13.0303 5.46967C12.7374 5.17678 12.2626 5.17678 11.9697 5.46967L13.0303 6.53033ZM3.96967 9.53033L6.46967 12.0303L7.53033 10.9697L5.03033 8.46967L3.96967 9.53033ZM7.53033 12.0303L13.0303 6.53033L11.9697 5.46967L6.46967 10.9697L7.53033 12.0303Z",fill:x.Z.neutral0})),A=()=>l.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16Z",fill:x.Z.red50}),l.createElement("path",{d:"M8.94827 4H7.05196L7.22242 10.1108H8.78208L8.94827 4ZM8.00225 12.8381C8.5477 12.8381 9.02071 12.3821 9.02498 11.8153C9.02071 11.2571 8.5477 10.8011 8.00225 10.8011C7.43975 10.8011 6.97526 11.2571 6.97952 11.8153C6.97526 12.3821 7.43975 12.8381 8.00225 12.8381Z",fill:x.Z.neutral0}));var L,I=i(67584),T=i(88326),R=i(45836),F=i(51465),V=i(18208),P=i(42726),O=i(98029);!function(e){e.hidden="hidden",e.zero="zero",e.visible="visible"}(L||(L={}));const H=({predictionsVM:e})=>F.UI.mount(G,e.previewFlow),N=F.UI.Grid.make((({slots:e})=>l.createElement("div",{className:O.predictions},l.createElement("div",{className:O.predictions__header},"Predictions"),e.children))),U=({children:e,count:t,countFormatter:i=(e=>String(e)),dataPartGrammarly:s})=>l.createElement(P.F.div,{className:O.predictions__card,"data-grammarly-part":s},e,t>0&&l.createElement("div",{className:O.counterContainer},l.createElement(R.CL,null,i(t)))),B=F.UI.Node.make((({state:e,notify:t})=>l.createElement(T.M,{clickHandler:t("select")},l.createElement(P.F.Fragment,null,e.pipe(g.U((e=>l.createElement(U,{count:e.alertsCount,countFormatter:e=>`+${e} more`,dataPartGrammarly:"emogenie-prediction-card"},l.createElement(k,{key:"tone",message:"Sounds "+e.emotion.name,emoji:e.emotion.emoji}),e.brandToneOffImageUrl?l.createElement("div",{className:O.predictions__emogenie_pulsing},l.createElement(I.e,{pulsing:P.hg.create(!0)})):null)))))))),D=F.UI.Node.make((({state:e,notify:t})=>l.createElement(T.M,{clickHandler:t("select")},l.createElement(P.F.Fragment,null,e.pipe(g.U((e=>l.createElement(U,{count:e.alertsCount,dataPartGrammarly:"readers-attention-prediction-card"},l.createElement(k,{key:"readersAttention",message:V.kC(e.message),icon:e.easyToRead?l.createElement(M,null):l.createElement(A,null)}))))))))),q=F.UI.Group.make({tone:Z(B),readersAttention:Z(D)}),G=F.UI.Union.make("kind",{[L.hidden]:F.UI.Node.empty,[L.zero]:F.UI.Node.empty,[L.visible]:F.UI.Composite.make(N,q)});function Z(e){return{tag:"_tag",members:{Some:(0,o.pipe)(e,F.UI.contramapState((e=>e.value))),None:F.UI.Node.empty}}}var z,W=i(45980),j=i(8824),X=i(60997),Y=i(48869),Q=i(89881),K=i(62712),$=i(38524),J=i(55415),ee=i(64909),te=i(23124),ie=i(22788);!function(e){function t(e,t,i){return $.nL.Items.mapper((e=>e.kind),{[Q.h.alertCard]:e,[Q.h.priorityToggle]:t,[Q.h.bulkAccept]:i})}function i(e){return t((t=>({view:t,isLastCard:e,kind:"alertCard"})),(e=>({view:e,kind:"priorityToggle"})),(e=>({view:e,kind:"bulkAccept"})))}e.checksFeedItemsMapper=t,e.view=e=>F.UI.Union.make("kind",{alertCard:j.p.Card(e),priorityToggle:Y.e.PriorityToggle(e),bulkAccept:X.o.BulkAccept(e)}),e.viewState=function(){return{viewState:({activeCard:e,isLastItem:t,ord:s})=>a=>{const r=(0,o.pipe)(e,ee.exists((e=>e===a.id)));return{cell:{item:i(t)(a),root:{height:{value:a.positionState.height,watched:a.positionState.watched&&!a.scheduledToDispose,isValid:a.positionState.isHeightValid},position:{top:a.positionState.absTop,animationInProgress:a.positionState.animationInProgress},layer:r||a.visualState.incomplete&&!(0,o.pipe)(a.visualState.from,ee.exists((e=>"focused"===e)))?te.H.Layer.front:te.H.Layer.back}},root:a.id,hashCode:a.hashCode.bind(a),equals:e=>a.equals(e.cell.item.view),compare:e=>s.compare(a,e.cell.item.view)}}}},e.listItemOrd=e=>(0,ie.contramap)((e=>e.cell.item.view))(e).compare,e.changePosition=function(e){return{changePosition:i=>t((t=>e.changePosition(t,i)),(e=>J.Vx(e,{positionState:i})),(e=>K.J.changePosition(e)(i)))}},e.transitionTo=function(e){return{transitionTo:i=>t((t=>e.transitionTo(t,i)),W.identity,(e=>K.J.transitionTo(e,i)))}},e.completeTransition=function(e){return{completeTransition:i=>t((t=>e.completeTransition(t,i)),W.identity,(e=>K.J.completeTransition(e,i)))}},e.select=function(e){return{select:({alertHighlight:i,previousCard:s,ord:a,meta:r})=>t((t=>e.select(t,i,(0,W.unsafeCoerce)(s),a,(0,o.pipe)(r,ee.map((e=>()=>e)),ee.toUndefined))),W.identity,(e=>K.J.select(e,s))),unselect:({nextCard:i,ord:s})=>t((t=>e.unselect(t,(0,W.unsafeCoerce)(i),s)),W.identity,(e=>K.J.unselect(e,i)))}}}(z||(z={}));var se=i(2027),ae=i(5304),re=i(81766),ne=i(52479),oe=i(66265),le=i(16528),ce=i(99391),de=i(2844),pe=i(24209),he=i(18625),me=i(40151),ue=i(95093),ge=i(24713),fe=i(17343),_e=i(78090),ve=i(32917),we=i(71517),ye=i(13338),Ee=i(90600),Ce=i(19962),be=i(92932),Se=i(47476);const ke=F.UI.Grid.make((({slots:e,view:t})=>l.createElement(P.F.div,{className:t("isBundle").pipe(g.U((e=>e?Se.bundleCardWrapper:Se.cardWrapper)))},e.children))),xe=l.forwardRef((({state:e,cardsViewModel:t,cardsListScrollManager:i,connectorElements:s,header:a,footer:r,cardsListFlow:n},p)=>{const h=ne.jw((e=>{let t=7;return t=31*t+(0,_e.AC)(e.currentLens.id),t=31*t+($.nL.hasCards(e)?1231:1237),t}),e).view((e=>$.nL.hasCards(e.get())?e.view($.nL.Prism.getLens()):null)),u=(0,o.pipe)(ae.A.cardList(z.view(t.actionEvents)),F.UI.patch("content","cell","item")((e=>(0,o.pipe)(F.UI.Knot.make(ke,{children:e.child}),F.UI.squash,F.UI.contramapState((e=>({children:e,root:{isBundle:"alertCard"===e.kind&&ee.isSome(e.view.meta.bundleInfo)}}))))))),g=l.useContext(se.Dg).state;return l.createElement(Ee.d,{className:d.of(""),name:"cardlist",stateSyncListener:Ae(i,s,g),height:Me(e,i),isMaster:!0},l.createElement(l.Fragment,null,a?l.createElement(P.F.div,{className:Se.cardWrapper,mount:e=>s.lens("title").set(ee.fromNullable(e))},a):null,l.createElement(P.F.div,{mount:p},h.view((e=>e?F.UI.mount(u,(e=>n||(0,re._F)(t,e,new c.xQ,ve.i$(i).pipe(m.O(!1)),z.viewState(),z.listItemOrd))(e)):null))),r?l.createElement(P.F.div,{className:Se.cardWrapper},r):null))})),Me=(e,t)=>{const i=(0,ye.Sd)(e.view($.nL.mapper((({currentLens:e,alertSource:t})=>ee.some({currentLens:e,alertSource:t})))));return de.aj([i.pipe(oe.oA,g.U((({currentLens:e})=>e.cardsHeight)),m.O(0)),t.paddingTop]).pipe(g.U((([e,t])=>e+t)))},Ae=(e,t,i)=>{const s=be.C8.Logging.getLogger("view_models");return pe.T(he.P((()=>{e.paddingTop.set(0)})),t.view("viewport").pipe(h.w(ee.fold(me.c,(e=>le.YC(e).pipe(_.b((()=>s.debug("update card list viewport due to viewport resize event"))),ue.T(i.pipe(ge.j("dragging"),w.h((e=>!e)),h.w(ne.b2.rafScheduler),_.b((()=>s.debug("update card list viewport due to drag end event"))))),g.U((()=>e.getBoundingClientRect())),g.U((e=>({top:we.r.FromWindowTop.ISO.wrap(e.top),height:e.height}))))))),_.b(ne.wW(e.viewport))),t.view("scrollProvider").pipe(h.w(ee.fold(me.c,(t=>p.R(t,"scroll").pipe(g.U((()=>t.scrollTop)),m.O(t.scrollTop),_.b(ne.wW(e.scrollTop)),fe.h(ne.PU)))))),t.view("title").pipe(h.w(ee.fold((()=>d.of(Ce.UL.empty)),(e=>le.YC(e)))),g.U((e=>e.height)),ce.shareReplay({bufferSize:1,refCount:!0}),_.b(ne.wW(e.paddingTop))),t.view("scrollConsumer").pipe(h.w(ee.fold(me.c,(t=>e.scrollOffset.pipe(_.b((e=>{t.scrollTop+=e})))))))).pipe(fe.h(void 0))};var Le,Ie=i(22902),Te=i(65421),Re=i(39354),Fe=i(10002),Ve=i(17753),Pe=i(69551),Oe=i(76779),He=i(8125),Ne=i(95574),Ue=i(65772);!function(e){let t;!function(e){e.gdocsSidebarCardList="gdocsSidebarCardList",e.gdocsSidebarSuccessView="gdocsSidebarSuccessView",e.gdocsGoals="gdocsGoals",e.assistantCardList="assistantCardList",e.extensionSettingsAssistant="extensionSettingsAssistant"}(t=e.Place||(e.Place={}))}(Le||(Le={}));class Be{constructor(e,t,i){this._alertsList=e,this._lensPreviewVM=t,this._maxAlertCategories=i,this._log=be.C8.Logging.getLogger("UpgradeViewModel"),this.advancedAlerts=this._lensPreviewVM.getLens(Fe.R.SpecialId.Premium).view("count").view((e=>e>0?(0,o.pipe)(ee.some({count:e,alerts:()=>this._formatLiteAlerts(this.getAdvancedGroupedLiteAlerts())})):ee.none)),this._formatLiteAlerts=e=>{const t=e.slice(0,this._maxAlertCategories),i=e.slice(this._maxAlertCategories).map((e=>e.count)).reduce(He.Sm,0);return i>0?[...t,{group:"",category:"",categoryHuman:"more...",count:i}]:t},this.getAdvancedGroupedLiteAlerts=()=>this._getGroupedLiteAlerts(Ve.bZ.isPremium),this._getAdvancedLiteAlerts=()=>(0,o.pipe)(this._alertsList.state.get(),Oe.p.reduce([],((e,{alert:t})=>(Ve.bZ.isRegistered(t)&&e.push(t),e)))).filter(Ve.bZ.isPremium).map((e=>(0,Te.fe)(this._toRawAlertWithPossibleWrongId(e),"sidebar"))),this._toRawAlertWithPossibleWrongId=e=>({...e.toRawAlert(),id:(0,o.pipe)(e.rawId,ee.getOrElse((()=>e.id)))})}openUpgradeUrl(e){(0,o.pipe)(Ne.vM((()=>{(0,Re.P4)().openSubscriptionDialog({currentAlerts:this._getAdvancedLiteAlerts(),isAnonymousUser:!1,showPlanComparison:!0,isFromEmail:!1,forceUtmCampaign:e})})),Ue.getOrElse((e=>this._log.fatal("unexpected error on open upgrade page",e))))}_getGroupedLiteAlerts(e){return Pe.Q.group((0,o.pipe)(this._alertsList.state.get(),Oe.p.reduce([],((e,{alert:t})=>(Ve.bZ.isRegistered(t)&&e.push(t),e)))).filter(e).map((e=>e.toLiteAlert())))}}var De,qe=i(90361),Ge=i(45442),Ze=i(79126),ze=i(79176),We=i(73510),je=i(95300),Xe=i(28043),Ye=i(16782),Qe=i(78674),Ke=i(57091),$e=i(50628),Je=i(15228);!function(e){let t;!function(e){e.clickOnEmpty="clickOnEmpty",e.clickOnFakeCard="clickOnFakeCard"}(t=e.Type||(e.Type={}))}(De||(De={}));class et{constructor(e,t,i,s){this._lensState=e,this._predictionsVM=t,this._upgradeViewModel=i,this._gnar=s,this._subs=new We.w.Keeper,this.successView=P.hg.combine(this._lensState,this._predictionsVM.previewState,((e,t)=>$.nL.isInSuccess(e)?ee.some(t.kind===L.visible?Je.g.SuccessType.applied:Je.g.SuccessType.small):ee.none)),this._premiumAlertsCount=this._upgradeViewModel.advancedAlerts.view((0,W.flow)(ee.map((e=>e.count)),ee.getOrElse((()=>0)))),this.havePremiumAlerts=this._premiumAlertsCount.view((e=>e>0)),this._upgradeHookExpanded=new je.X(!1),this.upgradeHookExpanded=(0,o.pipe)(this._upgradeHookExpanded,Xe.x()),this.upgradeHookFlow=(0,o.pipe)((0,Ze.Q)(this._upgradeViewModel.advancedAlerts),Ge.Z.extendActions(_.b((e=>{e.key===ze.n.State.expanded?"upgrade"===e.action.kind?(this._upgradeViewModel.openUpgradeUrl(Le.Place.assistantCardList),this._gnar.assistantExpandedUpgradeHookClick(this._premiumAlertsCount.get())):"onUpgradeButtonMount"===e.action.kind&&this._onUpgradeButtonMount.next(e.action.element):e.key===ze.n.State.minimized&&"onClick"===e.action.action&&this._upgradeHookExpandReason.next("click")}))),Ge.Z.patchState(ue.T(this._autoOpenUpgradeHook())),Ge.Z.patchState(_.b((e=>this._onUpgradeHookShown.next(function(e){switch(e){case"hidden":return ze.n.State.hidden;case"expanded":return ze.n.State.expanded;case"minimized":return ze.n.State.minimized;default:(0,qe.vE)(e)}}(e.kind))))),Ge.Z.patchState(_.b((e=>this._upgradeHookExpanded.next("expanded"===e.kind))))),this.cardListContext=new je.X(ee.none),this.assistantActions=new c.xQ,this.autoFocusEnabled=P.hg.create(!0),this._onUpgradeButtonMount=new Ye.t,this._upgradeHookExpandReason=new Ye.t,this._onUpgradeHookShown=new c.xQ,this._unselectActiveAlert=this.assistantActions.pipe(w.h((e=>e.type===De.Type.clickOnEmpty||e.type===De.Type.clickOnFakeCard)),_.b((()=>this.autoFocusEnabled.set(!1))),g.U((()=>e=>e.patch({currentLens:(0,o.pipe)($.In.getActiveItem(e.currentLens),ee.fold((()=>e.currentLens),(t=>e.currentLens.unselect()))),switchOrder:"lensOrder",alertSource:Ve.l$.sidebar})))),this.applicatorEffects={id:"assistantCardListViewModel.effects",when:Fe.R.isWithAlertsId,what:$.nL.Effect.Applicator.create(pe.T(this._unselectActiveAlert))},this._subs.push(this._onUpgradeHookShown.pipe(Qe.b(1),Xe.x(),w.h((e=>e===ze.n.State.minimized))).subscribe((()=>this._gnar.assistantCollapsedUpgradeHookShow())),this._onUpgradeButtonMount.pipe(oe.oA,Ke.a(this.cardListContext.pipe(oe.oA,$e.P())),h.w((([e,t])=>le.n(e,{root:t}).pipe($e.P()))),w.h(He.Dw),g.U((e=>Math.trunc(100*e[0].intersectionRatio))),u.M(this._upgradeHookExpandReason,this._premiumAlertsCount)).subscribe((([e,t,i])=>this._gnar.assistantExpandedUpgradeHookShow(i,t,e))),this._lensState.pipe(w.h($.nL.hasCards),g.U((e=>$.In.getActiveItem(e.currentLens))),v.G(),w.h((([e,t])=>ee.isNone(e)&&ee.isSome(t)))).subscribe((e=>{this.autoFocusEnabled.set(!0)})))}dispose(){this._subs.dispose()}_autoOpenUpgradeHook(){return this._lensState.pipe(w.h((e=>(0,o.pipe)(e.currentLens.id,(0,He.Kg)(Fe.R.isPriority,Fe.R.isAllAlerts)))),g.U($.nL.isInSuccess),Ke.a(this.havePremiumAlerts,((e,t)=>e&&t)),Xe.x(),_.b((e=>{e&&this._upgradeHookExpandReason.next("alertsAddressed")})),u.M(this._upgradeViewModel.advancedAlerts),g.U((([e,t])=>(0,o.pipe)(t,ee.fold((()=>({kind:ze.n.State.hidden})),(t=>e?{kind:ze.n.State.expanded,showCloseButton:!0,alertsState:{count:t.count,alerts:t.alerts()}}:{kind:ze.n.State.minimized,alertsCount:t.count}))))))}}var tt=i(75003);class it{constructor(e,t,i){this._assistantLayoutViewModel=e,this._domain=t,this._gnar=i,this._caller=this._assistantLayoutViewModel.activeView.get()}getDomain(){return this._domain}openFeedback(){this._caller=this._assistantLayoutViewModel.activeView.get(),this._gnar.assistantFeedbackButtonClick(st(this._caller)),this._assistantLayoutViewModel.pushActiveView({type:tt.aH.Type.feedback})}submitFeedback(e){this._gnar.assistantFeedbackSubmitButtonClick(st(this._caller),e.score,e.domain,e.text)}}function st(e){switch(e.type){case tt.aH.Type.readersAttention:return"readers_attention";case tt.aH.Type.settings:return"settings";default:(0,qe.vE)(e.type)}}var at,rt=i(80900),nt=i(5817),ot=i(79961);!function(e){let t;!function(e){e.HIDE=nt.m9(.15),e.THANK=nt.m9(3)}(t=e.WaitTime||(e.WaitTime={})),e.THANK_YOU_ICON_UNICODE="1f64c",e.defaultState={isExpanded:!1,isHidden:!1,voteValue:null}}(at||(at={}));class lt{constructor(e,t){this._model=e,this._gnar=t,this._subs=[],this._state=P.hg.create(at.defaultState),this._shownLabels=[],this._cardLookedIds=[],this.onCardShow=e=>{this._model.onFeedback(ot.l.Intent.FeedbackType.INTENT_ALERT,e.id),this._gnar.intentShow(e.id,e.label)},this.onCardExpanded=e=>this._gnar.intentCardExpanded(e.id,e.label),this.onMiniCardClick=e=>{this._state.lens("isExpanded").set(!0),this._onCardLook(e.id)},this.onVote=(e,t)=>{this._shownLabels.push(e.label),this._state.lens("voteValue").set(t),t===ot.l.Intent.FeedbackType.INTENT_ACCEPTED?(this._subs.push((0,rt.H)(at.WaitTime.THANK).subscribe((()=>this.onHide()))),this._gnar.intentYesButtonClick(e.id,e.label)):(this.onHide(!1),this._gnar.intentNoButtonClick(e.id,e.label)),this._onCardLook(e.id),this._model.onFeedback(t,e.id)},this.onHide=(e=!0)=>{this._state.lens("isHidden").set(!0),this.unsubscribe(),this._subs.push((0,rt.H)(at.WaitTime.HIDE).subscribe((()=>{e?this._model.onHideAllIntent():this._model.onHideTopIntent(),this._state.set(at.defaultState),this.unsubscribe()})))},this.unsubscribe=()=>{this._subs.forEach((e=>e.unsubscribe())),this._subs=[]}}_onCardLook(e){this._cardLookedIds.includes(e)||(this._cardLookedIds.push(e),this._model.onFeedback(ot.l.Intent.FeedbackType.INTENT_LOOKED,e))}get _intentState(){return this._model.intent.view((e=>{if(!e)return null;const[t]=e.aggregated.filter((e=>!this._shownLabels.includes(e.prediction.label)));return t?{unicode:t.prediction.bundle.title_icon_id,title:t.prediction.bundle.title,label:t.prediction.label,id:t.id}:null}))}get haveIntent(){return this._intentState.view((e=>null!==e))}get state(){return P.hg.combine(this._state,this._intentState,((e,t)=>({...e,intent:t})))}}var ct,dt,pt=i(26001),ht=i(41552),mt=i(93162),ut=i(22232),gt=i(83078);!function(e){e.equals=(e,t)=>"score"in e&&"score"in t?e.score===t.score:e.type===t.type}(ct||(ct={}));class ft{constructor(e,t,i,s,a,r,n,l,c,d,p,h){this._sessionModel=e,this._layoutVM=t,this._predictionsVM=i,this._importanceSurveyVM=s,this._modalManager=a,this._lensPreviewVM=r,this._currentLensId=n,this._lensChanged=l,this._cardsListScrollManager=c,this._user=d,this._gnar=p,this._closeAssistant=h,this.showSetGoalsActionButton=P.hg.create(!0),this.showSettingsActionButton=P.hg.create(!0),this.close=()=>{const e=this._layoutVM.activeView.get();e.type===tt.aH.Type.popup&&e.popupType===tt.aH.PopupType.importanceSurvey?this._importanceSurveyVM.dismiss():this._closeAssistant()},this.score=(0,o.pipe)(this._sessionModel.score.view(ee.map((e=>e.rank))),g.U((e=>(0,pt.Yt)(ee.option)({capiScore:e}))),Ke.a(this._sessionModel.checkingState,((e,t)=>(0,o.pipe)(e,ee.map((e=>({...e,isLoading:"idle"!==t}))))))),this.summary=this._sessionModel.textInfo.view((0,W.flow)(ee.chain((e=>e.messages)),ee.map((e=>e.assistantHeader)),ee.getOrElse((()=>"Looking good so far")),(e=>({content:e})))),this.logoScore=(0,de.aj)([this._cardsListScrollManager.scrollTop,this._layoutVM.activeView,this.score]).pipe(g.U((([e,t,i])=>(0,o.pipe)(i,ee.fold((()=>({type:"logo"})),(i=>e<66||t.type!==tt.aH.Type.default?{type:"logo"}:{type:"score",score:i}))))),Xe.x(ct.equals)),this.visibility=this._layoutVM.activeView.view((e=>e.type===tt.aH.Type.default?"visible":"hidden")),this.lensSwitchFlow=Ge.Z.fromSideEffect((e=>{switch(e.action.action){case mt.n.Actions.switchToAll:this._lensChanged.next({lensId:Fe.R.SpecialId.AllAlerts,focusFirstCard:!0}),this._gnar.assistantPriorityDropdownClick("all");break;case mt.n.Actions.switchToPriority:this._lensChanged.next({lensId:Fe.R.SpecialId.Priority,focusFirstCard:!0}),this._gnar.assistantPriorityDropdownClick("priority");break;case mt.n.Actions.openSetGoals:break;default:(0,ut.vE)(e.action.action)}}),de.aj(this._currentLensId.pipe(w.h((e=>e!==Fe.R.SpecialId.Premium)),g.U((e=>e===Fe.R.SpecialId.Priority?"priority":"all")),Xe.x()),this._lensPreviewVM.getLens(Fe.R.SpecialId.AllAlerts).pipe(ge.j("count"),Xe.x()),this._lensPreviewVM.getLens(Fe.R.SpecialId.Priority).pipe(ge.j("count"),Xe.x()),this._predictionsVM.previewState,((e,t,i,s)=>(0,o.pipe)({allAlertsCount:t,priorityAlertsCount:i,selectedLens:e},ee.fromPredicate((()=>s.kind!==L.hidden)))))),this._subs=new We.w.Keeper,this._trackHeaderMessageChanges(),this._trackToShowActionButtons()}open(e){switch(e){case"setGoals":this._subs.push(this._modalManager.show(ht.Iy.setGoals("user")).subscribe());break;default:(0,ut.vE)(e)}}_trackHeaderMessageChanges(){const e=this.summary.pipe(v.G()).subscribe((([e,t])=>{var i,s;this._gnar.assistantHeaderMessageUpdate(e.content,t.content,null===(i=(0,o.pipe)(this._sessionModel.textInfo.get(),ee.toUndefined))||void 0===i?void 0:i.wordsCount,null===(s=(0,o.pipe)(this._sessionModel.score.get(),gt.Fc))||void 0===s?void 0:s.rank)}));this._subs.push(e)}_trackToShowActionButtons(){const e=(0,de.aj)([this._layoutVM.activeView,this._user]).subscribe((([e,t])=>{t.isAnonymous||e.type===tt.aH.Type.popup?(this.showSetGoalsActionButton.set(!1),this.showSettingsActionButton.set(!1)):(this.showSetGoalsActionButton.set(!0),this.showSettingsActionButton.set(!0))}));this._subs.push(e)}dispose(){this._subs.dispose()}}!function(e){e.importance="importance",e.kindOfFeedback="kindOfFeedback",e.thankYou="thankYou"}(dt||(dt={}));class _t{constructor(e,t,i){this._closeAssistant=e,this._gnar=t,this._bgActions=i,this.hideBackButton=P.hg.create(!0),this.step=P.hg.create(dt.importance),this._onCompleteAllQuestions=()=>{this.step.set(dt.thankYou),this._bgActions.hideImportanceSurvey()},this.done=()=>{this._closeAssistant()},this.dismiss=()=>{this._closeAssistant(),this._bgActions.dismissImportanceSurvey()},this.submit=e=>{const t=this.step.get();switch(this._gnar.importanceSurveySubmitButtonClick(e,t),t){case dt.importance:"extremelyImportant"===e[0]||"somewhatImportant"===e[0]?this.step.set(dt.kindOfFeedback):this._onCompleteAllQuestions();break;case dt.kindOfFeedback:default:this._onCompleteAllQuestions()}}}}var vt=i(63919);const wt=e=>{const t=e.initialPositionOffset.get();return{initialPositionOffset:t,onDrag:i=>{e.updateInitialPositionOffset(vt.E9.plus(t,function({x:e,y:t}){return vt.E9.create({top:t,left:e})}(i.translate)))}}};class yt{constructor(e,t,i,s,a,r,n){this._lensPreviewVM=e,this._layoutVM=t,this._readersAttentionVM=i,this._emogenieService=s,this._session=a,this._readersAttentionPredictionCardState=r,this._gnar=n,this._subs=new We.w.Keeper,this.previewState=P.hg.create({kind:L.hidden}),this.previewFlow=Ge.Z.fromSideEffect((e=>{switch(e.action.key){case"tone":const t=this._emogenieService.viewState.view("prevalentEmotion").get();return t&&this._gnar.emogeniePredictionButtonClick(t.name),this._layoutVM.pushActiveView({type:tt.aH.Type.emogenie});case"readersAttention":return this._readersAttentionVM.open({type:tt.T5.Type.predictionWidget});default:(0,ut.vE)(e.action)}}),this.previewState),this._previewState=(0,o.pipe)(de.aj([this._emogenieService.viewState.view((e=>ee.fromNullable(e.settings.hiddenReport?void 0:e.prevalentEmotion))),this._emogenieService.viewState.view("brandToneOffImageUrl"),this._readersAttentionPredictionCardState,this._session.documentLength,this._lensPreviewVM.getLens(Fe.R.SpecialId.PredictionEmogenie),this._lensPreviewVM.getLens(Fe.R.SpecialId.PredictionTakeaways)]),g.U((([e,t,i,s,a,r])=>(ee.isSome(e)||ee.isSome(i))&&s.trimmed>0?{kind:L.visible,tone:(0,o.pipe)(e,ee.map((e=>({emotion:e,alertsCount:a.count,brandToneOffImageUrl:t})))),readersAttention:(0,o.pipe)(i,ee.map((e=>({...e,alertsCount:r.count}))))}:s.trimmed>0?{kind:L.zero}:{kind:L.hidden}))),this._subs.push(this._previewState.subscribe(ne.wW(this.previewState)))}dispose(){this._subs.dispose()}}var Et=i(77843),Ct=i(72923);class bt{constructor(e,t,i,s){this.feature=t,this._closeAssistant=i,this._gnar=s,this._subs=[],this._subs.push(this.feature.requestInfo.view("status").pipe((0,Xe.x)(),(0,v.G)(),(0,u.M)(e.activeView)).subscribe((([[t,i],s])=>{t===Ct.u.RequestStatus.REVIEWING&&s.type===tt.aH.Type.proofitReview&&e.popActiveView()}))),this._subs.push(this.feature.layoutCreated.pipe((0,u.M)(e.activeView)).subscribe((([t,i])=>{i.type!==tt.aH.Type.proofitRequest&&i.type!==tt.aH.Type.proofitReview||t||e.popActiveView()})))}onSubmitRequest(e){this.feature.submitRequest(),this._gnar.proofitRequestFormSubmit();const t=this.feature.requestInfo.lens("status").pipe((0,w.h)((e=>e===Ct.u.RequestStatus.ACCEPTED)));(0,Et.F)(100).pipe((0,f.R)(t)).subscribe({complete:()=>this._closeAssistant(e)})}onCompleteRequest(e){this.feature.resetRequest(),this._gnar.proofitOrderDone(),this._closeAssistant(e)}dispose(){this._subs.forEach((e=>e.unsubscribe()))}}var St,kt=i(489),xt=i(42654);!function(e){let t;!function(e){e.eq=xt.getStructEq({message:xt.eqString,checked:xt.eqBoolean})}(t=e.ChecklistItem||(e.ChecklistItem={}))}(St||(St={}));var Mt,At=i(14601);!function(e){e.eq=xt.getStructEq({collapsed:xt.eqBoolean,items:(0,kt.getEq)(St.ChecklistItem.eq)})}(Mt||(Mt={}));class Lt{constructor(e,t,i,s){this._readersAttentionFeature=e,this._assistantLayoutVM=t,this._onChecklistExpand=s,this._subs=new At.w,this._cardSelected=new je.X(!1),this._height=P.hg.create(ee.none),this._items=(0,o.pipe)(this._readersAttentionFeature,ee.map((e=>e.attentionInfo)),ee.getOrElse((()=>P.hg.create(ee.none)))).view((0,W.flow)(ee.map((e=>e.checklist)),ee.getOrElse((()=>[])))),this._state=P.hg.create({items:this._items.get(),collapsed:this._cardSelected.value}),this.state=this._state.pipe(Xe.x(((e,t)=>Mt.eq.equals(e,t)))),this.height=this._height.view(),this._subs.add(i.view($.nL.getActiveCard).subscribe((e=>{this._cardSelected.next(ee.isSome(e))}))),this._subs.add(this._cardSelected.subscribe((e=>this._state.lens("collapsed").set(e)))),this._subs.add(this._items.subscribe((e=>this._state.lens("items").set(e)))),this._subs.add(this._assistantLayoutVM.activeView.subscribe((e=>{e.type===tt.aH.Type.readersAttention&&this._height.set(ee.none)})))}expand(){this._state.lens("collapsed").set(!1),this._onChecklistExpand()}changeHeight(e){this._height.set(ee.some(e))}dispose(){this._subs.unsubscribe()}}class It{constructor(e){this._readersAttentionFeature=e,this.message=(0,o.pipe)(this._readersAttentionFeature,ee.map((e=>e.attentionInfo)),ee.getOrElse((()=>P.hg.create(ee.none)))).view((0,W.flow)(ee.map((e=>e.headerMessage)),ee.getOrElse((()=>""))))}}class Tt{constructor(e,t){this._readersAttentionFeature=e,this._assistantLayoutVM=t,this._subs=new At.w,this._viewCaller=ee.none,(0,o.pipe)(this._readersAttentionFeature,gt.bw((e=>{this._subs.add(this._assistantLayoutVM.activeView.subscribe((t=>{t.type===tt.aH.Type.readersAttention||t.type===tt.aH.Type.readersAttentionOnboarding?e.showHeatmap():e.hideHeatmap()})))})))}open(e){(0,o.pipe)(this._readersAttentionFeature,gt.bw((t=>{this._viewCaller=ee.some(e),this._assistantLayoutVM.pushActiveView(t.seenReadersAttentionOnboarding?{type:tt.aH.Type.readersAttention,caller:e}:{type:tt.aH.Type.readersAttentionOnboarding,caller:e})})))}getStarted(){(0,o.pipe)(this._readersAttentionFeature,gt.bw((e=>{e.markReadersAttentionOnboardingAsSeen()}))),this._assistantLayoutVM.replaceActiveView({type:tt.aH.Type.readersAttention,caller:(0,o.pipe)(this._viewCaller,ee.getOrElse((()=>({type:tt.T5.Type.navigation}))))})}showHelp(){this._assistantLayoutVM.pushActiveView({type:tt.aH.Type.readersAttentionOnboarding,caller:{type:tt.T5.Type.navigation}})}get showGetStarted(){const e=this._assistantLayoutVM.activeView.get();return e.type===tt.aH.Type.readersAttentionOnboarding&&e.caller.type!==tt.T5.Type.navigation}dispose(){(0,o.pipe)(this._readersAttentionFeature,gt.bw((e=>e.hideHeatmap()))),this._subs.unsubscribe()}}var Rt=i(38040);class Ft{constructor(e,t,i){this._contentScriptState=e,this._contentScriptActions=t,this.domain=i,this.state=this._contentScriptState.view((e=>({user:e.user,commonSettings:e.page}))),this.actions={toggleSite:(e,t)=>this._contentScriptActions.toggleSite(e,t,(0,Rt.IJ)(this.state.view("user").get())),toggleDefs:this._contentScriptActions.toggleDefs,toggleAutocomplete:this._contentScriptActions.toggleAutocomplete,toggleAutocorrect:this._contentScriptActions.toggleAutocorrect,toggleHotkeys:this._contentScriptActions.toggleHotkeys,changeStrongDialect:this._contentScriptActions.changeStrongDialect,disableLlama:this._contentScriptActions.disableLlama}}}var Vt=i(53073),Pt=i(59443),Ot=i(91224),Ht=i(38194),Nt=i(83401),Ut=i(598),Bt=i(45429),Dt=i(40644);class qt{constructor(e,t){this._cardPositions=e,this._markPositions=t,this._log=y.Y.create(qt.name)}alignCardToMark({id:e,renderOptions:{features:t},activeAlert:i,activeHighlightIndex:s},a){return he.P((()=>d.of(this._markPositions.getMarkAlertPosition({alert:i,highlightIndex:s})))).pipe(oe.oA,g.U((i=>(0,o.pipe)(this._cardPositions.getCardSuggestedPositionInViewport(e,t.has(Dt.X.RenderOptions.Features.showLabel),ee.some(i),"cardContentTop"),ee.fromEither))),oe.oA,h.w((i=>this._cardPositions.setCardPosition(e,t.has(Dt.X.RenderOptions.Features.showLabel),!0,i.top))),fe.h(ne.PU),Ot.K((e=>(this._log.error("Cannot align card to mark",e),me.c()))),Ht.B())}alignMarkTo(e,t,i,s){return he.P((()=>d.of((0,o.pipe)(this._cardPositions.getCardSuggestedPositionInViewport(e.id,!!Dt.X.isAlertCard(e)&&e.renderOptions.features.has(Dt.X.RenderOptions.Features.showLabel),ee.some(i),"cardContentTop"),ee.fromEither)).pipe(oe.oA))).pipe(h.w((i=>pe.T(this._markPositions.moveAlertHighlightInViewport(t,we.r.FromWindowTop.ISO.modify(we.L.concatC(i.contentOffset))(i.top),Pt.uq.initial),this._cardPositions.setCardPosition(e.id,!!Dt.X.isAlertCard(e)&&e.renderOptions.features.has(Dt.X.RenderOptions.Features.showLabel),!0,i.top)))),fe.h(ne.PU),Ot.K((e=>(this._log.error("Cannot align mark to suggested position",e),me.c()))),Ht.B())}alignMarkToCard({id:e,renderOptions:{features:t},activeHighlightIndex:i,activeAlert:s},a,r=ee.none){return he.P((()=>d.of((0,o.pipe)(this._cardPositions.getCardSuggestedPositionInViewport(e,t.has(Dt.X.RenderOptions.Features.showLabel),r,"cardContentTop"),ee.fromEither)).pipe(oe.oA))).pipe(h.w((a=>pe.T(this._markPositions.moveAlertHighlightInViewport({alert:s,highlightIndex:i},we.r.FromWindowTop.ISO.modify(we.L.concatC(a.contentOffset))(a.top),Pt.uq.initial),this._cardPositions.setCardPosition(e,t.has(Dt.X.RenderOptions.Features.showLabel),!0,a.top)))),fe.h(ne.PU),Ot.K((e=>(this._log.error("Cannot align mark to card",e),me.c()))),Ht.B())}alignCardTo(e,t,i){const s=i!==Bt.DV.NO_ANIMATION;return he.P((()=>d.of((0,o.pipe)(this._cardPositions.getCardSuggestedPosition(e.id,!!Dt.X.isAlertCard(e)&&e.renderOptions.features.has(Dt.X.RenderOptions.Features.showLabel),ee.some(t),"cardTop"),ee.fromEither)).pipe(oe.oA))).pipe(h.w((t=>this._cardPositions.setCardPosition(e.id,!!Dt.X.isAlertCard(e)&&e.renderOptions.features.has(Dt.X.RenderOptions.Features.showLabel),s,t.top))),fe.h(ne.PU),Ot.K((e=>(this._log.error("Cannot align card to required top",e),me.c()))),Ht.B())}}var Gt;!function(e){e.skip="skip"}(Gt||(Gt={}));const Zt=(e,t,i,s=ne.b2.rafScheduler)=>{const a=(e,i,s,a)=>{if(s===Ve.l$.text)return t.alignCardToMark(e,i?Bt.DV.ANIMATE_ALL:Bt.DV.NO_ANIMATION,!0);if(s===$.h8.forceText)return t.alignCardToMark(e,Bt.DV.NO_ANIMATION,!1);{const r=s===Ve.l$.sidebar;return t.alignMarkToCard(e,r?i?Bt.DV.ANIMATE_ALL:Bt.DV.ANIMATE_MARK:Bt.DV.NO_ANIMATION,a)}},r=pe.T(e.view($.nL.mapper((({currentLens:e,alertSource:t})=>ee.some({currentLens:e,alertSource:t})))).pipe(m.O(ee.none),g.U(ee.map((e=>e.currentLens.id))),v.G(),w.h((([e,t])=>(0,o.pipe)(gt.vB(((e,t)=>e!==t))(e,t),ee.exists(W.identity)))),fe.h(ee.none)),e.view($.nL.mapper((({currentLens:e,alertSource:t})=>ee.some({currentLens:e,alertSource:t})))).pipe(w.h(ee.exists((({currentLens:e})=>(0,ye.Bk)(e)))),g.U(ee.chain((({currentLens:e,alertSource:t})=>(0,o.pipe)($.In.getActiveItemWithAlert(e),ee.filter(ye.S4),ee.map((i=>({card:i,source:t,lensId:e.id}))))))))).pipe(Xe.x((0,W.flow)(gt.vB(((e,t)=>e.lensId===t.lensId&&e.card.activeAlert.id===t.card.activeAlert.id&&e.card.visualState.transition.type===t.card.visualState.transition.type&&e.card.activeHighlightIndex===t.card.activeHighlightIndex)),ee.exists(W.identity))),m.O(ee.none),v.G(),g.U((([e,t])=>(0,o.pipe)(t,ee.map((i=>({card:i.card,source:i.source,animate:(0,o.pipe)(e,gt.wo((({lensId:e})=>e===i.lensId))),suggestedPosition:(0,o.pipe)(e,ee.filter((e=>!e.card.scheduledToDispose)),ee.chain((e=>(0,o.pipe)(t,ee.map((t=>[e.card,t.card]))))),ee.filter((([e,t])=>t.lensId===e.lensId&&t.positionState.absTop>e.positionState.absTop)),ee.map((([e,t])=>we.r.FromWindowTop.ISO.wrap(t.positionState.absTop))))})))))),h.w(ee.fold(me.c,s)),u.M(i),h.w((([{card:e,source:t,animate:s,suggestedPosition:r},n])=>(0,o.pipe)(n,ee.fold((()=>a(e,s,t,r)),(t=>(i.set(ee.none),t===Gt.skip?Nt.C:a(e,s,t,r))))))));return{id:"alignmentSideEffect",when:Fe.R.isWithAlertsId,what:$.nL.Effect.Applicator.create(r.pipe(Ut.c(Nt.F())))}};var zt=i(91402),Wt=i(66910),jt=i(26268);function Xt(e,t,i,s,a){return{id:"changeAlertEffect",when:Fe.R.isWithAlertsId,what:$.nL.Effect.SwitchAlert.create(e.actionEvents.pipe(h.w((e=>{const r=t.get();if(!$.nL.hasCards(r))return zt._(new ut.ej("Cannot update state without cards"));switch(e.type){case Wt.l.Type.alertMinicardButtonClick:return(0,o.pipe)(i.getRegistered(e.alertHighlight.alert.id),ee.fold((()=>(a.warn("somehow we got click on non registered alert",e.alertHighlight.alert),me.c())),(()=>d.of(e.alertHighlight))));case Wt.l.Type.cardMatchesNavigationButtonClick:const t=e.transitionTo;switch(t.kind){case"anotherAlert":return(0,o.pipe)("right"===e.direction?s.nextAlert(t.card):(0,o.pipe)(s.prevAlert(t.card),gt.vx(s.anyRegisteredAlert(t.card))),ee.fold(me.c,(e=>d.of({alert:e,highlightIndex:0}))));case"sameAlert":return(0,o.pipe)(i.getRegistered(t.card.activeAlert.id),ee.fold(me.c,(()=>d.of({alert:t.card.activeAlert,highlightIndex:t.highlightIndex}))));default:return(0,ut.vE)(t)}default:return me.c()}})),g.U((e=>({alertHighlight:e,alertSource:Ve.l$.sidebar,options:{order:"lensOrder"}})))))}}function Yt(e,t,i){const s=e.pipe(w.h($.nL.hasCards),Qe.b(0),g.U((e=>e)),w.h((e=>e.currentLens.items.size>0&&ee.isNone($.In.getActiveItem(e.currentLens))&&i.get())),g.U((e=>(0,o.pipe)(e.currentLens.items.getAt(0),ee.chain(z.checksFeedItemsMapper((e=>ee.some(e.activeAlert)),(()=>ee.none),(()=>ee.none))),gt.bw((()=>t.set(ee.some(Gt.skip))))))),oe.oA,w.h((e=>e.state.type===Ve.bZ.State.Type.REGISTERED)),Xe.x());return{id:"focusFirstCardSideEffect",when:e=>e!==Fe.R.SpecialId.PredictionTakeaways&&e!==Fe.R.SpecialId.PredictionEmogenie,what:$.nL.Effect.SwitchLens.create(s.pipe(u.M(e),g.U((([e,t])=>({lensId:t.currentLens.id,alertSource:Ve.l$.text,options:{order:"lensOrder",toFocus:$.nL.Effect.FocusBehavior.focusAlert({alert:e,highlightIndex:0})}})))))}}function Qt(e,t){const i=e.pipe(g.U((e=>i=>e.type===jt.tn.Type.AppliedAlertAnimationFinished&&i.currentLens.meta.filter(e.alert)?i.patch({currentLens:(0,o.pipe)(Ue.tryCatch((()=>i.currentLens.onAnimationFinish([e.alert])),(e=>t.error("could not update lens state on applied animation finish",e))),Ue.getOrElse((()=>i.currentLens))),alertSource:e.alert.state.source}):i)));return{id:"onAlertApply",when:W.constTrue,what:$.nL.Effect.Applicator.create(i)}}function Kt(e,t){return{id:"lensChangeEffect",when:W.constTrue,what:$.nL.Effect.SwitchLens.create(e.pipe(u.M(t),w.h((([e,t])=>e.lensId!==t)),g.U((([e])=>({lensId:e.lensId,alertSource:Ve.l$.sidebar,options:{order:"lensOrder",toFocus:e.focusFirstCard?$.nL.Effect.FocusBehavior.focusFirst:$.nL.Effect.FocusBehavior.noFocus}})))))}}const $t=(e,t)=>{const i=(0,o.pipe)(e,g.U($.nL.mapper((({currentLens:e,alertSource:t})=>ee.some({currentLens:e,alertSource:t})))),Jt,h.w(ne.b2.rafScheduler),_.b((e=>t.moveCardsBy(e,"freezeActiveCardOnCardsListUpdate"))));return{id:"freezeActiveCardOnCardsListUpdate",when:Fe.R.isWithAlertsId,what:$.nL.Effect.Applicator.create(pe.T(pe.T(i).pipe(Ut.c(Nt.F()))))}},Jt=e=>e.pipe(ye.Sd,g.U(ee.map((e=>e.currentLens))),v.G(),w.h((([e,t])=>(0,o.pipe)((0,W.tuple)(e,t),(0,W.tupled)(gt.vB(((e,t)=>e.id===t.id&&(0,o.pipe)((0,W.tuple)($.In.getActiveItem(e),e.cardIndex,$.In.getActiveItem(t),t.cardIndex),(0,W.tupled)((0,pt.gz)(ee.option)),ee.map((([e,t,i,s])=>e.id===i.id&&t!==s)),ee.getOrElse((()=>!1)))))),ee.getOrElse((()=>!1))))),g.U((0,W.flow)(Vt.bimap(ee.chain($.In.getActiveItem),ee.chain($.In.getActiveItem)),(0,W.tupled)(gt.vB(((e,t)=>t.positionState.absTop-e.positionState.absTop))),ee.getOrElse((()=>0)))));var ei=i(77394),ti=i(55935);function ii(e,t){return{id:"alertSwitchingByClickSideEffect",when:W.constTrue,what:$.nL.Effect.SwitchAlert.create(e.alertClicked.pipe(ti.T(1),h.w(ee.fold(me.c,d.of)),u.M(t.pipe(w.h($.nL.hasCards),g.U((e=>e.currentLens.id))),((e,t)=>({...e,lensId:t}))),g.U((({alert:e,highlightIndex:t,lensId:i})=>({alertHighlight:{alert:e,highlightIndex:t},alertSource:Ve.l$.text,options:{lensId:i,order:"textOrder"}})))))}}var si=i(93283),ai=i(79932),ri=i(58199),ni=i(65247),oi=i(64510);class li{constructor(e,t){this._lensesList=e,this._alertsFilterService=t,this.getLens=(0,He.HP)((function(e){switch(e){case Fe.R.SpecialId.AllAlerts:return this._lensesList.view(ci(Fe.R.Info.allAlerts,Fe.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(Fe.R.SpecialId.AllAlerts)));case Fe.R.SpecialId.Priority:return this._lensesList.view(ci(Fe.R.Info.priority,Fe.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(Fe.R.SpecialId.Priority)));case Fe.R.SpecialId.PredictionTakeaways:return this._lensesList.view(ci(Fe.R.Info.predictionTakeaways,Fe.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(Fe.R.SpecialId.PredictionTakeaways)));case Fe.R.SpecialId.PredictionEmogenie:return this._lensesList.view(ci(Fe.R.Info.predictionEmogenie,Fe.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(Fe.R.SpecialId.PredictionEmogenie)));case Fe.R.SpecialId.RealTimeProofit:return this._lensesList.view(ci(Fe.R.Info.realTimeProofit,Fe.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(Fe.R.SpecialId.RealTimeProofit)));case Fe.R.SpecialId.Plagiarism:return this._lensesList.view(this._getPlagiarismLens);case Fe.R.SpecialId.Premium:return this._lensesList.view(ci(Fe.R.Info.premium,Fe.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(Fe.R.SpecialId.Premium)));case Fe.R.SpecialId.Correctness:case Fe.R.SpecialId.Clarity:case Fe.R.SpecialId.Engagement:case Fe.R.SpecialId.Delivery:case Fe.R.SpecialId.Vox:case Fe.R.SpecialId.CorrectnessPriority:case Fe.R.SpecialId.ClarityPriority:case Fe.R.SpecialId.EngagementPriority:case Fe.R.SpecialId.DeliveryPriority:case Fe.R.SpecialId.VoxPriority:return this._lensesList.view(ci(Fe.R.Info.createOutcome(e),Fe.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(e)));case Fe.R.SpecialId.RealTimeProofit:return this._lensesList.view(ci(Fe.R.Info.realTimeProofit,Fe.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(e)));default:return(0,ut.vE)(e)}})),this._outcomes=[Fe.R.SpecialId.Correctness,Fe.R.SpecialId.Clarity,Fe.R.SpecialId.Engagement,Fe.R.SpecialId.Delivery],this._previews=(0,He.HP)((()=>si.fromFoldableMap((0,ai.getFirstSemigroup)(),kt.array)(this._outcomes,(e=>[e,this._getPreview(e)])))),this._isDocumentEmpty=P.hg.create(!1),this._isFree=P.hg.create(!1),this._outcomeStatusMask=P.hg.combine(this._isDocumentEmpty,this._isFree,((e,t)=>{let i=0;return e&&(i|=ni.x.IsDocumentEmpty),t&&(i|=ni.x.IsFreeUser),i})),this._getPlagiarismLens=(0,W.flow)(ci(Fe.R.Info.plagiarism,{...Fe.R.Meta.group.empty,percentile:ri.T.MAX},this._alertsFilterService.getLensesFilter(Fe.R.SpecialId.Plagiarism)),Fe.R.WithAlerts.modifyMeta((e=>({...e,percentile:ri.T.groupSum.concat(ri.T.MAX,ri.T.groupSum.inverse(e.percentile))}))))}findLens(e){return(0,o.pipe)(ee.fromNullable([this.getLens(Fe.R.SpecialId.AllAlerts),this.getLens(Fe.R.SpecialId.Premium)].find((t=>e(t.get())))),ee.map((e=>e.get().id)))}_getPreview(e){return{...Fe.R.Info.base,logo:ee.none,...this._getOutcomeButtonData(e)}}get lensPreviews(){return this._previews()}_getOutcomeButtonData(e){const t=this.getLens(e),i=t.get().title,s=this._isFree.view((t=>t&&(e===Fe.R.SpecialId.Engagement||e===Fe.R.SpecialId.Delivery))),a=P.hg.combine(t.view("count").view((e=>0===e)),s,((e,t)=>e&&!t)),{description:r,stateMessage:n}=(0,ni.O)(e),o=P.hg.combine(this._isDocumentEmpty,a,t.view("percentile"),((e,t,i)=>e?ri.T.MIN:t?ri.T.MAX:i)).view(ri.g.fromRatio),l=P.hg.create(!1),c=P.hg.combine(t,o,this._outcomeStatusMask,l,n);return{id:e,title:i,description:r,status:c,progress:o,isUnavailable:s}}get nonEmptyLensId(){return(0,o.pipe)(ee.fromNullable([this.getLens(Fe.R.SpecialId.AllAlerts),this.getLens(Fe.R.SpecialId.Premium)].find((e=>e.get().count>0))),ee.map((e=>e.get().id)))}}function ci(e,t,i){return s=>{return new Fe.R.LensImpl(e,(a=e.id,r=t,e=>(0,o.pipe)(oi.lookup(Fe.R.Id.ord)(a,e),ee.getOrElse((()=>r))))(s),i);var a,r}}var di,pi,hi=i(95572),mi=i(95384),ui=i(41120),gi=i(95722),fi=i(20892),_i=i(41199),vi=i(92843);!function(e){e.create=(e,t,i,s)=>(a,r)=>mi.sO.Change.getCreateAction({range:a,capiAlertId:e,visualState:r.to.visualState===gi.Bd.highlighted?{type:mi.sO.Change.VisualState.Type.highlighted,source:t()}:{type:mi.sO.Change.VisualState.Type.visible},extensionDisplayType:i,order:s}),e.update=(e,t,i,s)=>(a,r)=>mi.sO.Change.getUpdateAction({range:a,capiAlertId:e,visualState:r.to.visualState===gi.Bd.highlighted?{type:mi.sO.Change.VisualState.Type.highlighted,source:t()}:{type:mi.sO.Change.VisualState.Type.visible},extensionDisplayType:i,order:s}),e.remove=e=>t=>mi.sO.Change.getRemoveAction({range:t,capiAlertId:e})}(di||(di={}));class wi{constructor(e,t,i,s,a,r,n,l=d.of(void 0),p=!1){this._alertList=e,this._alertsReader=t,this._positionManager=i,this._alertsService=s,this._ded=a,this._lensState=r,this._alertsFilterService=n,this._readyObs=l,this._emulateAppliedAlertAnimation=p,this._highlightedAlert=ee.none,this._focusedAlert=ee.none,this._marksMap=new Map,this._subs=new We.w.Keeper,this.events=new c.xQ,this._alertStateDiff=this._alertList.state.pipe(v.G(),g.U((([e,t])=>Oe.p.diff(e,t))),w.h((0,He.ff)(vi.v.isEmpty))),this._alertsFilter=P.hg.create(W.constFalse),this._filteredAlerts=P.hg.create(ee.none),this._ready=!1,this._log=be.C8.Logging.getLogger("marks_view_model"),this.getMarkByAlert=e=>(0,o.pipe)(this._marksMap.get(e.alert.id),ee.fromNullable,ee.chain((t=>t.markByIndex(e.highlightIndex)))),this.getAlertByMark=e=>(0,o.pipe)(this._alertsReader.getRegistered(ui.P.fromRangeIdToAlertId(e.id)),ee.chain((t=>(0,o.pipe)(jt.$A.getHighlightIndex(t,e.range()),Ue.map((e=>({alert:_i.$.fromModel(t),highlightIndex:e}))),ee.fromEither)))),this.ensureAlertHighlightInViewport=(e,t,i)=>(0,o.pipe)(this.getMarkByAlert(e),ee.fold(me.c,(e=>this._ded.scrollToMark(e,{animate:i,paddingTop:t})))),this._createMA=e=>{const t=gt.MH(e.rawId),{impact:i,cardLayout:{outcome:s}}=e.toRawAlert(),a=hi.DD.createOutcomeType(s),r="critical"===i?hi.Hg.critical:hi.Hg.advanced,n=hi.DD.createExtensionType(r,a),l=Fe.R.getSortOrder(e.lensType),c=new fi.v((t=>(0,o.pipe)(this._alertsReader.getById(e.id),ee.alt((()=>(t&&this._log.warn("Could not find alert for provided MarkAlert",{alert:e,source:t}),ee.some(e)))),ee.map(_i.$.fromModel),gt.MH)),this._alertsService,this._alertsService,(e=>this._ded.changeMarks(e)),di.create(t,(()=>mi.sO.Change.VisualState.Source.api),n,l),di.update(t,(()=>pi.getAlertSource(e,this._lensState.get())),n,l),di.remove(t),(t=>{t.to.visualState===gi.Bd.applied&&(this.events.next({type:jt.tn.Type.AppliedAlertAnimationFinished,alert:e}),this._handleRemovedAlerts([e]).forEach((e=>e.apply())))}));return this._marksMap.set(e.id,c),c},this._handleRemovedAlerts=e=>e.map((({id:e})=>{const t=this._marksMap.get(e);return this._marksMap.delete(e),t.scheduleApply(gi.Bd.disposed),t})),this._handleAlertUpdate=e=>e.map((e=>Ve.bZ.isRegistered(e)?(0,o.pipe)(ee.fromNullable(this._marksMap.get(e.id)),ee.fold((()=>this._alertsFilter.get()(e)?this._createMA(e):null),(e=>(e.scheduleUpdate(),gi.Oe.isOrWillBe(gi.Bd.success)(e)&&e.scheduleApply(gi.Bd.highlighted),e)))):(0,o.pipe)(ee.fromNullable(this._marksMap.get(e.id)),ee.fold((()=>{}),(t=>(e.allowUpdate&&Ve.bZ.isCapiDone(e)&&Ve.bZ.isRated(e)&&gi.Oe.isOrWillBe(gi.Bd.highlighted)(t)?(t.scheduleUpdate(),t.scheduleApply(gi.Bd.success)):(t.scheduleApply(gi.Bd.disposed),this._marksMap.delete(t.alert.id)),t)))))).filter((e=>Boolean(e))),this._subs.push(this._readyObs.subscribe((()=>{this._subs.push(this._listenAlertsUpdates(),this._listenRangesUpdates(),this._listenFilterChange(),this._listenFilteredAlerts()),this._ready=!0})))}focusAlertHighlight(e){return this._ready?(0,o.pipe)(this._marksMap.get(e.alert.id),ee.fromNullable,ee.map((t=>{this._focusedAlert=ee.some(e.alert.id),t.scheduleApply(gi.Bd.highlighted),t.scheduleForceUpdate(),t.apply()})),Ue.fromOption((()=>new Error("Unknown alert"))),Ue.map((()=>({dispose:()=>{ee.exists((t=>t===e.alert.id))(this._focusedAlert)&&(this._highlightedAlert=ee.none),(0,o.pipe)(this._marksMap.get(e.alert.id),ee.fromNullable,ee.filter((()=>!(0,o.pipe)(this._highlightedAlert,ee.exists((t=>t===e.alert.id))))),ee.map((e=>{e.scheduleApply(gi.Bd.visible),e.apply()})))}})))):Ue.left(new Error("marks view model is not ready yet"))}highlightAlertHighlight(e){return this._ready?(0,o.pipe)(this._marksMap.get(e.id),ee.fromNullable,ee.map((t=>{this._highlightedAlert=ee.some(e.id),t.scheduleApply(gi.Bd.highlighted),t.apply()})),Ue.fromOption((()=>new Error("Unknwn alert"))),Ue.map((()=>({dispose:()=>{ee.exists((t=>t===e.id))(this._highlightedAlert)&&(this._highlightedAlert=ee.none),(0,o.pipe)(this._marksMap.get(e.id),ee.fromNullable,ee.filter((()=>!(0,o.pipe)(this._focusedAlert,ee.exists((t=>t===e.id))))),ee.map((e=>{e.scheduleApply(gi.Bd.visible),e.apply()})))}})))):Ue.left(new Error("marks view model is not ready yet"))}moveCursorToHighlight(e,t){return this._ready?(0,o.pipe)(this._marksMap.get(e.alert.id),ee.fromNullable,ee.chain((t=>t.markByIndex(e.highlightIndex))),ee.chain((e=>ee.fromEither(e.range()))),ee.fold((()=>Ue.left(new Error("Cannot find mark for given range"))),(e=>{const{index:i,length:s}=this._ded.getCursor();if(0===s&&(i<e.start||i>e.end)){const i=Math.min(e[t],this._ded.getLastPossibleCursorPosition());return(0,o.pipe)(this._ded.setCursor(i,0),Ue.orElse(Ue.left))}return Ue.right(void 0)}))):Ue.left(new Error("marks view model is not ready yet"))}dispose(){this._subs.dispose()}_listenAlertsUpdates(){const e=e=>({activeAlerts:[],updatedAlerts:[],removedAlerts:[],acceptedAlerts:[],hiddenMarkAlerts:[],...e});return pe.T(this._filteredAlerts.pipe(oe.cp((({visible:t,hidden:i})=>d.of(e({activeAlerts:J.qo(t),removedAlerts:J.qo(i)}))))),this._alertStateDiff.pipe(u.M(this._alertsFilter),g.U((([t,i])=>(0,o.pipe)(t,vi.v.reduce(e({}),((e,t)=>(this._marksMap.has(t.alert.id)&&e.removedAlerts.push(t.alert),e)),((e,t,i)=>(Ve.bZ.isAccepted(i.alert)?e.acceptedAlerts.push(i.alert):e.updatedAlerts.push(i.alert),e)),((e,t)=>(i(t.alert)&&e.activeAlerts.push(t.alert),e)))))))).pipe(g.U((({activeAlerts:e,removedAlerts:t,updatedAlerts:i,acceptedAlerts:s})=>{let a=[];return a=a.concat(e.filter((0,He.W9)((0,He.ff)(Ve.bZ.isPremium),(e=>ee.isSome(e.rawId)))).map((e=>{const t=this._marksMap.get(e.id);return void 0!==t?(t.scheduleForceUpdate(),t):this._createMA(e)}))),this._emulateAppliedAlertAnimation&&setTimeout((()=>{s.forEach((e=>{this.events.next({type:jt.tn.Type.AppliedAlertAnimationFinished,alert:e})}))}),3*(0,nt.Xd)(20)),a=a.concat(this._handleRemovedAlerts(t.concat(s).filter((e=>this._marksMap.has(e.id))))),a=a.concat(this._handleAlertUpdate(i)),a}))).subscribe((e=>{if(e.length>0){const[t,...i]=e;t.applyWith(i)}}))}_listenRangesUpdates(){return this._positionManager.rangeChanged.pipe(ge.j("changed"),g.U((e=>e.filter((e=>ui.P.is(e)&&ui.x.isVisible(e)&&this._marksMap.has(e.meta.alertId))))),w.h((e=>e.length>0))).subscribe((e=>{const t=Array.from(e.values()).filter((e=>ee.isSome(this._alertsReader.getById(e.meta.alertId)))).reduce(((e,t)=>((0,o.pipe)(this._alertsReader.getRegistered(t.meta.alertId),ee.chain((e=>ee.fromNullable(this._marksMap.get(e.id)))),ee.fold(He.ZT,(t=>{t.scheduleForceUpdate(),e.push(t)}))),e)),[]);if(t.length>0){const[e,...i]=t;e.applyWith(i)}}))}_listenFilterChange(){return this._lensState.pipe(w.h((e=>e.currentLens.id!==Fe.R.SpecialId.Premium)),Xe.x(((e,t)=>!(e.currentLens.id!==t.currentLens.id||$.nL.isWithPriorityList(e)&&$.nL.isWithPriorityList(t)&&e.currentLens.isNonPriorityListOpened!==t.currentLens.isNonPriorityListOpened))),Xe.x(),g.U((e=>this._alertsFilterService.alertVisibleInText(e.currentLens.id,$.nL.nonPriorityAlertsVisible(e))))).subscribe(ne.wW(this._alertsFilter))}_listenFilteredAlerts(){return this._alertsFilter.pipe(u.M(this._alertList.state),g.U((([e,t])=>(0,o.pipe)(t,Oe.p.reduce({visible:{},hidden:{}},((t,i)=>(e(i.alert)&&Ve.bZ.isRegistered(i.alert)?t.visible[i.alert.id]=i.alert:t.hidden[i.alert.id]=i.alert,t))),(e=>ee.some(e)))))).subscribe(ne.wW(this._filteredAlerts))}}!function(e){e.toSidebarFluidMarkSource=e=>{switch(e){case Ve.l$.text:case $.h8.forceText:return mi.sO.Change.VisualState.Source.text;case Ve.l$.sidebar:case $.h8.forceSidebar:return mi.sO.Change.VisualState.Source.sidebar;case Ve.l$.api:return mi.sO.Change.VisualState.Source.api;default:return(0,ut.vE)(e)}},e.getAlertSource=(t,i)=>$.nL.hasCards(i)?(0,o.pipe)($.In.getActiveItemWithAlert(i.currentLens),ee.fold((()=>mi.sO.Change.VisualState.Source.api),(s=>s.alerts.some((e=>e.id===t.id))?e.toSidebarFluidMarkSource(i.alertSource):mi.sO.Change.VisualState.Source.api))):mi.sO.Change.VisualState.Source.api}(pi||(pi={}));var yi=i(13444),Ei=i(48403),Ci=i(95343),bi=i(87325);class Si{constructor(e,t){this._documentModel=e,this._modalOperations=t,this.reportViewModel=ee.none,this.state=he.P((()=>ne.GQ((()=>this._documentModel.calculateStats())))).pipe(Ke.a(this._documentModel.checkingState,((e,t)=>(0,o.pipe)(e,ee.filter((()=>"idle"===t))))),h.w(ee.fold((()=>d.of({type:bi.g.State.Type.LOADING}).pipe(yi.g(150))),Ue.fold((e=>(be.C8.Logging.getLogger("editor.toolbar").error("Error on requesting document stats",e),this.onModalClose(),d.of({type:bi.g.State.Type.ERROR}))),(e=>P.hg.combine(this._documentModel.score,this._documentModel.counters,this._documentModel.documentLength.view("trimmed"),((t,i,s)=>(0,o.pipe)(t,ee.fold((()=>({type:bi.g.State.Type.SHORT_CONTENT})),(t=>({type:bi.g.State.Type.READY,documentIsEmpty:0===s,score:t,counters:i,stats:e})))))))))),m.O({type:bi.g.State.Type.EMPTY}),Ei._(1),Ci.x()),this.onModalClose=()=>{this._modalOperations.onClose()}}}var ki=i(89826),xi=i(82578),Mi=i(17082),Ai=i(71831),Li=i(51100),Ii=i(20403);class Ti{constructor(e,t,i,s){this._documentModel=e,this._upgradeViewModel=t,this._isPremiumUser=i,this._mutedCategoriesVM=s}load(e){switch(e.type){case ht.dC.SetGoals:return this._loadSetGoals(e.source);case ht.dC.Performance:return this._loadPerformance();case ht.dC.MutedAlerts:return this._loadMutedAlerts();default:return(0,ut.vE)(e)}}_loadSetGoals(e){return Promise.resolve((t=>{const i={demoMode:!1,isRedesign:!1,isFree:!this._isPremiumUser,defaultAudience:"knowledgeable"},s=xi._.create(this._documentModel.context.get(),(0,o.pipe)(this._documentModel.defaultContext.get(),ee.fold((()=>ki.R$.defaultContextFallback),W.identity)),i,!1),a=P.hg.combine(s.showSetGoalsLoader,s.localContext,((t,a)=>({blocks:s.blocks,context:a,showOnLoad:t,features:i,source:e}))),r=Ge.Z.fromSideEffect((e=>{switch(e.kind){case Li.R.ActionsKind.open:break;case Li.R.ActionsKind.upgrade:this._upgradeViewModel.openUpgradeUrl(Le.Place.gdocsGoals);break;case Li.R.ActionsKind.close:t.onClose(),this._documentModel.updateContext(e.context);break;case Li.R.ActionsKind.reset:s.localContext.set(ki.R$.unset);break;case Li.R.ActionsKind.showOnLoadChanged:s.showSetGoalsLoader.set(e.value);break;default:(0,ut.vE)(e)}}),a);return{instance:{type:ht.dC.SetGoals,source:e},component:F.UI.mount(Li.R.Modal,r)}}))}_loadPerformance(){return Promise.resolve((e=>{const t=new Si(this._documentModel,e),i=F.UI.Knot.make(Ii.q.ModalView,{downloadButton:F.UI.Node.empty}),s=Ge.Z.fromSideEffect((t=>{switch(t.action.kind){case Ii.q.ActionsKind.close:e.onClose();break;default:(0,ut.vE)(t.action.kind)}}),t.state.pipe(g.U((e=>({root:e})))));return{instance:{type:ht.dC.Performance},component:F.UI.mount(i,s)}}))}_loadMutedAlerts(){return Promise.resolve((e=>(0,o.pipe)(this._mutedCategoriesVM,ee.fold((()=>{throw new Error("Tried to load Muted Alerts Dialogue, but Muted Alerts Model was absent")}),(t=>{const i=F.UI.mount(Mi.B,(0,Ai.g)(t,e));return{instance:{type:ht.dC.MutedAlerts},component:i}})))))}}var Ri=i(44618),Fi=i(926),Vi=i(19787),Pi=i(73343),Oi=i(38264),Hi=i(24740),Ni=i(19284),Ui=i(50536),Bi=i(41394),Di=i(10584),qi=i(78792),Gi=i(20490),Zi=i(55969),zi=i(31346);const Wi=(e,t,i,s,a,r,n,l,p,h,u,f,_,v,y,E,C,b,S,k)=>{const x=be.C8.Logging.getLogger("view_models"),M=P.hg.create(Fi.A.defaultState),A=Pi.t.create(Pi.t.defaultLensFilters,{...Pi.t.defaultTextFilters,[Fe.R.SpecialId.Closed]:W.constFalse}),L=Fi.A.get(e.alertsList.state,e.alertsList.lensesScores,A).subscribe(ne.wW(M)),I=new li(M.view("lenses"),A),T=(0,Hi.$)((0,Ri.a)(t).getContents),R={features:new Set([Ui.IG.Features.showCardLabelInOutcomes]),cardLayoutDensityMode:Dt.X.RenderOptions.Density.minimal,shouldAnimateAlertApply:Ui.IG.Default.shouldAnimateAlertApply,upgradeDemoPremiumNotice:Ui.YH.gray},F=(0,Ui.Ls)(T,e.alertsReader,R,(()=>d.of(ee.none)),ee.none,!1,(0,o.pipe)(r,ee.map((t=>t.takeawaysFeedbackService.getFeedbackReader(e.alertsReader))),ee.getOrElse((()=>Ui.Nf.mock)))),V={...z.changePosition(F),...z.transitionTo(F),...z.completeTransition(F),...z.select(F)},O=new Gi.oq(e.alertsList.state,e.alertsReader,M.view("lenses"),e.positionManager,I,new Zi.ad(e.alertsReader,F,A,(e=>e.id===Fe.R.SpecialId.Priority),new Zi.gi(e.alertsReader,F,A,V),V),(0,Zi.kn)((e=>e===Fe.R.SpecialId.Priority),(0,Zi.is)(F,V)),A),H=new lt(a,_),N=i.get(),U=P.hg.create(O.emptyState(N).patch({alertSource:Ve.l$.sidebar}));l.next({kind:ei.R.ChangeLens,selectedLens:N===Fe.R.SpecialId.Priority?"priority":"all"});const B=(0,Ni.u0)((()=>t.getCursor().index),O),D=new Be(e.alertsList,I,3),q=new ht.EQ(new Ti(e.sessionModel,D,y.get().isPremium,ee.none)),G=new Oi.Xx({flush:()=>t.flushChanges()},new c.xQ,F,e.alertsService,(()=>Promise.resolve()),(()=>Promise.resolve()),ee.none,ee.none,ee.none,(()=>!1),V,U),Z=new Bi.o((()=>Ue.right(void 0))),j=new wi(e.alertsList,e.alertsReader,e.positionManager,e.alertsService,t,U,A,p,!0),X=((e,t,i,s,a)=>new qt(Bt.eZ.getSuperScrollMapper(e,s,P.hg.create(16)),Bt.UC.getMapper(t,a,{})))(U,j,P.hg.create(16),Z,t),Y=new tt.D$(f,_,C,b,k),Q=new _t(E,_,f),K=new c.xQ,J=U.pipe(g.U((e=>e.currentLens.id))),te=new Tt(r,Y),ie=new yt(I,Y,te,s,e.sessionModel,function(e){return(0,o.pipe)(e,ee.map((e=>de.aj([e.attentionInfo,e.heatmapReceived]).pipe(w.h((([e,t])=>ee.some(e)&&t)),g.U((([e,t])=>e)),g.U((0,W.flow)(ee.map((e=>({message:e.predictionMessage,easyToRead:e.checklist.every((e=>e.checked))}))))),m.O(ee.none)))),ee.getOrElse((()=>d.of(ee.none))))}(r),_),se=new ft(e.sessionModel,Y,ie,Q,q,I,J,K,Z,y,_,E),ae=new et(U,ie,D,_),re=new it(Y,v,_),oe=(0,o.pipe)(n,ee.map((e=>new bt(Y,e,E,_)))),le=new Vi.m(t,U,j,e.alertsReader),ce=P.hg.create((0,o.pipe)(h,ee.fold((()=>Gt.skip),(()=>Ve.l$.text)),ee.some)),pe=[ii(le,U),(0,o.pipe)(jt.EQ.focusMarkByActiveAlert(U,j,e.alertsReader,x.getLogger("MarksEffects.focusMarkByActiveAlert")),$.nL.Effect.Producer.delayed(p)),jt.EQ.highlightMarkByHighlightedCard(G,U,j,e.alertsReader,x.getLogger("MarksEffects.highlightMarkByHighlightedCard")),Qt(j.events,x.getLogger("createOnAlertApplySideEffect")),Xt(G,U,e.alertsReader,F,x),Yt(U,ce,ae.autoFocusEnabled),G.applicatorEffects,ae.applicatorEffects,Di.R7(U,Z,V,G.actionEvents,{cardsAroundActive:10,cardsBeyondViewport:10}),(0,o.pipe)(Zt(U,X,ce),$.nL.Effect.Producer.delayed(p)),$t(U,Z),Kt(K,J),Oi.dv.createSendActiveAlertFeedbacksEffect(U,e.alertsService,e.alertsReader,x.getLogger("MarksEffects.highlightMarkByHighlightedCard"))],he=P.hg.create(Fe.R.SpecialId.AllAlerts),me=U.view((e=>e.currentLens.id)).pipe(w.h((e=>e===Fe.R.SpecialId.Priority||e===Fe.R.SpecialId.AllAlerts))).subscribe(ne.wW(he)),ue=(0,Ni.VC)(O,B,he),ge=P.hg.create(h),fe=(0,Ni.Dv)((e=>Fe.R.isPriority(e.currentLens.id)),ue),_e=new Ni.vM(e.sessionModel.checkingState,U),ve=(0,o.pipe)([(0,o.pipe)(Ni.Py.whenShouldVerifyCurrentLens,Ni.Py.behaviorToEffect((()=>ee.some($.nL.Effect.FocusBehavior.focusNext)))),(0,o.pipe)((0,He.W9)((()=>ee.isSome(ge.get())),Ni.Py.whenNoActiveCard),Ni.Py.behaviorToEffect((e=>(0,o.pipe)((e=>{const t=z.checksFeedItemsMapper(ee.some,(()=>ee.none),(()=>ee.none));return(0,o.pipe)(ge.get(),ee.chain((i=>(ge.set(ee.none),$.nL.hasCards(e)?(0,o.pipe)(e.currentLens.items.reduce(((e,s)=>(0,o.pipe)(e,ee.alt((()=>(0,o.pipe)(s,t,ee.chain((e=>ee.fromNullable(e.alerts.find((e=>e.id.startsWith(i+"_"))))))))))),ee.none),ee.map((t=>({alert:t,highlightIndex:0,lensId:e.currentLens.id})))):ee.none))))})(e),ee.map((e=>$.nL.Effect.FocusBehavior.focusAlert(e))))))),(0,o.pipe)((0,He.W9)((()=>ae.autoFocusEnabled.get()),(0,He.W9)(Ni.Py.whenFirstOpeningDocumentWithAlerts(_e),Ni.Py.whenNoActiveCard)),Ni.Py.behaviorToEffect((()=>ee.some($.nL.Effect.FocusBehavior.focusFirst))))],(0,Ie.fold)((0,Ie.getFunctionMonoid)(ee.getFirstMonoid())())),we=Ni.Py.getStateTransformer(ve,fe,e.alertsReader,ae.autoFocusEnabled,W.constVoid,he),ye=zi.vj.getItemsPositionsUpdateTransformer(V),Ee=(0,W.flow)(we,Ne.L9(ye)),Ce=new qi.l(U,O,e.alertsReader,e.alertsService,pe,Ee),Se=K.pipe(g.U((({lensId:e})=>e)),w.h((e=>e===Fe.R.SpecialId.AllAlerts||e===Fe.R.SpecialId.Priority)),Xe.x()).subscribe((e=>{i.set(e),l.next({kind:ei.R.ChangeLens,selectedLens:e===Fe.R.SpecialId.Priority?"priority":"all"})})),ke=Y.activeView.pipe(g.U((e=>{switch(e.type){case tt.aH.Type.default:return i.get();case tt.aH.Type.emogenie:return Fe.R.SpecialId.PredictionEmogenie;case tt.aH.Type.readersAttention:return Fe.R.SpecialId.PredictionTakeaways;case tt.aH.Type.readersAttentionOnboarding:return Fe.R.SpecialId.Closed;case tt.aH.Type.proofitReview:return Fe.R.SpecialId.RealTimeProofit;default:return null}})),w.h(qe.fQ),Xe.x(),g.U((e=>[e,e===Fe.R.SpecialId.AllAlerts||e===Fe.R.SpecialId.Priority]))).subscribe((([e,t])=>K.next({lensId:e,focusFirstCard:t}))),xe=new Ft(u,f,v),Me=(0,o.pipe)(r,ee.map((t=>t.initAssistantSessionTracking(G.actionEvents,Y,U,e.alertsList.state,(t=>e.alertsReader.getById(t)),e.alertsService,e.positionManager)))),Ae=new Lt(r,Y,U,(()=>ae.assistantActions.next({type:De.Type.clickOnFakeCard}))),Le=new It(r),Te=wt(S);return{lensState:U,cardsViewModel:G,lensPreviewViewModel:I,cardsListScrollManager:Z,upgradeViewModel:D,assistantHeaderViewModel:se,assistantLayoutViewModel:Y,assistantCardListViewModel:ae,lensChanged:K,predictionsPreviewViewModel:ie,assistantFeedbackViewModel:re,assistantSettingsViewModel:xe,assistantProofitViewModel:oe,readersAttentionViewModel:te,readersAttentionChecklistViewModel:Ae,readersAttentionHeaderViewModel:Le,importanceSurveyViewModel:Q,assistantModalManager:q,goalPredictionViewModel:H,marksViewModel:j,gnar:_,positionViewModel:Te,user:y,dispose:()=>{G.dispose(),Ce.dispose(),j.dispose(),ie.dispose(),Se.unsubscribe(),L.unsubscribe(),ke.unsubscribe(),se.dispose(),ae.dispose(),q.hideAll(),H.unsubscribe(),te.dispose(),Ae.dispose(),me.unsubscribe(),(0,o.pipe)(oe,gt.bw((e=>e.dispose()))),(0,o.pipe)(Me,gt.bw((e=>e.dispose())))}}};var ji=i(20271),Xi=i(18756),Yi=i(8213),Qi=i(19526),Ki=i(68370),$i=i(39318),Ji=i.n($i);const es=({kind:e,title:t,className:i})=>l.createElement(Qi.j.div,{className:i,"data-grammarly-part":"ui-kit-badge"},l.createElement(Ki.b,null,Ji().__css),l.createElement("div",Object.assign({},(0,P.Sh)(Ji().badge,"primary"===e?Ji().badgePrimary:null,"success"===e?Ji().badgeSuccess:null,"gold"===e?Ji().badgeGold:null)),t));es.defaultProps={kind:"primary"};const ts=({browser:e,className:t})=>"safari"!==e?l.createElement(es,{title:"BETA",kind:"success",className:t}):null;var is=i(1620),ss=i(45666),as=i.n(ss);const rs=({intent:e,isExpanded:t,isHidden:i,voteValue:s,goalPredictionVM:a,layoutVM:r})=>{const n=s===ot.l.Intent.FeedbackType.INTENT_ACCEPTED;return l.useEffect((()=>a.onCardShow(e)),[e.id]),l.useEffect((()=>{t&&a.onCardExpanded(e)}),[e.id,t]),l.createElement("div",Object.assign({},(0,P.Sh)(as().card,i&&as().hide,n?as().thank:t&&as().expand),{onClick:()=>!t&&a.onMiniCardClick(e),role:"intent-card"}),l.createElement("div",{className:as().content},l.createElement("div",{className:as().emojiAndTitle},l.createElement(b.dy,{className:as().emoji,unicodeHexArray:n?[at.THANK_YOU_ICON_UNICODE]:[e.unicode],unicodeLiteral:null}),l.createElement("div",null,n?l.createElement("div",null,"Thanks for helping us build new suggestions!"):l.createElement(l.Fragment,null,l.createElement("div",null,e.title),t?l.createElement("div",{className:as().expandedInfo},"Your input helps us develop more tailored suggestions for you."):null))),n?l.createElement("div",{className:as().betaBadgeAndCloseButton},l.createElement(is.P,{onClick:()=>a.onHide(),size:"small",containerClassName:as().closeButton}),l.createElement(ts,{browser:r.browser,className:as().betaBadge})):l.createElement("div",{className:as().voteAndBetaBadge},l.createElement(Yi.A,{ariaLabel:e.title,voteNoAriaLabel:"No",voteYesAriaLabel:"Yes",voteNoTooltipMessage:"No",voteYesTooltipMessage:"Yes",onVote:t=>{t===Yi.x.YES?a.onVote(e,ot.l.Intent.FeedbackType.INTENT_ACCEPTED):a.onVote(e,ot.l.Intent.FeedbackType.INTENT_IGNORED)}}),t?l.createElement(ts,{browser:r.browser,className:as().expandedInfo}):null)))},ns=({goalPredictionVM:e,layoutVM:t})=>l.createElement(P.F.Fragment,null,e.state.view((({intent:i,...s})=>i?l.createElement(rs,Object.assign({layoutVM:t,goalPredictionVM:e,intent:i},s)):null)));var os=i(39742),ls=i(79073),cs=i(57108);const ds=l.memo((({width:e,strokeWidth:t,generalScore:i,componentStyle:s,fontSize:a=9,isLoading:r})=>{const n=e/2,o=n-t/2,c=2*o*Math.PI,d=(r?75:i)/100*c,p=c-d,h=(e=>{const{red40:t,yellow50:i,green50:s}=x.Z;return e<65?t:e<95?i:s})(i);return l.createElement(Qi.j.div,null,l.createElement(Ki.b,null,cs.__css),l.createElement("div",Object.assign({},(0,P.Sh)(cs.scoreRing,r&&cs.loading),{style:s}),l.createElement("svg",{width:e,height:e,viewBox:`0 0 ${e} ${e}`},l.createElement("circle",{fill:"white",r:o,cx:n,cy:n}),l.createElement("circle",{stroke:x.Z.neutral20,fill:"transparent",strokeWidth:t,style:{strokeDashoffset:d},r:o,cx:n,cy:n}),l.createElement("circle",{stroke:h,fill:"transparent",strokeWidth:t,strokeDasharray:`${c} ${c}`,style:{strokeDashoffset:p},r:o,cx:n,cy:n}),l.createElement("text",{className:cs.scoreText,x:"50%",y:"-35%",fontSize:a,fill:"black",textAnchor:"middle",transform:"rotate(90)"},i>0&&!r?i:""))))}));var ps=i(75039),hs=i(88903),ms=i(35327);const us=e=>l.createElement("div",Object.assign({},(0,P.Sh)(ms.summary_wrapper,e.className)),F.UI.mount(vs,Ge.Z.animatingFlow((()=>e.summaryVM.summary),gs))),gs=(e,t)=>(0,o.pipe)(e,ee.filter((e=>e.content!==t.content)),ee.map((()=>hs.both("fadeout","fadein")))),fs=F.UI.Node.make((({view:e})=>l.createElement(P.F.div,{className:ms.summary_heading},e("content")))),_s=F.UI.Transition.make({fadein:ms.summary_fadein},{fadeout:ms.summary_fadeout}),vs=F.UI.Animated.make(_s,fs),ws=({headerVM:e})=>l.createElement(P.F.div,{style:{visibility:e.visibility}},l.createElement("div",{className:ps.panel},l.createElement(us,{summaryVM:e}),l.createElement(P.F.div,{className:ps.score_container,"data-grammarly-part":"assistant-score"},(0,o.pipe)(e.score,g.U(ee.map((({capiScore:e,isLoading:t})=>l.createElement(l.Fragment,null,l.createElement(ds,{generalScore:e,strokeWidth:3,width:38,fontSize:e<100?16:14,isLoading:t,componentStyle:{margin:"-3px -3px 0 0",cursor:"default"}}),l.createElement(os.u,{message:`Text score: ${e} out of 100. This score represents the quality of writing.`},l.createElement("div",{className:ps.info_icon},l.createElement(ls.s,{color:x.Z.neutral40,size:9}))))))),g.U(gt.QP)))),l.createElement("div",{className:ps.lens_switch,"data-grammarly-part":"assistant-lens-switch"},F.UI.mount(ys,e.lensSwitchFlow))),ys=F.UI.Union.asOption(mt.n.Switch);var Es=i(22168),Cs=i(74880),bs=i(45440),Ss=i(30509);const ks=({upgradeViewModel:e})=>l.createElement(P.F.div,{className:Ss.premiumLens},F.UI.mount(bs.r,Ge.Z.fromSideEffect((t=>{"upgrade"===t.action.action.action.kind&&e.openUpgradeUrl(Le.Place.gdocsSidebarSuccessView)}),e.advancedAlerts.pipe(g.U((0,W.flow)(ee.map((e=>({count:e.count,alerts:e.alerts()})))))))));var xs=i(79844),Ms=i(52268),As=i(56157),Ls=i(879);const Is=({successLensViewModel:e})=>{const t=(0,Ms.hM)((0,Ms.wK)(e.successState.view("type"),!1,l.useContext(xs.m.Context)));return l.createElement(P.F.div,{className:Ls.successLens},F.UI.mount(As.q,t))},Ts=(l.forwardRef((({state:e,cardsViewModel:t,upgradeViewModel:i,cardsListScrollManager:s,...a},r)=>{const n=ne.jw((e=>{let t=7;return t=31*t+(0,Xi.AC)(e.currentLens.id),t=31*t+($.nL.isInSuccess(e)?1231:1237),t}),e),c=(0,o.pipe)((0,Ze.Q)(i.advancedAlerts),Ge.Z.extendActions(_.b((e=>{e.key===ze.n.State.expanded&&"upgrade"===e.action.kind&&i.openUpgradeUrl(Le.Place.gdocsSidebarCardList)}))));return l.createElement(Ts,{ref:r},(e=>l.createElement(P.F.Fragment,null,n.view((r=>{const n=r.get();return n.currentLens.id===Fe.R.SpecialId.Premium?l.createElement(ks,{upgradeViewModel:i}):$.nL.isInSuccess(n)?l.createElement(Is,{successLensViewModel:a.successLensViewModel}):l.createElement("div",null,l.createElement(xe,{state:r,cardsViewModel:t,cardsListScrollManager:s,connectorElements:e,header:F.UI.mount(ze.n.ToggablePanel,c)}))})))))})),l.forwardRef((({children:e,onClick:t,className:i=Cs.cardList,footer:s},a)=>{const r=Ee.d.Elements.create(),n=(0,o.pipe)(r.view("viewport"),oe.oA,g.U(Ce.UL.fromEl));return l.createElement("div",{onClick:t,className:i,ref:e=>{"function"==typeof a?a(e):a&&(a.current=e);const t=ee.fromNullable(e);r.lens("scrollConsumer").set(t),r.lens("scrollProvider").set(t),r.lens("viewport").set(t)}},l.createElement(Es.l.RootVirtualContainer,{name:"cardListConnector",viewport:n},e(r)),s)})));var Rs=i(33751),Fs=i(62513);const Vs=l.forwardRef((({successView:e},t)=>l.createElement("div",{className:Fs.compactSuccessLens,ref:t},l.createElement("div",{className:Fs.compactSuccessLensContainer},F.UI.mount(As.q,(0,Ms.hM)((0,Ms.JT)((0,o.pipe)(e,oe.oA)))))))),Ps=l.forwardRef((({viewModels:e},t)=>l.createElement("div",{className:Rs.mainView},l.createElement(Hs,{ref:t,state:e.lensState,cardsViewModel:e.cardsViewModel,upgradeViewModel:e.upgradeViewModel,cardsListScrollManager:e.cardsListScrollManager,assistantCardListViewModel:e.assistantCardListViewModel,predictionsPreviewViewModel:e.predictionsPreviewViewModel,assistantFeedbackViewModel:e.assistantFeedbackViewModel,goalPredictionViewModel:e.goalPredictionViewModel,headerViewModel:e.assistantHeaderViewModel,layoutViewModel:e.assistantLayoutViewModel})))),Os=({position:e,isSuccess:t,children:i})=>l.createElement(P.F.Fragment,null,e.pipe(Xe.x(((e,t)=>e.offset===t.offset&&e.visible===t.visible)),g.U((e=>e.visible?l.createElement(P.F.div,Object.assign({},(0,P.Sh)(Rs.cardListFooterStatic,e.animationInProgress?Rs.cardListFooterAnimate:void 0,t?void 0:Rs.cardListFooterDynamic),{style:t?{}:{transform:Ce.ux.translateY(e.offset)}}),i):null)))),Hs=l.forwardRef((({state:e,assistantCardListViewModel:t,cardsViewModel:i,upgradeViewModel:s,cardsListScrollManager:a,goalPredictionViewModel:r,...n},c)=>{const d=ne.jw((e=>{let t=7;return t=31*t+(0,Xi.AC)(e.currentLens.id),t=31*t+($.nL.isInSuccess(e)?1231:1237),t}),e),p=(0,o.pipe)(d,g.U((e=>{const t=e.get();return $.nL.isInSuccess(t)})),Ke.a(r.haveIntent,((e,t)=>e&&!t))),h=(0,o.pipe)(Me(e,a),u.M(e),g.U((([e,t])=>({visible:!$.nL.hasCards(t)||ee.isNone(t.currentLens.items.find((e=>!e.positionState.isHeightValid))),offset:e+6,animationInProgress:!0}))),m.O({visible:!1,offset:0,animationInProgress:!0}));return l.createElement(Ts,{className:Rs.cardList,onClick:e=>{e.target.getAttribute("class")===Rs.cardList&&t.assistantActions.next({type:De.Type.clickOnEmpty})},footer:l.createElement(P.F.Fragment,null,(0,o.pipe)(p,g.U((e=>l.createElement(Os,{position:h,isSuccess:e},l.createElement(H,{predictionsVM:n.predictionsPreviewViewModel}))))))},(s=>l.createElement(P.F.Fragment,null,(0,o.pipe)(de.aj(p,t.havePremiumAlerts,r.haveIntent),g.U((([o,d,p])=>o&&!d?l.createElement(l.Fragment,null,l.createElement(ws,{headerVM:n.headerViewModel}),l.createElement(Vs,{successView:t.successView,ref:c})):l.createElement(xe,{state:e,cardsViewModel:i,cardsListScrollManager:a,connectorElements:s,ref:c,header:l.createElement(l.Fragment,null,l.createElement(ws,{headerVM:n.headerViewModel}),d?l.createElement("div",{className:Rs.upgradeHookWrapper,role:"uphook-wrapper"},F.UI.mount(ze.n.ToggablePanel,t.upgradeHookFlow)):p?l.createElement(ns,{goalPredictionVM:r,layoutVM:n.layoutViewModel}):null)})))))))})),Ns=l.forwardRef((({viewModels:e,header:t,footer:i,className:s},a)=>l.createElement(Ts,{ref:a,className:s},(s=>l.createElement(xe,{state:e.lensState,cardsViewModel:e.cardsViewModel,cardsListScrollManager:e.cardsListScrollManager,connectorElements:s,header:t,footer:i})))));var Us=i(73008);const Bs=({children:e,layoutVM:t,panelClassName:i,contentClassName:s,footer:a,onClickBack:r,hideBackButton:n=P.hg.create(!1),dataPartName:o})=>l.createElement("div",{className:Us.viewOverlay,"data-grammarly-part":"assistant-view-overlay"},l.createElement(P.F.Fragment,null,n.view((e=>!e&&l.createElement(T.M,{className:Us.viewOverlayGoBack,clickHandler:()=>r?r():t.popActiveView()},"<- Back")))),l.createElement("div",{className:i||Us.defaultViewOverlayPanel},l.createElement("div",{className:s||Us.content,"data-grammarly-part":o},e),a&&l.createElement("div",{className:Us.footer},a)));var Ds=i(28288),qs=i(90555),Gs=i(92783),Zs=i(40145);const zs=l.forwardRef((({emogenieService:e,viewModels:t},i)=>l.createElement(Bs,{dataPartName:"emogenie-view-overlay",layoutVM:t.assistantLayoutViewModel,panelClassName:Us.gradientViewOverlayPanel,hideBackButton:t.user.view((e=>e.isAnonymous))},l.createElement(P.F.Fragment,null,t.lensPreviewViewModel.getLens(Fe.R.SpecialId.PredictionEmogenie).pipe(g.U((e=>e.count>0)),Xe.x(),g.U((s=>s?l.createElement(Ns,{key:"emogeniePredictionCardList",viewModels:t,ref:i,header:l.createElement(l.Fragment,null,l.createElement(Ws,{emogenieService:e}),l.createElement("div",{className:Zs.relatedSuggestionsTitle},"RELATED SUGGESTIONS"))}):l.createElement("div",{className:Us.gradientViewOverlayContent},l.createElement(Ws,{emogenieService:e}))))))))),Ws=({emogenieService:e})=>{var t;const i=e.viewState.get(),s=null===(t=i.report)||void 0===t?void 0:t.institutionLogo,a=i.isBrandTonesEnabled?l.createElement("div",null,s?l.createElement("img",{className:Us.logo,src:s}):null,i.institutionName," Tone detector"):"Tone detector";return l.createElement(l.Fragment,null,l.createElement("div",{className:Us.defaultViewOverlayHeader},a,(0,Gs.G6)()?null:l.createElement(Ds.m,{secondary:!0})),l.createElement(P.F.Fragment,null,e.viewState.view((({report:t,emotionsPoll:i,settings:s,isBrandTonesEnabled:a})=>t&&Array.isArray(t.emotions)&&l.createElement(qs.G,{key:"emogenieReportPopup",showBanner:!1,report:t,actions:e.actions,emotionsPoll:i,settings:s,isBrandTonesEnabled:a})))))};var js=i(16879);const Xs=({feedbackVM:e,layoutVM:t})=>l.createElement(Bs,{dataPartName:"feedback-view-overlay",layoutVM:t,panelClassName:Us.gradientViewOverlayPanel},l.createElement("div",{className:Us.gradientViewOverlayContent},l.createElement("div",{className:Us.defaultViewOverlayHeader},"Product Feedback"),l.createElement(js.q,{domain:e.getDomain(),onSubmit:t=>e.submitFeedback(t),onClose:()=>t.popActiveView(),align:"left",hideLogo:!0,style:{height:"calc(100% - 48px)"},fixSubmitButtonOverflowBottomPadding:!0})));var Ys=i(22667),Qs=i(78846);const Ks=e=>l.createElement("div",{className:Qs.logo_score},F.UI.mount(sa,Ge.Z.animatingFlow((()=>e.headerVM.logoScore),$s))),$s=(e,t)=>(0,o.pipe)(e,ee.filter((e=>e.type!==t.type)),ee.map((()=>hs.both("fadeout","fadein")))),Js=F.UI.Node.make((()=>l.createElement(Ys.K,{className:Qs.grammarly_logo,size:22}))),ea=F.UI.Node.make((({view:e})=>l.createElement(P.F.div,{className:Qs.score_container,"data-grammarly-part":"assistant-score"},(0,o.pipe)(e("score"),(0,g.U)((({capiScore:e,isLoading:t})=>l.createElement(l.Fragment,null,l.createElement(ds,{generalScore:e,strokeWidth:2,width:22,fontSize:e<100?11:9,isLoading:t,componentStyle:{transform:"translate(2px, -2px) rotate(-90deg)",cursor:"default"}})))))))),ta=F.UI.Union.make("type",{logo:Js,score:ea}),ia=F.UI.Transition.make({fadein:Qs.logoscore_fadein},{fadeout:Qs.logoscore_fadeout}),sa=F.UI.Animated.make(ia,ta);var aa=i(22679),ra=i(3860),na=i(85708);const oa=({color:e=x.Z.neutral50})=>l.createElement("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.createElement("path",{d:"M15.8256 15.75L21.5 10M21.5 10V7.375M21.5 10H24.1047M23.5 5.5V8.125H26.1047M11.3605 24L12.8462 21.375M12.8462 21.375C13.734 21.8536 14.7483 22.125 15.8256 22.125C16.9028 22.125 17.9172 21.8536 18.805 21.375M12.8462 21.375C10.8548 20.3014 9.5 18.1852 9.5 15.75C9.5 12.2292 12.3321 9.375 15.8256 9.375C16.8052 9.375 17.7327 9.59941 18.5605 10M20.2907 24L18.805 21.375M18.805 21.375C20.7964 20.3014 22.1512 18.1852 22.1512 15.75C22.1512 14.7652 21.9296 13.8326 21.534 13M16.5 12.4435C16.2822 12.3986 16.0566 12.375 15.8256 12.375C13.9761 12.375 12.4767 13.886 12.4767 15.75C12.4767 17.614 13.9761 19.125 15.8256 19.125C17.6751 19.125 19.1744 17.614 19.1744 15.75C19.1744 15.5171 19.151 15.2897 19.1064 15.07",stroke:e,strokeLinecap:"round"})),la=({color:e=x.Z.neutral50})=>l.createElement("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.createElement("path",{d:"M15.5 9.5V9C15.2239 9 15 9.22386 15 9.5H15.5ZM17.5 9.5H18C18 9.22386 17.7761 9 17.5 9V9.5ZM20.8333 10.8333L21.1869 10.4798C21.0931 10.386 20.9659 10.3333 20.8333 10.3333C20.7007 10.3333 20.5735 10.386 20.4798 10.4798L20.8333 10.8333ZM22.1667 12.1667L22.5202 12.5202C22.7155 12.325 22.7155 12.0084 22.5202 11.8131L22.1667 12.1667ZM23.5 15.5H24C24 15.2239 23.7761 15 23.5 15V15.5ZM23.5 17.5V18C23.7761 18 24 17.7761 24 17.5H23.5ZM22.1667 20.8333L22.5202 21.1869C22.7155 20.9916 22.7155 20.675 22.5202 20.4798L22.1667 20.8333ZM20.8333 22.1667L20.4798 22.5202C20.675 22.7155 20.9916 22.7155 21.1869 22.5202L20.8333 22.1667ZM17.5 23.5V24C17.7761 24 18 23.7761 18 23.5H17.5ZM15.5 23.5H15C15 23.7761 15.2239 24 15.5 24V23.5ZM12.1667 22.1667L11.8131 22.5202C12.0084 22.7155 12.325 22.7155 12.5202 22.5202L12.1667 22.1667ZM10.8333 20.8333L10.4798 20.4798C10.386 20.5735 10.3333 20.7007 10.3333 20.8333C10.3333 20.9659 10.386 21.0931 10.4798 21.1869L10.8333 20.8333ZM9.5 17.5H9C9 17.7761 9.22386 18 9.5 18V17.5ZM9.5 15.5V15C9.22386 15 9 15.2239 9 15.5H9.5ZM10.8333 12.1667L10.4798 11.8131C10.386 11.9069 10.3333 12.0341 10.3333 12.1667C10.3333 12.2993 10.386 12.4265 10.4798 12.5202L10.8333 12.1667ZM12.1667 10.8333L12.5202 10.4798C12.4265 10.386 12.2993 10.3333 12.1667 10.3333C12.0341 10.3333 11.9069 10.386 11.8131 10.4798L12.1667 10.8333ZM12.7686 11.4353L12.4151 11.7888L12.7686 11.4353ZM11.4353 12.7686L11.0817 13.1222L11.4353 12.7686ZM21.5647 20.2314L21.2112 20.5849L21.5647 20.2314ZM21.5647 12.7686L21.2112 12.4151L21.5647 12.7686ZM15.5 10H17.5V9H15.5V10ZM17 9.5V10.3039H18V9.5H17ZM20.5849 11.7888L21.1869 11.1869L20.4798 10.4798L19.8778 11.0817L20.5849 11.7888ZM20.4798 11.1869L21.8131 12.5202L22.5202 11.8131L21.1869 10.4798L20.4798 11.1869ZM21.8131 11.8131L21.2112 12.4151L21.9183 13.1222L22.5202 12.5202L21.8131 11.8131ZM22.6961 16H23.5V15H22.6961V16ZM23 15.5V17.5H24V15.5H23ZM23.5 17H22.6961V18H23.5V17ZM21.2112 20.5849L21.8131 21.1869L22.5202 20.4798L21.9183 19.8778L21.2112 20.5849ZM21.8131 20.4798L20.4798 21.8131L21.1869 22.5202L22.5202 21.1869L21.8131 20.4798ZM21.1869 21.8131L20.5849 21.2112L19.8778 21.9183L20.4798 22.5202L21.1869 21.8131ZM17 22.6961V23.5H18V22.6961H17ZM17.5 23H15.5V24H17.5V23ZM16 23.5V22.6961H15V23.5H16ZM12.4151 21.2112L11.8131 21.8131L12.5202 22.5202L13.1222 21.9183L12.4151 21.2112ZM12.5202 21.8131L11.1869 20.4798L10.4798 21.1869L11.8131 22.5202L12.5202 21.8131ZM11.1869 21.1869L11.7888 20.5849L11.0817 19.8778L10.4798 20.4798L11.1869 21.1869ZM10.3039 17H9.5V18H10.3039V17ZM10 17.5V15.5H9V17.5H10ZM9.5 16H10.3039V15H9.5V16ZM11.7888 12.4151L11.1869 11.8131L10.4798 12.5202L11.0817 13.1222L11.7888 12.4151ZM11.1869 12.5202L12.5202 11.1869L11.8131 10.4798L10.4798 11.8131L11.1869 12.5202ZM11.8131 11.1869L12.4151 11.7888L13.1222 11.0817L12.5202 10.4798L11.8131 11.1869ZM16 10.3039V9.5H15V10.3039H16ZM19.6667 16.5C19.6667 14.7511 18.2489 13.3333 16.5 13.3333V14.3333C17.6966 14.3333 18.6667 15.3034 18.6667 16.5H19.6667ZM16.5 19.6667C18.2489 19.6667 19.6667 18.2489 19.6667 16.5H18.6667C18.6667 17.6966 17.6966 18.6667 16.5 18.6667V19.6667ZM12.4151 11.7888C13.738 13.1118 16 12.1748 16 10.3039H15C15 11.2839 13.8151 11.7747 13.1222 11.0817L12.4151 11.7888ZM10.3039 16C12.1748 16 13.1118 13.738 11.7888 12.4151L11.0817 13.1222C11.7747 13.8151 11.2839 15 10.3039 15V16ZM11.7888 20.5849C13.1118 19.262 12.1748 17 10.3039 17V18C11.2839 18 11.7747 19.1849 11.0817 19.8778L11.7888 20.5849ZM17 10.3039C17 12.1748 19.262 13.1118 20.5849 11.7888L19.8778 11.0817C19.1849 11.7747 18 11.2839 18 10.3039H17ZM13.3333 16.5C13.3333 18.2489 14.7511 19.6667 16.5 19.6667V18.6667C15.3034 18.6667 14.3333 17.6966 14.3333 16.5H13.3333ZM16 22.6961C16 20.8252 13.738 19.8882 12.4151 21.2112L13.1222 21.9183C13.8151 21.2253 15 21.7161 15 22.6961H16ZM20.5849 21.2112C19.262 19.8882 17 20.8252 17 22.6961H18C18 21.7161 19.1849 21.2253 19.8778 21.9183L20.5849 21.2112ZM22.6961 17C20.8252 17 19.8882 19.262 21.2112 20.5849L21.9183 19.8778C21.2253 19.1849 21.7161 18 22.6961 18V17ZM21.2112 12.4151C19.8882 13.738 20.8252 16 22.6961 16V15C21.7161 15 21.2253 13.8151 21.9183 13.1222L21.2112 12.4151ZM14.3333 16.5C14.3333 15.3034 15.3034 14.3333 16.5 14.3333V13.3333C14.7511 13.3333 13.3333 14.7511 13.3333 16.5H14.3333Z",fill:e})),ca=e=>{const t=(0,se.e8)(),[i,s]=l.useState(!1),[a,r]=l.useState(!1),n=e.viewModels.assistantLayoutViewModel,c=e.viewModels.assistantHeaderViewModel,d=l.useContext(ji.O.Context),p=(0,o.pipe)(e.viewModels.assistantProofitViewModel,ee.map((e=>e.feature)),ee.map((e=>l.createElement(P.F.Fragment,null,(0,de.aj)([e.layoutCreated,n.activeView.view((t=>t.type===e.assistantViewType()))]).pipe((0,g.U)((([t,i])=>t?l.createElement(os.u,{message:d.proofitTooltip,showDelay:aa.gk,disabled:i},l.createElement("div",{"data-grammarly-part":"assistant-header-action-btn-proofit",className:Qs.headerActionBtn},l.createElement(ra.h,{onClick:()=>i?n.popActiveView():n.pushActiveView({type:e.assistantViewType()})},l.createElement(na.g,null,l.createElement("div",{className:Qs.headerActionBtnProofitIcon}))))):null)))))),ee.toNullable);return l.createElement(os.u,{message:"Grab and drag to move panel",showDelay:aa.gk,disabled:i},l.createElement("div",Object.assign({},(0,P.Sh)(Qs.header,a&&Qs.actions_hovered),{ref:t,onMouseDown:()=>s(!0),onMouseOut:()=>s(!1)}),l.createElement(Ks,{headerVM:c}),l.createElement(da,null),l.createElement("div",{className:Qs.headerActions,onMouseOver:()=>r(!0),onMouseOut:()=>r(!1)},p,l.createElement(P.F.Fragment,null,c.showSetGoalsActionButton.view((e=>e&&l.createElement(os.u,{message:d.setGoalsTooltip,showDelay:aa.gk},l.createElement("div",{"data-grammarly-part":"assistant-header-action-btn-set-goals",className:Qs.headerActionBtn},l.createElement(ra.h,{onClick:()=>c.open("setGoals")},l.createElement(oa,null))))))),l.createElement(P.F.Fragment,null,P.hg.combine(c.showSettingsActionButton,n.activeView,((e,t)=>{const i=t.type===tt.aH.Type.settings;return e&&l.createElement(os.u,{message:"Settings",showDelay:aa.gk,disabled:i},l.createElement("div",{"data-grammarly-part":"assistant-header-action-btn-settings",className:Qs.headerActionBtn},l.createElement(ra.h,{onClick:()=>i?n.popActiveView():n.pushActiveView({type:tt.aH.Type.settings})},l.createElement(la,null))))}))),l.createElement(os.u,{message:"Close panel",showDelay:aa.gk},l.createElement("div",{"data-grammarly-part":"assistant-header-action-btn-close",className:Qs.headerActionBtn},l.createElement(is.P,{onClick:c.close}))))))},da=()=>l.createElement("div",{className:Qs.draggableWrapper},l.createElement("div",{className:Qs.draggable}));var pa=i(24606),ha=i(95888),ma=i(2249),ua=i(41794),ga=i.n(ua);const fa=[{question:"How important do you consider this piece of writing?",helperText:"Make a selection below",multiSelect:!1,options:[{value:"extremelyImportant",label:"Extremely important"},{value:"somewhatImportant",label:"Somewhat important"},{value:"neutral",label:"Neutral"},{value:"somewhatUnimportant",label:"Somewhat unimportant"},{value:"extremelyUnimportant",label:"Extremely unimportant"}]},{question:"What kind of feedback would be helpful when writing something like this?",helperText:"Select all that apply",multiSelect:!0,options:[{value:"clearCommunication",label:"Clear communication"},{value:"soundingFluent",label:"Sounding fluent"},{value:"toneAndDelivery",label:"Tone and delivery"},{value:"synonyms",label:"Synonyms"},{value:"conciseness",label:"Conciseness"}]}],_a=e=>{const[t,i]=(0,l.useState)(void 0);return l.createElement("form",{className:ga().contentContainer},l.createElement("div",{className:ga().main},l.createElement("div",{className:ga().question},e.question),l.createElement("div",{className:ga().helperText},e.helperText),l.createElement("div",{className:ga().optionsContainer},e.options.map(((e,s)=>l.createElement("div",{key:s,className:ga().radioOption},l.createElement("input",{type:"radio",id:e.value,name:"contact",value:e.value,checked:t===e.value,onChange:e=>i(e.target.value)}),l.createElement("label",{htmlFor:e.value},e.label)))))),l.createElement("div",{className:ga().buttonsContainer},l.createElement(pa.z,{style:{color:"#4A6EE0"},kind:"transparent-hoverable",onClick:e.dismissPopup},"Dismiss"),l.createElement(pa.z,{disabled:!t,onClick:()=>t&&e.submitAnswers([t])},"extremelyImportant"===t||"somewhatImportant"===t?"Next":"Submit")))},va=e=>{const[t,i]=(0,l.useState)([]);return l.createElement("form",{className:ga().contentContainer},l.createElement("div",{className:ga().main},l.createElement("div",{className:ga().question},e.question),l.createElement("div",{className:ga().helperText},e.helperText),l.createElement("div",{className:ga().optionsContainer},e.options.map(((e,s)=>l.createElement(ha.J,{key:s,className:ga().checkboxOption,labelId:`importance-survey-${e.value}-checkbox`,onChange:s=>{i(s?[...t,e.value]:t.filter((t=>t!==e.value)))}},e.label))))),l.createElement("div",{className:ga().buttonsContainer},l.createElement(pa.z,{style:{color:"#4A6EE0"},kind:"transparent-hoverable",onClick:e.dismissPopup},"Dismiss"),l.createElement(pa.z,{disabled:0===t.length,onClick:()=>e.submitAnswers(t)},"Submit")))},wa=e=>l.createElement("div",{className:ga().thankYouContentContainer},l.createElement("div",{className:ga().thankYouMain},l.createElement(ma.R,{size:44}),l.createElement("div",{className:ga().thankYou},"Thank you!"),l.createElement("div",{className:ga().thankYouSubtext},"Your feedback helps us develop features tailored to your writing needs.")),l.createElement("div",{className:ga().buttonsContainer},l.createElement(pa.z,{onClick:e.closePopup},"Done"))),ya=({importanceSurveyVM:e,layoutVM:t})=>l.createElement(Bs,{dataPartName:"importance-survey-view-overlay",layoutVM:t,hideBackButton:e.hideBackButton},l.createElement("div",{className:ga().container},l.createElement("div",{className:Us.defaultViewOverlayHeader},"Help Grammarly get smarter!"),l.createElement(P.F.Fragment,null,e.step.view((t=>t===dt.importance?l.createElement(_a,Object.assign({},fa[0],{dismissPopup:e.dismiss,submitAnswers:e.submit})):t===dt.kindOfFeedback?l.createElement(va,Object.assign({},fa[1],{dismissPopup:e.dismiss,submitAnswers:e.submit})):t===dt.thankYou?l.createElement(wa,{closePopup:e.done}):null))))),Ea=({viewModels:e})=>l.createElement(P.F.Fragment,null,e.assistantLayoutViewModel.activeView.view((t=>{if(t.type!==tt.aH.Type.popup)return null;const{popupType:i}=t;return i===tt.aH.PopupType.importanceSurvey?l.createElement(ya,{layoutVM:e.assistantLayoutViewModel,importanceSurveyVM:e.importanceSurveyViewModel}):null})));var Ca=i(55364);const ba=({layoutVM:e,onClickBack:t,children:i})=>{const[s,a]=l.useState(!1);return l.createElement(Bs,{dataPartName:"proofit-view-overlay",layoutVM:e,panelClassName:Ca.proofitViewOverlayPanel,onClickBack:t},l.createElement("div",{className:Ca.proofitViewOverlayContent,tabIndex:-1,ref:e=>{null===e||s||(e.focus(),a(!0))}},l.createElement("div",{className:Us.defaultViewOverlayHeader},l.createElement("div",{className:Ca.proofitViewOverlayHeader},"Expert Writing Help",l.createElement(ts,{browser:e.browser,className:Ca.proofitViewOverlayHeaderBetaBadge}))),i))};var Sa=i(81108),ka=i(26479),xa=i.n(ka),Ma=i(83765),Aa=i.n(Ma);const La=({turnaroundTime:e,freeTrialQuota:t,onSubmit:i,disabledInfo:s,isLoading:a,style:r,onTogglePrivacyInfo:n,showPrivacyInfo:o})=>{const[c,d]=l.useState(null!=o&&o),p=t>0?t:0;return l.useEffect((()=>{null==n||n(c)}),[c]),l.useEffect((()=>{d(null!=o&&o)}),[o]),l.createElement(Qi.j.div,{"data-grammarly-part":"proofit-request-form",style:{width:"100%",height:"100%",...r}},l.createElement(Ki.b,null,Aa().__css),l.createElement("div",{className:Aa().proofitRequestForm},c?l.createElement(l.Fragment,null,l.createElement("div",{className:Aa().proofitRequestFormPrivacyInfoTitle},"How we protect you"),l.createElement("div",{className:Aa().proofitRequestFormPrivacyInfoDescription},l.createElement("div",{className:Aa().proofitRequestFormPrivacyInfoDescriptionItem},l.createElement("div",{className:Aa().proofitRequestFormPrivacyInfoDescriptionItemBulletPoint}),l.createElement("div",{className:Aa().proofitRequestFormPrivacyInfoDescriptionItemText},"Our writing experts will see only your current email draftno prior messages or contact details.")),l.createElement("div",{className:Aa().proofitRequestFormPrivacyInfoDescriptionItem},l.createElement("div",{className:Aa().proofitRequestFormPrivacyInfoDescriptionItemBulletPoint}),l.createElement("div",{className:Aa().proofitRequestFormPrivacyInfoDescriptionItemText},"We will not sell, rent, or make public any of your personal data."))),l.createElement(pa.z,{kind:"neutral",onClick:()=>d(!1)},"Continue")):l.createElement(l.Fragment,null,l.createElement("div",{className:Aa().proofitRequestFormImg}),l.createElement("div",{className:Aa().proofitRequestFormTitle},"Get instant writing help"),l.createElement("div",{className:Aa().proofitRequestFormDescription},"Our writing experts are standing by to review your email."),l.createElement("div",{className:Aa().proofitRequestFormCostAndTime},l.createElement("div",{className:Aa().proofitRequestFormCost},l.createElement("div",{className:Aa().proofitRequestFormCostAndTimeTitle},p," free ",V._6(p,"review","reviews")),l.createElement("div",{className:Aa().proofitRequestFormCostAndTimeSubtitle},"left this month",l.createElement("sup",null,"*"))),l.createElement("div",{className:Aa().proofitRequestFormTime},l.createElement("div",{className:Aa().proofitRequestFormCostAndTimeTitle},e," seconds"),l.createElement("div",{className:Aa().proofitRequestFormCostAndTimeSubtitle},"average turnaround"))),l.createElement(pa.z,{kind:Boolean(s)?"neutral":"primary",containerClassName:Aa().proofitRequestFormRequestBtn,disabled:Boolean(s||a),onClick:i},a?l.createElement(Qi.j.div,null,l.createElement(Ki.b,null,xa().__css),l.createElement("div",{className:xa().proofitRequestFormBtnLoadingSpinner})):"Request now"),s||a?s?l.createElement("div",{className:Aa().proofitRequestFormUnavailableMsg},l.createElement(Sa.Q,{info:s})):null:l.createElement(pa.z,{kind:"link",onClick:()=>d(!0)},"Learn how we protect your privacy"),l.createElement("div",{className:Aa().proofitRequestFormFreeTrialFootnote},l.createElement("span",null,l.createElement("sup",null,"*")," included with your Premium subscription")))))};La.defaultProps={disabledInfo:null,isLoading:!1};const Ia=({layoutVM:e,proofitVM:t})=>{const i=(0,se.fW)(),[s,a]=l.useState(!1);return l.createElement(ba,{layoutVM:e,onClickBack:()=>{s?a(!1):e.popActiveView()}},l.createElement(P.F.Fragment,null,(0,de.aj)([t.feature.layoutCreated,t.feature.requestInfo,t.feature.turnaroundTime,t.feature.quotaRemaining,t.feature.requestDisabledInfo]).pipe((0,g.U)((([e,r,n,o,c])=>e&&r.status!==Ct.u.RequestStatus.REVIEWING?l.createElement(La,{turnaroundTime:n,freeTrialQuota:o,onSubmit:()=>t.onSubmitRequest(i),style:{height:"calc(100% - 48px)"},disabledInfo:c,isLoading:r.status===Ct.u.RequestStatus.PREPARING||r.status===Ct.u.RequestStatus.PRE_SUBMIT,showPrivacyInfo:s,onTogglePrivacyInfo:a}):null)))))};var Ta=i(65669),Ra=i.n(Ta);const Fa=({suggestionsMade:e,onAccept:t})=>l.createElement(Qi.j.div,{"data-grammarly-part":"proofit-review-form"},l.createElement(Ki.b,null,Ra().__css),l.createElement("div",{className:Ra().proofitReviewForm},l.createElement("div",{className:Ra().proofitReviewFormImg}),l.createElement("div",{className:Ra().proofitReviewFormTitle},"Our experts made ",e," ",V._6(e,"suggestion","suggestions")),l.createElement("div",{className:Ra().proofitReviewFormDescription},"Their changes are highlighted in your email."),l.createElement(pa.z,{onClick:t},"Done"))),Va=({layoutVM:e,proofitVM:t})=>{const i=(0,se.fW)();return l.createElement(ba,{layoutVM:e},l.createElement(P.F.Fragment,null,(0,de.aj)([t.feature.layoutCreated,t.feature.requestInfo]).pipe((0,g.U)((([e,s])=>e&&s.status===Ct.u.RequestStatus.REVIEWING?l.createElement(Fa,{suggestionsMade:s.suggestionsMade,onAccept:()=>t.onCompleteRequest(i)}):null)))))};class Pa extends l.Component{render(){return this._idSuffix=this._idSuffix||"readersAttentionOnboardingBanner_"+Pa._nextIdSuffix++,l.createElement("svg",{className:this.props.className,viewBox:"0 2 296 144",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.createElement("g",{clipPath:`url(#clip0_${this._idSuffix})`},l.createElement("rect",{width:"296",height:"144",fill:"#4A6EE0"}),l.createElement("path",{d:"M-5.5 -3.5H261.5V47.5H-5.5V-3.5Z",fill:"#6E66DE",stroke:"#1F243C"}),l.createElement("path",{d:"M-2.79293 -197.5L429.5 234.793V-197.5H-2.79293Z",fill:"#15C39A",stroke:"#1F243C"}),l.createElement("path",{d:"M219.057 33C222.992 33 226.182 29.8101 226.182 25.875C226.182 21.94 222.992 18.7501 219.057 18.7501C215.122 18.7501 211.932 21.94 211.932 25.875C211.932 29.8101 215.122 33 219.057 33Z",fill:"#1F243C",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M221.477 31.0899C225.92 31.0899 229.522 27.4881 229.522 23.045C229.522 18.6018 225.92 15 221.477 15C217.033 15 213.432 18.6018 213.432 23.045C213.432 27.4881 217.033 31.0899 221.477 31.0899Z",fill:"#41D9B5",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M220.188 27.045C220.009 27.045 219.841 26.9778 219.717 26.8434L216.927 24.0646C216.67 23.8069 216.67 23.3811 216.927 23.1122C217.185 22.8545 217.611 22.8545 217.88 23.1122L220.188 25.4204L225.353 20.2662C225.611 20.0085 226.037 20.0085 226.306 20.2662C226.563 20.5239 226.563 20.9497 226.306 21.2186L220.67 26.8546C220.535 26.9778 220.367 27.045 220.188 27.045Z",fill:"white"}),l.createElement("path",{d:"M68.125 57C72.06 57 75.25 53.8101 75.25 49.875C75.25 45.94 72.06 42.7501 68.125 42.7501C64.19 42.7501 61 45.94 61 49.875C61 53.8101 64.19 57 68.125 57Z",fill:"#1F243C",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M70.545 55.0899C74.9881 55.0899 78.5899 51.4881 78.5899 47.045C78.5899 42.6018 74.9881 39 70.545 39C66.1018 39 62.5 42.6018 62.5 47.045C62.5 51.4881 66.1018 55.0899 70.545 55.0899Z",fill:"#41D9B5",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M69.2564 51.045C69.0771 51.045 68.909 50.9778 68.7858 50.8434L65.9958 48.0646C65.7381 47.8069 65.7381 47.3811 65.9958 47.1122C66.2535 46.8545 66.6793 46.8545 66.9482 47.1122L69.2564 49.4204L74.4217 44.2662C74.6794 44.0085 75.1052 44.0085 75.3741 44.2662C75.6318 44.5239 75.6318 44.9497 75.3741 45.2186L69.7382 50.8546C69.6037 50.9778 69.4357 51.045 69.2564 51.045Z",fill:"white"}),l.createElement("rect",{x:"132",y:"38",width:"39",height:"24",rx:"2",fill:"#1F243C",stroke:"#1F243C"}),l.createElement("rect",{x:"135",y:"35",width:"39",height:"24",rx:"2",fill:"#F8C6DA",stroke:"#1F243C"}),l.createElement("path",{d:"M135 58.3296L149.303 47.4857L153.298 44.4591C154.007 43.923 154.993 43.923 155.702 44.4591L159.697 47.4857L174 58.3296",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M173.914 35.5L159.698 47.6583L155.806 50.9962C155.063 51.6361 153.956 51.6361 153.212 50.9962L149.303 47.6583L135.087 35.5",fill:"#F8C6DA"}),l.createElement("path",{d:"M173.914 35.5L159.698 47.6583L155.806 50.9962C155.063 51.6361 153.956 51.6361 153.212 50.9962L149.303 47.6583L135.087 35.5",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("rect",{x:"135",y:"35",width:"39",height:"24",rx:"2",stroke:"#1F243C"}),l.createElement("rect",{y:"32",width:"296",height:"112",fill:`url(#paint0_linear_${this._idSuffix})`}),l.createElement("path",{d:"M185.5 22C185.5 18.961 183.039 16.5 180 16.5C183.039 16.5 185.5 14.039 185.5 11C185.5 14.039 187.961 16.5 191 16.5C187.965 16.5 185.5 18.9651 185.5 22Z",fill:"#F9EA9E",stroke:"#1F243C",strokeLinecap:"round",strokeLinejoin:"round"}),l.createElement("path",{d:"M239.5 128C239.5 124.961 237.039 122.5 234 122.5C237.039 122.5 239.5 120.039 239.5 117C239.5 120.039 241.961 122.5 245 122.5C241.965 122.5 239.5 124.965 239.5 128Z",fill:"#F9EA9E",stroke:"#1F243C",strokeLinecap:"round",strokeLinejoin:"round"}),l.createElement("path",{d:"M24.5 63C24.5 59.961 22.039 57.5 19 57.5C22.039 57.5 24.5 55.039 24.5 52C24.5 55.039 26.961 57.5 30 57.5C26.9651 57.5 24.5 59.9651 24.5 63Z",fill:"#F9EA9E",stroke:"#1F243C",strokeLinecap:"round",strokeLinejoin:"round"}),l.createElement("rect",{x:"263",y:"76",width:"63",height:"77",rx:"2",fill:"#1F243C",stroke:"#1F243C"}),l.createElement("rect",{x:"267",y:"72",width:"63",height:"77",rx:"2",fill:"#F9FAFF",stroke:"#1F243C"}),l.createElement("path",{d:"M318.759 89.7112H278",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M318.759 101.227H278",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M318.759 112.743H278.095",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M318.759 124.259H278",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("g",{style:{mixBlendMode:"multiply"},opacity:"0.4"},l.createElement("path",{d:"M318.759 101.227H278",stroke:"#41D9B5",strokeWidth:"10",strokeMiterlimit:"10"})),l.createElement("g",{style:{mixBlendMode:"multiply"},opacity:"0.4"},l.createElement("path",{d:"M305.43 112.743H278.095",stroke:"#41D9B5",strokeWidth:"10",strokeMiterlimit:"10"}))),l.createElement("defs",null,l.createElement("linearGradient",{id:"paint0_linear_"+this._idSuffix,x1:"148",y1:"32",x2:"148",y2:"144",gradientUnits:"userSpaceOnUse"},l.createElement("stop",{stopColor:"#26307D",stopOpacity:"0"}),l.createElement("stop",{offset:"1",stopColor:"#26307D",stopOpacity:"0.5"})),l.createElement("clipPath",{id:"clip0_"+this._idSuffix},l.createElement("rect",{width:"296",height:"144",fill:"white"}))))}}Pa._nextIdSuffix=0;var Oa=i(90295);const Ha=({layoutVM:e,readersAttentionVM:t})=>l.createElement(Bs,{dataPartName:"readers-attention-onboarding-overlay",layoutVM:e,panelClassName:Oa.onboardingPanel,contentClassName:Oa.onboardingPanelContent},l.createElement("div",{className:Oa.onboardingBanner},l.createElement(Pa,{className:Oa.onboardingBannerImage}),l.createElement("div",{className:Oa.onboardingHeader},"Readers attention",l.createElement(es,{title:"NEW",kind:"gold"})),l.createElement("div",{className:Oa.onboardingBannerMessage},"Make sure readers see what's important")),l.createElement("div",{className:Oa.onboardingContent},l.createElement("div",null,"Grammarly's reader attention heatmap predicts where people will pay close attention and where they'll skim:",l.createElement("ul",null,l.createElement("li",null,l.createElement("span",{className:Oa.heatmap},l.createElement("b",null,"Highlighted areas are most likely to be read."))),l.createElement("li",null,"Unhighlighted areas may be skimmed or skipped.")),"Strengthen your message by moving your key information into the highlighted areas."),t.showGetStarted&&l.createElement(pa.z,{kind:"success",onClick:()=>t.getStarted(),containerClassName:Oa.gettingStartedButton,dataGrammarlyPart:"readers-attention-get-started-button"},"Get started")));var Na=i(47960);const Ua=({feedbackVM:e,className:t})=>l.createElement(os.u,{showDelay:aa.gk,message:"Leave feedback"},l.createElement("div",Object.assign({},(0,P.Sh)(Rs.feedback_button,t),{onClick:()=>e.openFeedback(),"data-grammarly-part":"assistant-feedback-btn"}),l.createElement(Na.A,{color:x.Z.blue50}),"Anything we can improve?"));var Ba=i(36145);const Da=()=>l.createElement("svg",{width:"5",height:"5",viewBox:"0 0 5 5",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.createElement("circle",{cx:"2.5",cy:"2.5",r:"2.5",fill:x.Z.neutral90}));class qa extends l.Component{render(){return this._idSuffix=this._idSuffix||"clipboard_"+qa._nextIdSuffix++,l.createElement("svg",{width:"16",height:"17",viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.createElement("g",{clipPath:`url(#clip0_${this._idSuffix})`},l.createElement("path",{d:"M13.5 14.6001C13.5 15.1498 13.0677 15.6001 12.54 15.6001H3.46C2.93225 15.6001 2.5 15.1498 2.5 14.6001V2.85059C2.5 2.30084 2.93225 1.85059 3.46 1.85059H12.54C13.0677 1.85059 13.5 2.30084 13.5 2.85059V14.6001Z",fill:"#B47D56"}),l.createElement("path",{d:"M13.0661 15.35H3.43408V13.4585L12.6803 6.31396L13.0661 15.35Z",fill:`url(#paint0_linear_${this._idSuffix})`}),l.createElement("path",{d:"M3.32324 2.97559C3.32324 2.97559 3.40224 8.82509 3.25049 14.9751H12.75C12.664 8.82509 12.6772 2.97559 12.6772 2.97559H3.32324Z",fill:"white"}),l.createElement("path",{d:"M11.5 5.3501H6.5V5.6001H11.5V5.3501Z",fill:"#6E8189"}),l.createElement("path",{d:"M11.5 7.8501H6.5V8.1001H11.5V7.8501Z",fill:"#6E8189"}),l.createElement("path",{d:"M11.5 10.3501H6.5V10.6001H11.5V10.3501Z",fill:"#6E8189"}),l.createElement("path",{d:"M11.5 12.8501H6.5V13.1001H11.5V12.8501Z",fill:"#6E8189"}),l.createElement("path",{d:"M5.81201 2.87137C5.81201 2.87137 5.82276 2.39812 6.11126 2.29287C6.26901 2.23537 7.28751 1.91162 7.28751 1.91162C7.28751 1.91162 7.35926 2.85137 5.81201 2.87137Z",fill:"#B3C2C6"}),l.createElement("path",{d:"M10.1869 2.87137C10.1869 2.87137 10.1762 2.39812 9.88769 2.29287C9.73044 2.23537 8.71194 1.91162 8.71194 1.91162C8.71194 1.91162 8.64019 2.85137 10.1869 2.87137Z",fill:"#B3C2C6"}),l.createElement("path",{d:"M5.4936 2.46876C5.46235 2.38726 5.60835 2.36576 5.65435 2.40126C5.83685 2.54426 5.94085 2.61126 5.9746 2.61176C6.5781 2.62051 6.6231 2.53701 6.6646 2.63076C5.49885 3.06426 5.75285 3.13901 5.4936 2.46876Z",fill:"#6E8189"}),l.createElement("path",{d:"M10.506 2.46974C10.5372 2.38824 10.3912 2.36673 10.3457 2.40223C10.1632 2.54524 10.0592 2.61174 10.0249 2.61224C9.42145 2.62099 9.37645 2.53749 9.33545 2.63074C10.5012 3.06524 10.2472 3.13999 10.506 2.46974Z",fill:"#6E8189"}),l.createElement("path",{d:"M10.5055 2.8331C10.1408 2.7661 9.42651 2.6271 9.38551 2.6271C9.35476 2.6271 9.29901 2.57135 9.29901 2.5411C9.29901 2.34035 9.29901 1.92185 9.29901 1.75835C9.29901 1.65685 8.88501 1.48235 8.79376 1.3551C8.64926 1.15135 8.59401 0.600098 7.99951 0.600098C7.40526 0.600098 7.35001 1.15135 7.20501 1.3551C7.11426 1.48285 6.69976 1.65685 6.69976 1.75835C6.69976 1.92185 6.69976 2.34035 6.69976 2.5411C6.69976 2.57135 6.64401 2.6271 6.61376 2.6271C6.57226 2.6271 5.85851 2.76685 5.49326 2.8331C5.10801 2.90435 4.99951 3.6001 4.99951 3.6001H7.99951H10.9993C10.9993 3.6001 10.8908 2.90435 10.5055 2.8331ZM7.99951 1.5421C7.79251 1.5421 7.62451 1.3746 7.62451 1.1671C7.62451 0.959598 7.79251 0.792098 7.99951 0.792098C8.20701 0.792098 8.37451 0.959598 8.37451 1.1671C8.37451 1.3746 8.20701 1.5421 7.99951 1.5421Z",fill:`url(#paint1_linear_${this._idSuffix})`}),l.createElement("path",{d:"M7.99961 0.766602C7.77836 0.766602 7.59961 0.946352 7.59961 1.1671C7.59961 1.38785 7.77836 1.5676 7.99961 1.5676C8.22086 1.5676 8.39961 1.38785 8.39961 1.1671C8.39961 0.946352 8.22086 0.766602 7.99961 0.766602ZM7.99961 1.4531C7.84136 1.4531 7.71336 1.3251 7.71336 1.1666C7.71336 1.00885 7.84136 0.880352 7.99961 0.880352C8.15836 0.880352 8.28611 1.00885 8.28611 1.1666C8.28636 1.3251 8.15836 1.4531 7.99961 1.4531Z",fill:`url(#paint2_linear_${this._idSuffix})`}),l.createElement("path",{d:"M5.875 4.7251V5.9751H4.625V4.7251H5.875ZM6 4.6001H4.5V6.1001H6V4.6001Z",fill:"#6E8189"}),l.createElement("path",{d:"M5.875 7.2251V8.4751H4.625V7.2251H5.875ZM6 7.1001H4.5V8.6001H6V7.1001Z",fill:"#6E8189"}),l.createElement("path",{d:"M5.875 9.7251V10.9751H4.625V9.7251H5.875ZM6 9.6001H4.5V11.1001H6V9.6001Z",fill:"#6E8189"}),l.createElement("path",{d:"M5.875 12.2251V13.4751H4.625V12.2251H5.875ZM6 12.1001H4.5V13.6001H6V12.1001Z",fill:"#6E8189"}),l.createElement("path",{d:"M6.30128 4.66504C6.04928 4.74229 5.55128 4.98329 5.29353 5.55529C5.29353 5.55529 5.08803 5.28229 4.90578 5.20904C4.85403 5.20704 4.72278 5.21879 4.63428 5.31604C4.63428 5.31604 4.89353 5.39029 5.27978 5.97729C5.37303 5.91429 5.53128 5.81529 5.53128 5.81529C5.74378 5.14479 6.14403 4.83329 6.34328 4.70779C6.32953 4.69279 6.31603 4.67829 6.30128 4.66504Z",fill:"#E81C27"})),l.createElement("defs",null,l.createElement("linearGradient",{id:"paint0_linear_"+this._idSuffix,x1:"8.25008",y1:"15.35",x2:"8.25008",y2:"6.31419",gradientUnits:"userSpaceOnUse"},l.createElement("stop",{stopColor:"#1A1626",stopOpacity:"0.05"}),l.createElement("stop",{offset:"0.0917",stopColor:"#1A1626",stopOpacity:"0.0706"}),l.createElement("stop",{offset:"0.6667",stopColor:"#1A1626",stopOpacity:"0.2"})),l.createElement("linearGradient",{id:"paint1_linear_"+this._idSuffix,x1:"7.99939",y1:"3.6001",x2:"7.99939",y2:"0.600098",gradientUnits:"userSpaceOnUse"},l.createElement("stop",{stopColor:"#7E8A8F"}),l.createElement("stop",{offset:"0.0221",stopColor:"#9CA7AC"}),l.createElement("stop",{offset:"0.0502",stopColor:"#BBC6CB"}),l.createElement("stop",{offset:"0.0777",stopColor:"#D1DBE0"}),l.createElement("stop",{offset:"0.1038",stopColor:"#DEE9EE"}),l.createElement("stop",{offset:"0.1273",stopColor:"#E3EDF2"}),l.createElement("stop",{offset:"0.2545",stopColor:"#CFD8DD"}),l.createElement("stop",{offset:"0.4655",stopColor:"#CCD5DA"}),l.createElement("stop",{offset:"0.6185",stopColor:"#C3CCD1"}),l.createElement("stop",{offset:"0.7531",stopColor:"#B3BDC2"}),l.createElement("stop",{offset:"0.8766",stopColor:"#9DA8AD"}),l.createElement("stop",{offset:"0.9924",stopColor:"#808C91"}),l.createElement("stop",{offset:"1",stopColor:"#7E8A8F"})),l.createElement("linearGradient",{id:"paint2_linear_"+this._idSuffix,x1:"7.99961",y1:"1.56738",x2:"7.99961",y2:"0.766602",gradientUnits:"userSpaceOnUse"},l.createElement("stop",{stopColor:"#D9E3E8"}),l.createElement("stop",{offset:"0.1606",stopColor:"#D5DFE3"}),l.createElement("stop",{offset:"0.3396",stopColor:"#C7D1D6"}),l.createElement("stop",{offset:"0.5274",stopColor:"#B2BBC0"}),l.createElement("stop",{offset:"0.7214",stopColor:"#939DA1"}),l.createElement("stop",{offset:"0.9182",stopColor:"#6C7679"}),l.createElement("stop",{offset:"1",stopColor:"#5A6366"})),l.createElement("clipPath",{id:"clip0_"+this._idSuffix},l.createElement("rect",{width:"16",height:"16",fill:"white",transform:"translate(0 0.100098)"}))))}}qa._nextIdSuffix=0;var Ga=i(60430),Za=i(91197);const za=({viewModel:e})=>{const t=e.height.pipe(g.U(ee.fold(W.constUndefined,(()=>Za.animateChecklistHeightChanges))));return l.createElement(P.F.div,Object.assign({},(0,P.Sh)(Za.checklistAnimationWrapper,t),{style:{height:e.height.pipe(g.U(ee.getOrElse(W.constUndefined)))}}),F.UI.mount(Ka,function(e){return Ge.Z.animatingFlow(e,((e,t)=>ee.isNone(e)?ee.none:e.value.kind===t.kind?ee.some(hs.both("fadeOutContentChange","fadeInContentChange")):"expanded"===t.kind?ee.some(hs.both("fadeOut","expand")):ee.some(hs.both("collapse","fadeIn"))))}((i=e,Ge.Z.fromSideEffect((({action:e})=>{switch(e.kind){case"expand":i.expand();break;case"height":i.changeHeight(e.height);break;default:(0,qe.vE)(e)}}),i.state.pipe(g.U((e=>({kind:e.collapsed?"collapsed":"expanded",items:e.items})))))))));var i},Wa=F.UI.Node.make((({view:e,notify:t})=>{const i=e("items").pipe(g.U((e=>e.filter((e=>e.checked))))),s=e("items").pipe(g.U((e=>e.filter((e=>!e.checked))))),a=new Ye.t;return Ga.P.useSubscriptionTo(a.pipe(h.w((e=>le.YC(e).pipe(g.U((()=>e.offsetHeight)),m.O(e.offsetHeight)))),_.b((e=>t({kind:"height",height:e})())))),l.createElement("div",{className:Za.checklistExpanded,ref:e=>{null!==e&&a.next(e)},"data-grammarly-part":"attention-checklist-expanded"},l.createElement(P.F.Fragment,null,s.pipe(g.U((e=>l.createElement(l.Fragment,null,e.length>0&&l.createElement("div",{className:Za.checklistGroupHeader},"Room for improvement"),e.map((({message:e},t)=>l.createElement(ja,{checked:!1,key:t,message:e})))))))),l.createElement(P.F.Fragment,null,i.pipe(g.U((e=>l.createElement(l.Fragment,null,e.length>0&&l.createElement("div",{className:Za.checklistGroupHeader},"What's good"),e.map((({message:e},t)=>l.createElement(ja,{checked:!0,key:t,message:e})))))))))})),ja=({message:e,checked:t})=>l.createElement("div",{className:Za.checklistItem},l.createElement("div",{className:Za.itemBullet},t?l.createElement(Ba.x,{width:12,height:12}):l.createElement(Da,null)),l.createElement("div",Object.assign({},(0,P.Sh)(Za.itemText,t&&Za.checked)),e)),Xa=F.UI.Node.make((({view:e,notify:t})=>{const i=e("items").pipe(g.U((0,W.flow)((e=>ee.fromNullable(e.filter((e=>!e.checked)).concat(e.filter((e=>e.checked)))[0])),ee.map((e=>e.message))))),s=new Ye.t;return Ga.P.useSubscriptionTo(s.pipe(h.w((e=>le.YC(e).pipe(g.U((()=>e.offsetHeight)),m.O(e.offsetHeight)))),_.b((e=>t({kind:"height",height:e})())))),l.createElement("div",{className:Za.checklistCollapsed,ref:e=>{null!==e&&s.next(e)},"data-grammarly-part":"attention-checklist-collapsed"},l.createElement(T.M,{clickHandler:t({kind:"expand"}),style:{display:"block"}},l.createElement("div",{className:Za.checklistHeader},l.createElement(qa,null),l.createElement(P.F.div,{className:Za.checklistTitle},e("items").pipe(g.U((e=>`Checklist: ${e.filter((e=>e.checked)).length} of ${e.length} completed`))))),l.createElement(P.F.div,{className:Za.checklistFirstItemPreview},i.pipe(g.U(ee.getOrElse((()=>"")))))))})),Ya=F.UI.Union.make("kind",{collapsed:Xa,expanded:Wa}),Qa=F.UI.Transition.make({fadeIn:Za.fadeIn,fadeInContentChange:Za.fadeInContentChange,expand:Za.expand},{fadeOut:Za.fadeOut,fadeOutContentChange:Za.fadeOutContentChange,collapse:Za.collapse}),Ka=F.UI.Animated.make(Qa,Ya);var $a=i(41439),Ja=i(82318);const er=l.forwardRef((({viewModels:e,readersAttentionVM:t,checklistVM:i,headerVM:s},a)=>l.createElement(Bs,{dataPartName:"readers-attention-view-overlay",layoutVM:e.assistantLayoutViewModel,panelClassName:Us.gradientViewOverlayPanel},l.createElement(Ns,{key:"takeawaysPredictionCardList",ref:a,viewModels:e,className:Ja.cardList,header:l.createElement(tr,{readersAttentionVM:t,checklistVM:i,headerVM:s}),footer:l.createElement(Ua,{feedbackVM:e.assistantFeedbackViewModel})})))),tr=({readersAttentionVM:e,checklistVM:t,headerVM:i})=>{const s=i.message.view((e=>({content:e})));return l.createElement(l.Fragment,null,l.createElement("div",{className:Us.defaultViewOverlayHeader},l.createElement("div",{className:Ja.headerGroup},"Readers attention",l.createElement("div",{onClick:()=>e.showHelp(),className:Ja.questionMarkButton,"data-grammarly-part":"readers-attention-question-mark-button"},l.createElement($a.JO.QuestionMark,{width:12,className:Ja.questionMarkIcon}))),l.createElement(es,{title:"BETA",kind:"success"})),l.createElement(us,{summaryVM:{summary:s},className:Ja.summaryWrapper}),l.createElement("div",{className:Ja.message},"Put your main points in the"," ",l.createElement("div",{onClick:()=>e.showHelp(),className:Ja.inlineButton},"green areas"),"."),l.createElement("div",{className:Zs.relatedSuggestionsTitle},"SUGGESTIONS"),l.createElement(za,{viewModel:t}))};var ir=i(19106),sr=i(26485),ar=i(17324),rr=i(68089);const nr=({children:e,blocked:t,wrapperClassName:i})=>t?l.createElement(os.u,{message:"Sign in to use this feature",position:"top"},l.createElement("div",{className:i},l.createElement("div",{className:rr.hover_blocker,onClick:qe.EI,onDoubleClick:qe.EI},e))):l.createElement(l.Fragment,null,e);class or extends l.Component{constructor(){super(...arguments),this.handleChange=e=>{(this.props.skipTrustedCheck||e.isTrusted)&&this.props.onChange(e)}}render(){return l.createElement("div",Object.assign({},(0,P.Sh)(this.props.extraClassName,sr.setting_item,this.props.disabled&&sr.disabled)),l.createElement("label",{className:sr.select_checkbox,"data-grammarly-part":this.props.dataGrammarlyPart},l.createElement("div",null,this.props.children,this.props.beta&&l.createElement("span",{className:(0,Gs.G6)()?sr.new:sr.beta})),l.createElement(nr,{wrapperClassName:sr.checkbox_control_wrapper,blocked:this.props.disabled}),l.createElement("input",{className:sr.checkbox,onChange:this.props.disabled?qe.EI:this.handleChange,checked:this.props.checked,type:"checkbox"}),l.createElement("div",Object.assign({},(0,P.Sh)(sr.checkbox_check,this.props.grayOut&&sr.grayOut,this.props.checked?sr.on:sr.off)),l.createElement("div",Object.assign({},(0,P.Sh)(sr.on_off)),this.props.checked?"ON":"OFF"),l.createElement("div",{className:sr.checkbox_check_round}))),l.createElement("div",{className:sr.bottom_line}))}}var lr=i(33057),cr=i(47740);const dr=({showTitle:e,openGBLanding:t})=>l.createElement("div",{className:cr.container},l.createElement("div",{className:cr.contant},e&&l.createElement("div",{className:cr.title},"Grammarly for your team"),l.createElement("div",null,"Help your team make your business look great with top-notch writing."),l.createElement("div",{className:cr.spacer}),l.createElement(pa.z,{size:"medium",onClick:()=>{t((0,Gs.Um)().businessEHomepage),(0,lr.T)().gGbUpHookClick()}},"Explore Grammarly Business")));var pr=i(4120),hr=i(26386);const mr=new Proxy({},{get:(e,t)=>(...e)=>hr.emitBackground("gnar-track",{method:t,props:e})});class ur extends l.Component{constructor(){super(...arguments),this.onEnableDefsClick=e=>{const{toggleDefs:t}=this.props,i=e.target.checked;t(i),mr.definitionToggleClick(i?"on":"off"),(0,lr.T)().toggleExtensionDefs(i)}}render(){const{enabledDefs:e,disabled:t}=this.props;return l.createElement(or,{onChange:this.onEnableDefsClick,checked:e,extraClassName:ar.def_switcher,dataGrammarlyPart:"definitionAndSynonymsSwitcher",disabled:t,skipTrustedCheck:this.props.skipTrustedCheck},"Show definitions and synonyms ",l.createElement("br",null),"via double clicks (all sites)")}}var gr=i(6304),fr=i(66402);const _r=()=>l.createElement("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.createElement("path",{d:"M13.9207 15L15.5 17.2562L17.0793 15H13.9207Z",stroke:"#6D758D",strokeWidth:"2"}));var vr=i(39499),wr=i(32577),yr=i(71527);const Er={american:l.createElement((()=>l.createElement("div",{className:fr.american,role:"presentation"})),null),australian:l.createElement((()=>l.createElement("div",{className:fr.australian,role:"presentation"})),null),british:l.createElement((()=>l.createElement("div",{className:fr.british,role:"presentation"})),null),canadian:l.createElement((()=>l.createElement("div",{className:fr.canadian,role:"presentation"})),null)},Cr=["british","american","australian","canadian"],br=e=>{return l.createElement(l.Fragment,null,Er[e.dialect],l.createElement("span",{"data-test-attr":"dialect_"+e.dialect,className:yr.label},(t=e.dialect).charAt(0).toUpperCase()+t.slice(1)+" English"));var t};class Sr extends l.Component{render(){const e=this.props.dropdownOnTop?{customPosition:{top:"-100px",left:"0"},vAlign:"top"}:{customPosition:{top:"36px",left:"0"}};return l.createElement(wr.L,Object.assign({},e,{showDelay:0,closeDelay:150,appearanceBehavior:"mouseClick",name:"dialect",label:l.createElement(vr.zx.White,{name:"dialect.box",style:{padding:"0"}},l.createElement("div",{className:yr.selected},l.createElement(br,{dialect:this.props.dialect}),l.createElement(_r,null)))}),Cr.filter((e=>e!==this.props.dialect)).map((e=>l.createElement(vr.zx.Flat,{name:e,onClick:()=>this.props.onSetDialect(e),key:e},l.createElement("div",{className:yr.option},l.createElement(br,{dialect:e}))))))}}class kr extends l.Component{constructor(){super(...arguments),this.setDialect=e=>{const{changeStrongDialect:t,dialectWeak:i}=this.props;t(e);const s=e+"English";mr.languageSettingUpdate(s,"user",i&&e===i)}}render(){const e=this.props.dialectStrong||this.props.dialectWeak||"american";return l.createElement("div",Object.assign({},(0,P.Sh)(gr.line,this.props.disabled&&gr.disabled)),l.createElement("div",null,"I write in"),l.createElement(nr,{blocked:this.props.disabled},l.createElement("div",{className:gr.dialectPicker},l.createElement(Sr,{dialect:e,onSetDialect:this.setDialect,dropdownOnTop:!!this.props.dropdownOnTop}))))}}const xr=({toggleHotkeys:e,enabledHotkeys:t})=>{const i=((0,Gs.ED)()?"Alt":"Ctrl")+" + g";return l.createElement(or,{onChange:t=>{const i=t.target.checked;e(i),mr.hotkeyToggleClick(i?"on":"off")},checked:t,extraClassName:ar.hotkeys},l.createElement("span",{className:ar.shortcut_title},"Shortcut:")," Open Popup editor ",l.createElement("br",null),l.createElement("span",{className:ar.shortcut},i))},Mr=e=>{var t;const i="docs.google.com"===e.domain,s=i?"Google Docs":e.domain,a=i&&(null===(t=e.experiments)||void 0===t?void 0:t.anonUserGDocsSidebar),{enabledInConfig:r,siteSwitcherChecked:n,favicon:o}=e,c=n.checked&&r,d=r?"Check for writing suggestions":"Checking is not supported";return l.createElement(or,{grayOut:!r,onChange:e=>n.update(e.target.checked),checked:c,extraClassName:ar.site_switcher,dataGrammarlyPart:"siteSwitcher",skipTrustedCheck:e.skipTrustedCheck},l.createElement("div",{"data-test-attr":"siteControlsLabelText"},d,l.createElement("br",null)," ",l.createElement("span",{className:ar.domain},l.createElement("span",{className:ar.thin_text},"on"),"",o&&l.createElement("span",{className:ar.favicon},l.createElement("img",{width:"16px",height:"16px",src:o})),s,a&&l.createElement("span",{className:sr.beta}))))};var Ar=i(37896),Lr=i(23345);const Ir=l.createContext({}),Tr=e=>{const t=l.useContext(Ir),{registrationDate:i}=e.user,s=(0,Ar.p6)(i);return l.createElement("div",{className:Lr.line},l.createElement("div",{className:Lr.content},s&&l.createElement("div",{"data-test-attr":"checked_since"},"Grammarly has been correcting your text since ",s,"."),l.createElement("div",{className:Lr.upgrade,onClick:()=>{e.openSubscriptionDialog({utmSource:"upHook",utmCampaign:"extensionSettingsToolbar"}),mr.getPremiumButtonClick("settingsToolbar"),(0,lr.T)().userUpgradeClick("settingsToolbar")},style:{fontSize:t.ctaFontSize}},"Go Premium to Enable Advanced Fixes")))},Rr=e=>l.createElement(or,{onChange:t=>{e.toggle(t.target.checked)},checked:e.enabled,extraClassName:ar.def_switcher},"Correct spelling automatically"),Fr=e=>l.createElement("div",Object.assign({},(0,P.Sh)(sr.setting_item,ar.userPanel,ar.def_switcher)),l.createElement("span",Object.assign({},(0,P.Sh)(ar.link,ar.blue)),l.createElement(T.M,{clickHandler:e.handleClick},"Turn extension back on in Chrome"))),Vr=e=>l.createElement(or,{onChange:t=>{e.toggle(t.target.checked)},beta:!0,checked:e.enabled,extraClassName:ar.def_switcher},"Show phrasal predictions"),Pr=e=>{var t;const{actions:i,activeTab:s,config:a,settings:r,user:n,siteCategory:o,openSubscriptionDialog:c,openGBLanding:d,showGBUpHook:p,placement:h,showAutocorrectToggle:m,enableRenderingHack:u=!1}=e;u&&l.useEffect((()=>{(0,Gs.CB)()&&(window.screenLeft<0||window.screenTop<0||window.screenLeft>window.screen.width||window.screenTop>window.screen.height)&&chrome.runtime.getPlatformInfo((e=>{if("mac"===e.os){const e=new CSSStyleSheet;e.insertRule("\n            @keyframes redraw {\n              0% {\n                opacity: 1;\n              }\n              100% {\n                opacity: .99;\n              }\n            }\n          "),e.insertRule("\n            html {\n              animation: redraw 1s linear infinite;\n            }\n          "),document.adoptedStyleSheets=[...document.adoptedStyleSheets,e]}}))}),[]);const{premium:g,experiments:f,anonymous:_}=n,v=p&&g&&!pr.n5.doesUserBelongToInstitution(n),w=g||_,y=f&&f.hotkeysExperiment,E=e.siteSwitcherChecked||{checked:!!r.enabled,update:t=>{const{siteCategory:s}=e;i.toggleSite(t,a.domain),mr.checkingToggleClick("toolbar",s,t?"on":"off"),(0,lr.T)().toggleExtension(t,"toolbar")}};return l.createElement("div",null,r.isLlamaInstalled&&!r.isLlamaDisabled&&l.createElement(Fr,{handleClick:i.disableLlama}),l.createElement(Mr,{domain:a.domain,enabledInConfig:a.enabled,siteSwitcherChecked:E,favicon:null==s?void 0:s.favIconUrl,siteCategory:o,experiments:f}),l.createElement(ur,{disabled:_,enabledDefs:r.enabledDefs,toggleDefs:i.toggleDefs}),y&&l.createElement(xr,{enabledHotkeys:r.enabledHotkeys||!1,toggleHotkeys:i.toggleHotkeys}),m&&l.createElement(Rr,{enabled:r.autocorrectEnabled||!1,toggle:e=>{i.toggleAutocorrect(e),mr.autocorrectToggleClick(e?"on":"off")}}),(null===(t=n.experiments)||void 0===t?void 0:t.autocompleteEnabled)&&l.createElement(Vr,{enabled:r.autocompleteEnabled||!1,toggle:e=>{i.toggleAutocomplete(e),mr.autocompleteFeatureToggleClick("popup",e?"on":"off")}}),l.createElement(kr,{changeStrongDialect:i.changeStrongDialect,dialectStrong:r.dialectStrong,dialectWeak:r.dialectWeak,dropdownOnTop:w,disabled:_}),!w&&l.createElement(Tr,{user:n,openSubscriptionDialog:c}),v&&l.createElement(dr,{openGBLanding:d,showTitle:"popup"===h}))};var Or=i(32138),Hr=i(82785),Nr=i(91574);const Ur=({viewModels:e})=>{const{domain:t,actions:i,state:s}=e.assistantSettingsViewModel,[a,r]=l.useState(!!s.view("commonSettings","enabled").get()),n={checked:a,update:r};return l.createElement(Bs,{dataPartName:"settings-view-overlay",layoutVM:e.assistantLayoutViewModel,panelClassName:Us.gradientViewOverlayPanel,footer:l.createElement(pa.z,{containerClassName:Nr.settingsDoneButton,kind:"success",type:"submit",onClick:()=>{i.toggleSite(a,t),ir.J.checkingToggleClick("assistant",Hr.y.other,a?"on":"off"),(0,lr.T)().toggleExtension(a,"assistant"),e.assistantLayoutViewModel.popActiveView()},style:{height:"32px"}},"Done")},l.createElement("div",{className:Us.gradientViewOverlayContent},l.createElement("div",{className:Us.defaultViewOverlayHeader},"Settings"),l.createElement(P.F.Fragment,null,s.view((({user:a,commonSettings:r})=>{var o;return l.createElement(Ir.Provider,{value:{ctaFontSize:13}},l.createElement(Pr,{actions:i,config:{enabled:!0,domain:t},settings:r,user:a,siteCategory:Hr.y.other,openSubscriptionDialog:()=>e.upgradeViewModel.openUpgradeUrl(Le.Place.extensionSettingsAssistant),openGBLanding:e=>{const t=(0,Or.Z4)(e,"gbExtensionSettingsAssistant");window.open(t)},showGBUpHook:(0,Gs.i7)(),placement:"assistant",showAutocorrectToggle:(0,Gs.i7)()||!!(null===(o=s.view("user","experiments").get())||void 0===o?void 0:o.autoCompleteCorrectAllBrowsers),siteSwitcherChecked:n}))}))),l.createElement(Ua,{feedbackVM:e.assistantFeedbackViewModel})))};var Br,Dr=i(77256),qr=i(94503),Gr=i(57175);!function(e){let t;!function(e){e.isAppleSystem="isAppleSystem"}(t=e.SidebarFlag||(e.SidebarFlag={})),e.Flag={...t,...qr.a.Flag},e.Context=l.createContext(Gr.S.invariantContent("Environment"))}(Br||(Br={}));class Zr{constructor(){this._flags=new Set,this.actions={openUrl:()=>{throw new Error("Not implemented")},openPopup:()=>{throw new Error("Not implemented")}};(0,Dr.O)().config.systemInfo.os.isMac&&this._flags.add(Br.Flag.isAppleSystem),this._flags.add(Br.Flag.supportsSVGDominantBaseline),this._flags.add(Br.Flag.onlyTrustedEvents)}has(e){return this._flags.has(e)}}const zr=({modalManager:e})=>l.createElement(P.F.Fragment,null,e.state.view((0,W.flow)(ee.map((({component:e})=>e)),ee.toNullable)));var Wr=i(93583);const jr=({children:e,remSize:t,setter:i})=>(Xr+=1,l.useEffect((()=>{const e=t.subscribe((e=>{Yr.next(ee.some(e)),i(ee.some(e))}));return()=>{e.unsubscribe(),Xr-=1,0===Xr&&(Yr.next(ee.none),i(ee.none))}}),[t]),l.createElement(Wr.u.Context.Provider,{value:Yr.pipe(oe.oA)},e));let Xr=0;const Yr=new je.X(ee.none);var Qr=i(48189),Kr=i(79850);i(75259),i(67129);const $r=({children:e})=>l.createElement(l.Fragment,null,l.createElement("div",{"data-grammarly-part":"gdocs-sidebar",className:Kr.wrapper},e),l.createElement(Qr.p,{thin:!0,thinItalic:!0,regular:!0,italic:!0,bold:!0,boldItalic:!0,semiBold:!0}));var Jr=i(63544),en=i(17161),tn=i(67521),sn=i(66831),an=i(17674),rn=i(89068),nn=i(83305);const on=l.memo((({viewModels:e,emogenieService:t,height:i,ready:s,OuterElementsPortalSource:a})=>{const r=new Zr;(0,He.iR)("viewModels",e);const n=(0,se.IQ)(),c=l.useContext(se.Dg).state.pipe(w.h((e=>!e.dragging)),m.O(Jr.zM)),d=l.useContext(en.Y),p=P.hg.create(Ce.UL.empty),{initialPositionOffset:h}=e.positionViewModel;(0,tn.A)((0,de.aj)([c,d]).pipe(g.U((([e,t])=>({height:t.height,width:t.width,top:t.top+e.translate.y+h.top,left:t.left+e.translate.x+h.left,bottom:t.top+t.height+e.translate.y,right:t.left+t.width+e.translate.x}))),_.b(ne.wW(p)))),(0,tn.A)(c.pipe(_.b((t=>e.positionViewModel.onDrag(t))))),(0,tn.A)(e.assistantLayoutViewModel.activeView.pipe(v.G(),_.b((([t,i])=>{t.type!==i.type&&i.type===tt.aH.Type.default&&e.cardsListScrollManager.paddingTop.set(0)}))));const u=l.useRef(null);return l.useEffect((()=>{e.assistantCardListViewModel.cardListContext.next(ee.fromNullable(u.current));const t=u.current?le.rl(u.current,{subtree:!0,childList:!0}):Nt.C,i=p.view((e=>({top:e.top,left:e.left}))),a=(0,o.pipe)(t,rn.V((0,nt.m9)(1)),Qe.b(10),$e.P()).subscribe((()=>s(i,n)),(()=>{s(i,n,!0)}));return()=>{a.unsubscribe()}}),[]),l.createElement(ln,{environment:r,viewport:d.pipe(g.U((e=>({height:e.height,width:e.width,top:e.top,left:e.left,bottom:e.top+e.height,right:e.left+e.width}))))},l.createElement(P.F.div,Object.assign({"data-grammarly-part":"assistant-popup-content"},(0,P.Sh)(Rs.assistant,n.pipe(m.O(!1),g.U((e=>e&&Rs.dragging)))),{style:{height:i,maxHeight:"90vh"}}),l.createElement(ca,{viewModels:e}),e.assistantLayoutViewModel.activeView.view((i=>i.type===tt.aH.Type.default?l.createElement(Ps,{viewModels:e,ref:u,key:"default-view"}):i.type===tt.aH.Type.emogenie?l.createElement(zs,{emogenieService:t,viewModels:e,key:"emogenie-view",ref:u}):i.type===tt.aH.Type.readersAttention?l.createElement(er,{viewModels:e,readersAttentionVM:e.readersAttentionViewModel,checklistVM:e.readersAttentionChecklistViewModel,headerVM:e.readersAttentionHeaderViewModel,key:"readers-attention-view",ref:u}):i.type===tt.aH.Type.readersAttentionOnboarding?l.createElement(Ha,{layoutVM:e.assistantLayoutViewModel,readersAttentionVM:e.readersAttentionViewModel,key:"readers-attention-onboarding"}):i.type===tt.aH.Type.feedback?l.createElement(Xs,{feedbackVM:e.assistantFeedbackViewModel,layoutVM:e.assistantLayoutViewModel,key:"feedback-view"}):i.type===tt.aH.Type.settings?l.createElement(Ur,{viewModels:e,key:"settings-view"}):i.type===tt.aH.Type.proofitRequest&&ee.isSome(e.assistantProofitViewModel)?l.createElement(Ia,{layoutVM:e.assistantLayoutViewModel,proofitVM:e.assistantProofitViewModel.value,key:"proofit-request-view"}):i.type===tt.aH.Type.proofitReview&&ee.isSome(e.assistantProofitViewModel)?l.createElement(Va,{layoutVM:e.assistantLayoutViewModel,proofitVM:e.assistantProofitViewModel.value,key:"proofit-review-view"}):i.type===tt.aH.Type.popup?l.createElement(Ea,{key:"popup-view",viewModels:e}):null))),l.createElement(a,null,l.createElement($r,null,l.createElement(zr,{modalManager:e.assistantModalManager}))),l.createElement(an.X,null))})),ln=({environment:e,viewport:t,children:i})=>{const s=l.useRef((0,ji.I)(xs.m.getConfig(e.has(Br.Flag.isAppleSystem)?"mac":"windows")));return l.createElement(jr,{remSize:d.of(16),setter:e=>Wr.u.setRootCssVar(document.documentElement,e)},l.createElement(Br.Context.Provider,{value:e},l.createElement(qr.a.Context.Provider,{value:e},l.createElement(ji.O.Context.Provider,{value:s.current.assistant},l.createElement(xs.m.Context.Provider,{value:s.current.denali},l.createElement(nn.TG.ContextMock,null,l.createElement(Es.l.RootVirtualContainer,{viewport:t,name:"draggable"},l.createElement(sn.G.DefaultProvider,null,l.createElement($r,null,i)))))))))};var cn=i(53447);const dn=e=>{const{assistantLayout:t,textFieldRect:i,viewModels:s,emogenieService:a,ready:r,height:n,OuterElementsPortalSource:o}=e,{initialPositionOffset:c}=s.positionViewModel,d={...i.client,...i.size},p=(0,cn.C7)();return l.createElement(se._l,{bounds:p,hasDragHandle:!0},(({translate:e})=>l.createElement(en.s,{anchorRect:d,viewportRect:p,anchorOrigin:t.anchorOrigin,elementOrigin:t.assistantOrigin,anchorMargin:t.anchorMargin,repositioning:t.repositioningStrategy,stickToTarget:!1,viewportMargin:0,postRepositioningOffset:{horizontal:c.left+e.x,vertical:c.top+e.y}},(({top:t,left:i})=>l.createElement("div",{"data-grammarly-part":"assistant-popup",style:{position:"fixed",top:t-e.y,left:i-e.x,transform:`translate(${e.x}px, ${e.y}px)`,zIndex:aa.Eq}},l.createElement(on,{viewModels:s,emogenieService:a,height:n,ready:r,OuterElementsPortalSource:o}))))))};var pn=i(39485),hn=i(84966);(0,pn.C)();class mn{constructor(e,t){this._params=e,this._felog=t,this._log=y.Y.create(mn.name),this._integration=null,this._viewModels=P.hg.create(null),this._assistantPopupIsReady=new c.xQ,this._initPerformance=void 0,this._openMeasure=void 0,this._height=P.hg.create(0),this.isOpen=P.hg.create(!1),this._subs=new We.w.Keeper,this.open=async(e,t,i,s)=>{var a,r;const n=this._viewModels.get();if(null!==n)un(!0,n,e,i,s);else{this._openMeasure=this._felog.openTime.startMeasure();const t=this._felog.initTime.startMeasure(),n=this._params.assistantService,l=n.createIntegration();if(!l)return this._log.warn("tried to open assistant with checking service not initialized"),t.cancelMeasure(),void this._openMeasure.cancelMeasure();null===(r=(a=this._params).onOpen)||void 0===r||r.call(a,l),this._integration=l;const c=this._params.contentScriptState.view("user").view((e=>({isPremium:e.premium,isAnonymous:e.anonymous,experiments:e.experiments,customFields:e.customFields}))),d=Wi(l.engine,l.denaliViewAdapter,l.document.settings.lens("selectedLens"),this._params.emogenieService,n.goalPrediction,ee.fromNullable(this._params.readersAttentionFeature),ee.fromNullable(this._params.proofitFeature),n.sidebarEvents,this._assistantPopupIsReady,(0,o.pipe)(ee.fromNullable(e),ee.map(hn.wQ.Id.create)),this._params.contentScriptState,this._params.contentScriptActions,this._params.gnar,this._params.domain,c,this.close,this._params.assistantService.selectedHighlightsTracker,this._params.assistantService.isTextFieldEmpty,this._params.assistantService.positionModel,this._params.browser);un(!1,d,e,i,s),this._initPerformance=t.endMeasure(),this._viewModels.set(d)}},this.close=()=>{var e,t,i,s;null!==this._viewModels.get()&&(this._trackAssistantClose(),null===(t=(e=this._params).onClose)||void 0===t||t.call(e),this.isOpen.set(!1),null===(i=this._integration)||void 0===i||i.dispose(),this._integration=null,null===(s=this._viewModels.get())||void 0===s||s.dispose(),this._viewModels.set(null))},this._getReadyFn=()=>{const e=this._felog.renderTime.startMeasure();return(t,i,s)=>{const a=e.endMeasure();s&&this._openMeasure.cancelMeasure();const r=this._openMeasure.endMeasure();r&&r.duration>500&&this._log.warn("assistant popup took too long to open:",{init:this._initPerformance.duration,render:a.duration,total:r.duration}),setTimeout((()=>{this.isOpen.set(!0),this._assistantPopupIsReady.next(),this._trackAssistantOpen(t,null==r?void 0:r.duration),this._trackAssistantDrag(t,i)}),0)}},this._applyIframeOffset=e=>{var t,i;const s=null===(i=(t=this._params).getCustomOffset)||void 0===i?void 0:i.call(t);return s?{...e,size:{width:s.width,height:s.height},client:{...e.client,left:s.left+e.client.left,top:s.top+e.client.top},offset:{...e.offset,left:s.left+e.offset.left,top:s.top+e.offset.top},page:{...e.page,left:s.left+e.page.left,top:s.top+e.page.top}}:e}}get view(){return this._viewModels.pipe((0,h.w)((e=>null===e?(0,d.of)(null):(0,p.R)(window,"resize").pipe((0,m.O)(null),(0,u.M)(this._params.layout.textField.rect.behavior),(0,g.U)((([t,i])=>{const s=this._applyIframeOffset(i),a=((e,t)=>{const i=Me(e.lensState,e.cardsListScrollManager),s=Math.max(600,t.size.height+C.O.headerHeight+C.O.panelHeight);return i.pipe((0,u.M)(e.predictionsPreviewViewModel.previewState),(0,g.U)((([e,t])=>{if(t.kind!==L.visible)return e;const i=[t.readersAttention,t.tone].filter(ee.isSome).length;return i>0?e+C.O.predictionsPreviewHeaderHeight+C.O.predictionInsightHeight*i:e})),(0,m.O)(0),(0,g.U)((e=>Math.max(e+C.O.headerHeight,s))),(0,g.U)((e=>Math.min(e,750))))})(e,s).pipe((0,f.R)(this._assistantPopupIsReady.asObservable()),(0,_.b)(ne.wW(this._height)));return l.createElement(dn,{textFieldRect:s,assistantLayout:this._params.layout.assistant,height:a,viewModels:e,emogenieService:this._params.emogenieService,ready:this._getReadyFn(),OuterElementsPortalSource:this._params.OuterElementsPortalSource})}))))))}get activeView(){return this._viewModels.pipe((0,h.w)((e=>{var t;return null!==(t=null==e?void 0:e.assistantLayoutViewModel.activeView)&&void 0!==t?t:(0,d.of)(null)})))}dispose(){this.close(),this._subs.dispose()}_trackAssistantOpen(e,t){const i=this._viewModels.get();if(null!=i){const{initialPositionOffset:s}=i.positionViewModel,{statisticsService:a}=this._params,r=a.alertCounts.get(),n=0===s.top&&0===s.left?"default"===this._params.layout.assistant.name?"smart":"hardcoded":"sticky",o=i.assistantLayoutViewModel.activeView.get();this._params.gnar.assistantPopupShow(o.type,this._height.get(),e.get().left,e.get().top,r.expandedViewSupported,r.freeClarity,r.critical,r.filter((e=>"priority"===e.assistantView)).expandedViewSupported,a.wordsCount.get(),n,o.type===tt.aH.Type.popup?o.popupType:void 0,t,a.generalScore.get())}}_trackAssistantClose(){var e;const{statisticsService:t}=this._params,i=t.alertCounts.get(),s=(null===(e=this._viewModels.get())||void 0===e?void 0:e.assistantLayoutViewModel.activeView.get())||{type:tt.aH.Type.default};this._params.gnar.assistantPopupCloseButtonClick(s.type,i.expandedViewSupported,i.freeClarity,i.critical,i.filter((e=>"priority"===e.assistantView)).expandedViewSupported,s.type===tt.aH.Type.popup?s.popupType:void 0)}_trackAssistantDrag(e,t){const i=e.get();let s=i;this._subs.push(t.pipe((0,v.G)(),(0,w.h)((([e,t])=>e&&!t))).subscribe((()=>{const t=e.get();vt.E9.l1Distance(t,s)<10||(this._params.gnar.assistantPopupDrag(t.left,t.top,this._height.get(),i.left,i.top),s=t)})))}}function un(e,t,i,s,a){s===E.R.emogenie?t.assistantLayoutViewModel.pushActiveView({type:tt.aH.Type.emogenie}):s===E.R.proofitRequest?t.assistantLayoutViewModel.pushActiveView({type:tt.aH.Type.proofitRequest}):s===E.R.proofitReview?t.assistantLayoutViewModel.pushActiveView({type:tt.aH.Type.proofitReview}):s===E.R.takeawayCard&&i?t.readersAttentionViewModel.open({type:tt.T5.Type.inlineCard,alertId:i}):!e&&s===E.R.assistantPopupService&&a&&t.assistantLayoutViewModel.pushActiveView({type:tt.aH.Type.popup,popupType:a})}var gn=i(34311);class fn{constructor(e){this._originalHoverProvider=e,this._assistantHoverProviderSbj=new je.X(null)}setAssistantHover(e){this._assistantHoverProviderSbj.next(e)}removeAssistantHover(){this._assistantHoverProviderSbj.next(null)}getHoveredStateBehavior(e){const t=this._originalHoverProvider.getHoveredStateBehavior(e);return this._assistantHoverProviderSbj.pipe((0,h.w)((i=>null==i?t:(0,de.aj)(t,i.getHoveredStateBehavior(e),((e,t)=>t!==gn.pc.none?t:e)))))}}var _n=i(77150),vn=i(40273),wn=i(36991);var yn=i(62337),En=i(30067);class Cn{constructor(){this._mapByHighlightId=new Map,this._mapByAlertId=new Map,this._highlightDataChanged=new c.xQ}_getVisualization(e){const t=this._mapByHighlightId.get(e);return null==t?void 0:t.visualization}getByAlertId(e){const t=this._mapByAlertId.get(e)||new Set;return Array.from(t).map((e=>this._mapByHighlightId.get(e))).filter((e=>!!e))}get(e){return this._mapByHighlightId.get(e)}has(e){return this._mapByHighlightId.has(e)}set(e,t){this._mapByHighlightId.set(e,t);const i=this._mapByAlertId.get(t.alertId)||new Set;i.add(e),this._mapByAlertId.set(t.alertId,i),this._highlightDataChanged.next(e)}delete(e){const t=this._mapByHighlightId.get(e);if(t){const i=this._mapByAlertId.get(t.alertId);void 0!==i&&(i.delete(e),0===i.size&&this._mapByAlertId.delete(t.alertId)),this._mapByHighlightId.delete(e)}this._highlightDataChanged.next(e)}forEach(e){this._mapByHighlightId.forEach(e)}getHighlightVisualization(e){return this._highlightDataChanged.pipe((0,w.h)((t=>t===e)),(0,g.U)((()=>this._getVisualization(e))),(0,m.O)(this._getVisualization(e)))}}class bn{constructor(e,t,i,s,a=(()=>vt.E9.zero),r=y.Y.create(bn.name)){this._denaliHighlights=e,this._getFluidHighlights=t,this._getTextMap=i,this._getParentRect=s,this._getParentScroll=a,this._log=r}register(e,t,i,s){if(null!==e){if(this._denaliHighlights.has(e))return this.update(e,t,i,s);{const a=new mi.Fd(e,t,this._getFluidHighlights(),this._getParentRect,this._getParentScroll),r={id:e,alertId:s.alertId,mark:a,visualization:i};this._denaliHighlights.set(e,r);const n=this._getTextMap().getPlainText();return this._getFluidHighlights().addHighlight(e,(0,En.rX)((0,En.mp)(a.range),n),s),r}}return null}remove(e){this._denaliHighlights.has(e)?(this._getFluidHighlights().removeHighlights([e]),this._denaliHighlights.delete(e)):this._log.warn(`can't remove mark #${e}, doesn't exist`)}update(e,t,i,s){const a=this._denaliHighlights.get(e);if(a){this._denaliHighlights.set(e,{...a,visualization:i});const r=this._getTextMap().getPlainText();return this._getFluidHighlights().updateHighlight(e,(0,En.rX)(t.meta.range(),r),s),a}return this._log.warn("cannot update not existing highlight",e),null}clearAll(){this._denaliHighlights.forEach((e=>{this._getFluidHighlights().removeHighlights([e.id])}))}}var Sn=i(55073),kn=i(25938),xn=i(64450),Mn=i(24645);class An{constructor(e,t,i,s,a,r,n=y.Y.create(An.name),o,l){this._highlights=e,this._textObserver=t,this._replacementService=i,this._layout=s,this._scroller=a,this._selectedHighlightsTracker=r,this._log=n,this._requestAwaitService=o,this._formattingService=l,this._subs=new We.w.Keeper,this._disposed=!1,this._alertsData=new Cn,this._highlightUpdater=new bn(this._alertsData,(()=>this._highlights),(()=>this._textObserver.getTextSource()),(()=>{const e=this._layout.textField.rect.getApproximate();return yn.Pf.create({...e.client,...e.size})}),(()=>this._layout.textField.scroll.getApproximate())),this.highlightHoverProvider={getHoveredStateBehavior:e=>this._alertsData.getHighlightVisualization(e).pipe((0,g.U)((e=>e&&e.type===mi.sO.Change.VisualState.Type.highlighted?{[mi.sO.Change.VisualState.Source.sidebar]:gn.pc.hovered_needs_attention,[mi.sO.Change.VisualState.Source.text]:gn.pc.hovered,[mi.sO.Change.VisualState.Source.api]:gn.pc.none}[e.source]:gn.pc.none)))},this._updateContentsBuffer=new c.xQ,this._flushUpdater=new c.xQ,this._echoChanges=new c.xQ,this.changes=pe.T(this._echoChanges,this._textObserver.contentChanges.async.pipe((0,w.h)((e=>e.changes.length>0)),(0,g.U)((({deltaChange:e})=>e)))),this.getContents=(e,t)=>{if(this._log.trace(`getContents, ${e}, ${t}`),this._formattingService){const i=this._textObserver.getTextSource().getRichText();return kn.RI.unsafeRes(void 0!==e?i.slice(e,void 0!==t?e+t:void 0):i)}{const i=void 0!==e?this.getText().slice(e,void 0!==t?e+t:void 0):this.getText();return kn.RI.resFromText(i)}},this.activeMarks=new je.X(ee.none),this.contentUpdated=new c.xQ,this.hoveredMarks=new je.X(ee.none),this.textChangedAfterPaste=new c.xQ,this.activeWord=new je.X(ee.none),this.clickedWord=new je.X(ee.none),this.ongoingSelection=new je.X(!1),this._log.info(An.name+" created"),this._subs.push(this._subscribeToContentUpdates(),this._subscribeToSelectedHighlight())}pushChanges(e,t){this._log.trace("pushChanges",{change:e,source:t}),kn.RI.isFlush(e)?this._flushUpdater.next():kn.RI.isReset(e)?wn.s.deltaEq.equals(e.delta,this.getContents().delta)?this._echoChanges.next(e):this._log.warn("Got unknown reset"):this._updateContents(e.delta,t)}getText(){return this._log.trace("getText"),this._formattingService?(0,Sn.l)(this._textObserver.getTextSource().getRichText(),""):this._textObserver.getTextSource().getPlainText()}getTextLength(){return this._log.trace("getTextLength"),this.getText().length}flushChanges(){this._log.trace("flushChanges")}getCursor(){return this._log.trace("getCursor"),Pt.Y1.empty}setCursor(e,t,i){return this._log.trace("setCursor",{_index:e,_length:t,_source:i}),Ue.right(void 0)}getLastPossibleCursorPosition(){return this._log.trace("getLastPossibleCursorPosition"),0}_doMarkAction(e){const t=gn.y$.Id.create(e.id),i=e.meta.capiAlertId;switch(e.action){case Mn.v.Change.ActionType.create:const s=this._highlightUpdater.register(t,e,e.meta.visualState,{alertId:i,highlightId:t,alertDisplayType:e.meta.extensionDisplayType});return(null==s?void 0:s.mark)||null;case Mn.v.Change.ActionType.update:const a=this._highlightUpdater.update(t,e,e.meta.visualState,{alertId:i,highlightId:t,alertDisplayType:e.meta.extensionDisplayType});return(null==a?void 0:a.mark)||null;case Mn.v.Change.ActionType.remove:return this._highlightUpdater.remove(t),null;default:(0,ut.vE)(e)}}changeMarks(e){return this._disposed?(this._log.debug("changeMarks called after disposed, returning empty result"),Mn.v.Change.Result.getEmpty()):(this._log.trace("changeMarks",{rawMarks:e}),e.reduce(((e,t)=>{switch(t.action){case Mn.v.Change.ActionType.create:e.created.set(t.id,Ue.fromNullable(new Error("Cannot create mark"))(this._doMarkAction(t)));break;case Mn.v.Change.ActionType.update:e.updated.set(t.id,Ue.fromNullable(new Error("Cannot update mark"))(this._doMarkAction(t)));break;case Mn.v.Change.ActionType.remove:this._doMarkAction(t),e.removed.set(t.id,Ue.right(void 0))}return e}),Mn.v.Change.Result.getEmpty()))}scrollToMark(e,t){return this._log.trace("scrollToMark",{mark:e,opts:t}),this._scroller.scrollToMark(e,t)}_subscribeToContentUpdates(){return this._updateContentsBuffer.pipe((0,_n.R)((()=>(0,pe.T)((0,rt.H)((0,nt.Xd)(20)),this._flushUpdater).pipe((0,$e.P)()))),(0,w.h)((e=>e.length>0)),(0,g.U)((e=>e.reduce(((e,t)=>e.compose(t)),new xn.i)))).subscribe((e=>{const t=this._replacementService.performBatchReplacements((i=e,i.reduce((({actions:e,index:t},i)=>{const s=e[0];return wn.s.isInsertString(i)?(e.unshift({pos:{start:t,end:t},value:i.insert}),{actions:e,index:t}):wn.s.isInsertEmbed(i)?{actions:e,index:t+1}:wn.s.isRetain(i)?{actions:e,index:t+i.retain}:wn.s.isDelete(i)?(s&&s.pos.start===s.pos.end&&s.pos.end===t?s.pos={...s.pos,end:s.pos.end+i.delete}:e.unshift({pos:{start:t,end:t+i.delete},value:""}),{actions:e,index:t+i.delete}):void(0,qe.vE)(i)}),{actions:[],index:0}).actions.reduce(((e,t)=>(e.length&&e[e.length-1].value&&e[e.length-1].pos.start===t.pos.start?e[e.length-1].value=`${t.value}${e[e.length-1].value}`:e.push(t),e)),[]))).then((()=>{const t=(e=>e.reduce((({formattings:e,index:t},i)=>vn.m.hasFormatting(i)?wn.s.isInsertString(i)?(e.push({range:{start:t,end:"\n"===i.insert?t:t+i.insert.length},formatting:i.attributes}),{formattings:e,index:t+i.insert.length}):wn.s.isInsertEmbed(i)?{formattings:e,index:t+1}:wn.s.isRetain(i)?(e.push({range:{start:t,end:t+i.retain},formatting:i.attributes}),{formattings:e,index:t+i.retain}):{formattings:e,index:t}:wn.s.isInsertString(i)?{formattings:e,index:t+i.insert.length}:wn.s.isInsertEmbed(i)?{formattings:e,index:t+1}:wn.s.isRetain(i)?{formattings:e,index:t+i.retain}:wn.s.isDelete(i)?{formattings:e,index:t}:void(0,qe.vE)(i)),{formattings:[],index:0}).formattings)(e);this._formattingService&&t.length&&(this._log.trace("Have formattings, applying",t),t.forEach((e=>{this._formattingService&&this._formattingService.apply(e.range,e.formatting)})))}),(()=>{this._log.warn("Failed to apply batch replacements")}));var i;this._requestAwaitService&&this._requestAwaitService.addRequest(t)}))}_subscribeToSelectedHighlight(){return this._selectedHighlightsTracker.pipe((0,g.U)((e=>(0,o.pipe)(ee.some(e),ee.map((e=>e.map((e=>{var t;return null===(t=this._alertsData.get(e))||void 0===t?void 0:t.mark})).filter((e=>Boolean(e))))))))).subscribe((e=>{this.activeMarks.next(e)}))}_updateContents(e,t){this._updateContentsBuffer.next((0,Sn.AQ)(e))}getSelectionRect(){throw this._log.trace("getSelectionRect"),Error("not implemented")}setContents(e){this._log.trace("setContents",{_value:e})}getHTML(){return this._log.trace("getHTML"),""}getPossibleCursorPosition(e,t){return this._log.trace("getPossibleCursorPosition",{_x:e,_y:t}),Ne.vM((()=>{throw new Error("Not implemented")}))}dispose(){this._highlightUpdater.clearAll(),this._subs.dispose(),this._log.info(An.name+" disposed"),this._disposed=!0}}var Ln=i(64213),In=i(14568),Tn=i(49524),Rn=i(38365),Fn=i(51072);var Vn=i(80358),Pn=i(53487),On=i(24273),Hn=i(27901),Nn=i(5760),Un=i(99516),Bn=i(44659),Dn=i(52485),qn=i(57736);const Gn=(e,t,i,s,a,r,n=Zn("permanentStorageSync",t.getContents()))=>{const l=new We.w.Keeper,c=function(e,t,i){const s=P.hg.create(ee.none),a=P.hg.create(ee.none);return{score:P.hg.create(ee.none),textInfo:P.hg.create(ee.none),checkingState:P.hg.create(e.checkingState),asyncChecksState:P.hg.create(e.asyncChecksState),context:i,contextCompleteness:i.view(Rn.j.calculateCompleteness),updateContext:e=>{const t=!ki.R$.equals(i.get(),e);return i.set(e),t},defaultContext:s,updateDefaultContext:e=>{const t=!(0,o.pipe)((0,W.tuple)([s.get(),e],gt.vB(ki.R$.equals)));return s.set(e),t},documentText:t.getText(),documentLength:P.hg.create({full:t.getTextLength(),trimmed:t.getTextLength()}),counters:P.hg.create(Rn.dM.group.empty),calculateStats:()=>Fn.Vi(e.requestDocStats).then((e=>(a.set(ee.some(e)),e))),recentDocumentStats:a}}(e,t,i);l.push(e.events.pipe(_.b((t=>{var i;c.checkingState.set(e.checkingState),Vn.h.is("text_info")(t)?c.textInfo.set(ee.some(t.data)):Vn.h.is("finish")(t)?c.score.set(t.score):Vn.h.is("feedback_ack")(t)?(0,o.pipe)(ee.fromNullable(null===(i=t.outcomeScores)||void 0===i?void 0:i.GeneralScore),ee.map((e=>Math.trunc(100*e))),ee.map((e=>{c.score.modify((0,W.flow)(ee.map((t=>({...t,rank:e})))))}))):Vn.h.is("session_started")(t)&&c.updateDefaultContext(t.defaultDocumentContext)}))).subscribe(),a.contentChanges.async.pipe(Qe.b(300),g.U((e=>e.newText)),g.U((e=>({full:e.length-1,trimmed:e.trim().length}))),_.b(ne.wW(c.documentLength))).subscribe()),(0,o.pipe)(r(),ee.map((e=>{c.updateDefaultContext(ki.R$.parseDefault(e.defaultDocumentContext))})));const d=new qn.Xr,p=new Nn.Ek,h=new Hn.S(d,p,(()=>t.getContents().delta),e.events,e,c.counters,Tn.y,((e,t)=>Ve.bZ.isDuplicatedBy(e,t)||Ve.bZ.isTakeawayOverlap(e,t,.75))),m=Pn.e.create(h.state),u=new On.k(m,h._ops);return l.push(Bn.R.init(Dn.$.connectAsPrimarySourceWithoutDuplex(t),e.events,n,Un.n.ignoreTEResult(e),Un.n.ignoreResult(d),p,Un.A.merge([h])).subscribe()),e.loadAlerts(s()),h.flushAlerts(),{alertsList:h,alertsReader:m,alertsService:u,positionManager:d,sessionModel:c,shutdown:()=>{h.dispose(),l.dispose()}}},Zn=(e,t)=>({pushChanges:He.ZT,changes:(new c.xQ).pipe(m.O(t))});class zn{constructor(e,t,i,s,a,r,n,o,l,c,d){this.connectionState=e,this.pageState=t,this.actions=i,this.gnar=s,this.user=a,this._hoverProvider=r,this.document=n,this.formattingService=o,this.denaliViewAdapter=l,this.capiProxy=c,this.engine=d,r.setAssistantHover(l.highlightHoverProvider)}static create(e){var t;const i=new An(e.highlights,e.textObserver,e.replacementService.get(),e.layout,e.scroller,e.selectedHighlightsTracker,void 0,e.requestAwaitService,null===(t=e.formattingService)||void 0===t?void 0:t.get()),s=In.p.create(e.checkingService.get(),e.checkingServiceInitialState,e.alertsTransformer,e.alertProcessor,e.sidebarEvents),a=Gn(s,i,e.document.settings.lens("context"),(()=>{var t,i;return null!==(i=null===(t=e.getExistingAlerts)||void 0===t?void 0:t.call(e))&&void 0!==i?i:(0,Ln.q)(e.alertProcessor)}),e.textObserver,(()=>e.checkingServiceInitialState.value.lastStart));return new zn(e.connectionState,e.pageState,e.actions,e.gnar,e.user,e.hoverProvider,e.document,e.formattingService,i,s,a)}dispose(){this.capiProxy.dispose(),this.denaliViewAdapter.dispose(),this.engine.shutdown(),this._hoverProvider.removeAssistantHover()}}var Wn=i(79462);class jn{constructor({layout:e}){this._scroller=function({scrollToMarkRect:e,scrollToRange:t}){return{scrollToMark:(i,s)=>new Wn.y((a=>(0,o.pipe)(mi.Fd.getMarkRect(i),Ne.L9((()=>(t((0,En.mp)(i.range)),mi.Fd.getMarkRect(i)))),Ue.fold((()=>{a.error(new Error("Cannot get mark's rect: "+i.id))}),(t=>{a.next(void 0),e(t,s)})))))}}({scrollToMarkRect(t,i){const s=e.textField.visibleRect.getApproximate();let a=(i&&i.paddingTop||0)-s.client.top;(a<=0||a>=s.size.height)&&(a=s.size.height/2);const r=t.top-a-s.client.top,n=t.right-t.left,o=Math.max(0,(s.size.width-n)/2);t.left,s.client.left;requestAnimationFrame((()=>e.textField.scroller.scrollBy({top:r,left:void 0})))},scrollToRange(){}})}scrollToMark(e,t){return this._scroller.scrollToMark(e,t)}}var Xn=i(45288),Yn=i(42187);function Qn(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function Kn(e,t){return e<<t|e>>>32-t}const $n=3432918353,Jn=461845907;class eo{getHash(e,t=0){const i=(new TextEncoder).encode(e),s=i.length%4,a=i.length-s;let r,n=t,o=0;for(r=0;r<a;r+=4)n=Qn(Kn(n^Qn(Kn(Qn(i[r]|i[r+1]<<8|i[r+2]<<16|i[r+3]<<24,$n),15),Jn),13),5)+3864292196;switch(o=0,s){case 3:o^=i[r+2]<<16;case 2:o^=i[r+1]<<8;case 1:o^=i[r],n^=Qn(Kn(Qn(o,$n),15),Jn)}return l=Qn((l=n^i.length)^l>>>16,2246822507),((l=Qn(l^l>>>13,3266489909))^l>>>16)>>>0;var l}}var to;!function(e){e.preferred=eo}(to||(to={}));class io{constructor(e){this._params=e,this.sidebarEvents=new c.xQ,this.hoverProvider=new fn(this._params.hoverProvider),this.selectedHighlightsTracker=this._params.highlights.getSelectedHighlightsTracker({textField:this._params.originalTextField,selectionService:this._params.selectionService}),this.goalPrediction=new Xn.X(this._params.state.view("user","experiments").view((e=>{var t;return null!==(t=(null==e?void 0:e.goalPrediction)&&!(null==e?void 0:e.goalPredictionShadow))&&void 0!==t&&t})),((e,t)=>this._checkingService&&this._checkingService.lazyCheckingService.get().onIntentFeedback(e,t))),this.positionModel=((e,t,i)=>{const s=t.view("page","domain").get(),a=(0,Yn.bk)(e,-1,(e=>e.nodeName)),r=`${s},${e.nodeName},${a.join()}`,n=(new to.preferred).getHash(r).toString(),o=t.view("page","assistantSettings").view((e=>{var t,i;return e&&null!==(i=null===(t=e[n])||void 0===t?void 0:t.initialPositionOffset)&&void 0!==i?i:vt.E9.zero}));return{initialPositionOffset:o,updateInitialPositionOffset:e=>{vt.E9.equal(e,o.get())||i.patchAssistantSettings({[n]:{initialPositionOffset:e}})}}})(this._params.originalTextField,this._params.state,this._params.actions),this.isTextFieldEmpty=this._params.textObserver.contentChanges.async.pipe(g.U((e=>""===e.newText.trim())),Xe.x()),this._checkingService=null}setCheckingService(e){this._checkingService=e}getCheckingServiceState(){var e;return null===(e=this._checkingService)||void 0===e?void 0:e.state.value}createIntegration(){const{layout:e,highlights:t,textObserver:i,replacementService:s,alertProcessor:a,state:r,gnar:n,alertsTransformer:o,document:l,requestAwaitService:c,formattingService:d,actions:p,getCheckingServicePreviousState:h,createAssistantScroller:m=(()=>new jn({layout:e})),getExistingAlerts:u}=this._params;if(null==this._checkingService)return null;const g=null==h?void 0:h();g&&(this._checkingService.state.value=g);const f=m(),{user:_}=r.get();return zn.create({layout:e,alertProcessor:a,connectionState:r.view((e=>e.connection)),pageState:r.view((e=>e.page)),actions:p,highlights:t,textObserver:i,replacementService:s,checkingService:this._checkingService.lazyCheckingService,checkingServiceInitialState:this._checkingService.state,gnar:n,user:{isPremium:_.premium,isAnonymous:_.anonymous,experiments:_.experiments,customFields:_.customFields},hoverProvider:this.hoverProvider,selectedHighlightsTracker:this.selectedHighlightsTracker,scroller:f,sidebarEvents:this.sidebarEvents,document:l,alertsTransformer:o,requestAwaitService:c,formattingService:d,getExistingAlerts:u})}dispose(){var e;null===(e=this._checkingService)||void 0===e||e.state.dispose()}}const so=e=>({setUserRole:e.setUserRole,setSoundFluentGoals:e.setSoundFluentGoals,setPrimaryLanguage:e.setPrimaryLanguage})},66020:(e,t,i)=>{var s=i(93476)((function(e){return e[1]}));s.push([e.id,"._3wyc7-badge{display:-ms-inline-flexbox;display:inline-flex;border-radius:3px;padding-left:4px;padding-right:4px;}._3wyc7-badge._3OZNg-badgePrimary{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#3659b5;font-size:10px;line-height:16px;letter-spacing:.04em;text-transform:uppercase;background:#dbebff}._3wyc7-badge._23H_e-badgeSuccess{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#0d8065;font-size:10px;line-height:16px;letter-spacing:.04em;text-transform:uppercase;background:#d7f7f0}._3wyc7-badge._1IBfr-badgeGold{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#8c5404;font-size:10px;line-height:16px;letter-spacing:.04em;text-transform:uppercase;background:#ffdf80}",""]),s.locals={badge:"_3wyc7-badge",badgePrimary:"_3OZNg-badgePrimary",badgeSuccess:"_23H_e-badgeSuccess",badgeGold:"_1IBfr-badgeGold"},e.exports=s},66740:(e,t,i)=>{var s=i(93476),a=i(91678),r=i(80300),n=s((function(e){return e[1]})),o=a(r);n.push([e.id,"@keyframes _Yz4yI-spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}._UaSlh-proofitRequestFormBtnLoadingSpinner{width:32px;height:32px;background-size:32px 32px;background-image:url("+o+");background-repeat:no-repeat;animation:_Yz4yI-spin 1s linear infinite;margin:0 auto}",""]),n.locals={proofitRequestFormBtnLoadingSpinner:"_UaSlh-proofitRequestFormBtnLoadingSpinner",spin:"_Yz4yI-spin"},e.exports=n},55271:(e,t,i)=>{var s=i(93476),a=i(91678),r=i(58947),n=s((function(e){return e[1]})),o=a(r);n.push([e.id,"._AXhEk-proofitRequestForm{width:100%;height:100%;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;}._AXhEk-proofitRequestForm ._1CZ3g-proofitRequestFormImg{width:256px;height:48px;background-size:256px 48px;background-image:url("+o+");background-repeat:no-repeat;margin-bottom:16px;-ms-flex-negative:0;flex-shrink:0}._AXhEk-proofitRequestForm ._2f8us-proofitRequestFormTitle{font-family:Inter,sans-serif;font-style:normal;font-weight:bold;color:#0e101a;font-size:16px;line-height:24px;margin-bottom:4px}._AXhEk-proofitRequestForm ._2t-MU-proofitRequestFormDescription{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#0e101a;font-size:14px;line-height:21px;font-feature-settings:'ss03' on;margin-bottom:18px}._AXhEk-proofitRequestForm ._3bGTw-proofitRequestFormCostAndTime{display:-ms-grid;display:grid;-ms-grid-columns:1fr 1fr;grid-template-columns:1fr 1fr;margin-bottom:32px;}._AXhEk-proofitRequestForm ._3bGTw-proofitRequestFormCostAndTime ._3-OP_-proofitRequestFormTime{border-left:1px solid #c6cbde;padding-left:16px}._AXhEk-proofitRequestForm ._3bGTw-proofitRequestFormCostAndTime ._2R7q7-proofitRequestFormCostAndTimeTitle{font-family:Inter,sans-serif;font-style:normal;font-weight:bold;color:#0e101a;font-size:16px;line-height:24px}._AXhEk-proofitRequestForm ._3bGTw-proofitRequestFormCostAndTime ._3xdAw-proofitRequestFormCostAndTimeSubtitle{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#0e101a;font-size:11px;line-height:16px}._AXhEk-proofitRequestForm ._vKrAd-proofitRequestFormRequestBtn{margin-bottom:7px}._AXhEk-proofitRequestForm ._CaeP7-proofitRequestFormUnavailableMsg{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#6d758d;font-size:12px;line-height:18px;text-align:center}._AXhEk-proofitRequestForm ._DyHk9-proofitRequestFormFreeTrialFootnote{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#6d758d;font-size:11px;line-height:16px;margin-top:32px;width:100%;-ms-flex-positive:1;flex-grow:1;-ms-flex-negative:0;flex-shrink:0;display:-ms-flexbox;display:flex;-ms-flex-direction:column-reverse;flex-direction:column-reverse;-ms-flex-align:center;align-items:center}._AXhEk-proofitRequestForm ._3-3Od-proofitRequestFormPrivacyInfoTitle{font-family:Inter,sans-serif;font-style:normal;font-weight:bold;color:#0e101a;font-size:16px;line-height:24px;margin-bottom:10px}._AXhEk-proofitRequestForm ._HQATa-proofitRequestFormPrivacyInfoDescription{margin-bottom:32px;}._AXhEk-proofitRequestForm ._HQATa-proofitRequestFormPrivacyInfoDescription ._1SxBs-proofitRequestFormPrivacyInfoDescriptionItem{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#0e101a;font-size:14px;line-height:21px;font-feature-settings:'ss03' on;margin-bottom:10px;display:-ms-grid;display:grid;-ms-grid-columns:1fr auto;grid-template-columns:1fr auto;grid-column-gap:13px;-ms-flex-align:baseline;align-items:baseline;}._AXhEk-proofitRequestForm ._HQATa-proofitRequestFormPrivacyInfoDescription ._1SxBs-proofitRequestFormPrivacyInfoDescriptionItem ._wLxAr-proofitRequestFormPrivacyInfoDescriptionItemBulletPoint{width:6px;height:6px;background:#0e101a;border-radius:100%}",""]),n.locals={proofitRequestForm:"_AXhEk-proofitRequestForm",proofitRequestFormImg:"_1CZ3g-proofitRequestFormImg",proofitRequestFormTitle:"_2f8us-proofitRequestFormTitle",proofitRequestFormDescription:"_2t-MU-proofitRequestFormDescription",proofitRequestFormCostAndTime:"_3bGTw-proofitRequestFormCostAndTime",proofitRequestFormTime:"_3-OP_-proofitRequestFormTime",proofitRequestFormCostAndTimeTitle:"_2R7q7-proofitRequestFormCostAndTimeTitle",proofitRequestFormCostAndTimeSubtitle:"_3xdAw-proofitRequestFormCostAndTimeSubtitle",proofitRequestFormRequestBtn:"_vKrAd-proofitRequestFormRequestBtn",proofitRequestFormUnavailableMsg:"_CaeP7-proofitRequestFormUnavailableMsg",proofitRequestFormFreeTrialFootnote:"_DyHk9-proofitRequestFormFreeTrialFootnote",proofitRequestFormPrivacyInfoTitle:"_3-3Od-proofitRequestFormPrivacyInfoTitle",proofitRequestFormPrivacyInfoDescription:"_HQATa-proofitRequestFormPrivacyInfoDescription",proofitRequestFormPrivacyInfoDescriptionItem:"_1SxBs-proofitRequestFormPrivacyInfoDescriptionItem",proofitRequestFormPrivacyInfoDescriptionItemBulletPoint:"_wLxAr-proofitRequestFormPrivacyInfoDescriptionItemBulletPoint"},e.exports=n},20532:(e,t,i)=>{var s=i(93476),a=i(91678),r=i(16569),n=s((function(e){return e[1]})),o=a(r);n.push([e.id,"._fYSOQ-proofitReviewForm ._G0q6Z-proofitReviewFormImg{width:82px;height:80px;background-size:82px 80px;background-image:url("+o+");background-repeat:no-repeat;margin-bottom:16px;margin-left:auto;margin-right:auto}._fYSOQ-proofitReviewForm ._KZJJY-proofitReviewFormTitle{font-family:Inter,sans-serif;font-style:normal;font-weight:bold;color:#0e101a;font-size:16px;line-height:24px;margin-bottom:4px}._fYSOQ-proofitReviewForm ._3XcJO-proofitReviewFormDescription{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#0e101a;font-size:14px;line-height:21px;font-feature-settings:'ss03' on;margin-bottom:32px}",""]),n.locals={proofitReviewForm:"_fYSOQ-proofitReviewForm",proofitReviewFormImg:"_G0q6Z-proofitReviewFormImg",proofitReviewFormTitle:"_KZJJY-proofitReviewFormTitle",proofitReviewFormDescription:"_3XcJO-proofitReviewFormDescription"},e.exports=n},80111:(e,t,i)=>{var s=i(93476)((function(e){return e[1]}));s.push([e.id,"._1uFm--scoreRing{transition:stroke-dashoffset .35s;transform:rotate(-90deg);transform-origin:50% 50%;cursor:pointer;}._1uFm--scoreRing svg circle{transition:all .35s ease-in-out;transition-property:stroke-dashoffset,stroke}._3cJ_j-loading svg circle{transform-origin:50% 50%;transition:none;animation:_1EwuF-rotation 2s infinite linear}._2gh3G-scoreText{font-family:Inter,sans-serif;font-weight:bold;font-feature-settings:'ss01'}@keyframes _1EwuF-rotation{from{transform:rotate(0)}to{transform:rotate(-359deg)}}",""]),s.locals={scoreRing:"_1uFm--scoreRing",loading:"_3cJ_j-loading",rotation:"_1EwuF-rotation",scoreText:"_2gh3G-scoreText"},e.exports=s},41794:e=>{e.exports={container:"rWxB3",contentContainer:"_1MFbY",thankYouContentContainer:"_3tH8C",main:"_2DNNh",thankYouMain:"_1wXyS",question:"UhER3",helperText:"_3te2s",optionsContainer:"_2rd2k",checkboxOption:"_8Cmo7",radioOption:"_3lgCn",thankYou:"_3DVR-",thankYouSubtext:"_2tIVN",buttonsContainer:"bOyYX"}},33751:e=>{e.exports={cardList:"_1Eape",cardListFooterDynamic:"Inkbe",cardListFooterStatic:"_7OpWh",cardListFooterAnimate:"_29PbU",upgradeHookWrapper:"_9GpAY",footer_button:"_1Vj8X",assistant:"AnaVG",feedback_button:"ncuAb",personalization_button:"_3lVFJ",dragging:"_1XWvb",mainView:"_38aRY"}},78846:e=>{e.exports={actions_hovered:"Xf2Pk",header:"_3p6xo",draggableWrapper:"_2_Oau",draggable:"_1m9e2",headerActions:"_2asjJ",headerActionBtn:"_2u6D9",headerActionBtnProofitIcon:"_1GEsJ",logoscore_fadein:"xzxut",fadein:"_30rWn",logoscore_fadeout:"_1DBSi",fadeout:"_24pVK",logo_score:"_6nCpo",spin:"_2gcAi"}},19217:e=>{e.exports={insight:"_3o8h_",insight__icon:"_1xYf9",insight__inline_icon:"svSbC",insight__inline_text:"_3Uft0",insight__text:"_4HNa-",insight__title:"_3oxut",insight__level:"_3kcds"}},45666:e=>{e.exports={card:"_3zZUt",expand:"H6oxJ",thank:"_2vHPb",showWithFade:"_3VA9f",hide:"_3GQd2",hideWithFade:"_2EbFz",content:"_3xKyU",emojiAndTitle:"_3e-Dd",emoji:"_3yRHv",voteAndBetaBadge:"_2fnci",betaBadgeAndCloseButton:"R_dL3",betaBadge:"_1CQFV",closeButton:"Gsgji",expandedInfo:"VT1X4"}},75039:e=>{e.exports={panel:"_1_EJL",score_container:"_2K_dc",info_icon:"wbvN6",lens_switch:"_3zrPc"}},98029:e=>{e.exports={predictions:"_3feHG",predictions__header:"_35Gcg",predictions__card:"_2xc9F",counterContainer:"_2co0s",predictions__zero_text:"_25oPK",predictions__emogenie_pulsing:"p-kia"}},40145:e=>{e.exports={relatedSuggestionsTitle:"_3lmjh"}},55364:e=>{e.exports={viewOverlay:"_3iGYO",content:"_2sw8A",footer:"_3kpn-",viewOverlayGoBack:"_2Z1Xu",defaultViewOverlayPanel:"jqEio",gradientViewOverlayPanel:"_3Qgxa",proofitViewOverlayPanel:"_9lDqb",defaultViewOverlayHeader:"_1GTGF",defaultViewOverlayContent:"nXzeg",gradientViewOverlayContent:"_2hao0",proofitViewOverlayContent:"_2XeMU",logo:"xQSpk",proofitViewOverlayHeader:"_3dGrl",proofitViewOverlayHeaderBetaBadge:"_2wTGA"}},91197:e=>{e.exports={checklistAnimationWrapper:"SwRGm",animateChecklistHeightChanges:"_3ajnS",checklistCollapsed:"_2misS",checklistHeader:"_3km-f",checklistTitle:"_2r9Yo",checklistFirstItemPreview:"_29yzo",checklistExpanded:"_1M7Xt",checklistGroupHeader:"_3Tvt-",checklistItem:"ETzli",itemBullet:"_1KBAD",itemText:"iXUS0",checked:"JbfTD",fadeIn:"_3vdyB",fadeInFast:"_1aVF8",fadeOut:"VeNTM",fadeOutFast:"eO5gv",fadeInContentChange:"_23vih",fadeOutContentChange:"_3wGOA",expand:"EUb4D",collapsedToExpanded:"bcdnr",collapse:"_3xSXQ",expandedToCollapsed:"vcwfv"}},90295:e=>{e.exports={viewOverlay:"_3-ynL",content:"_272rY",footer:"_23Hk5",viewOverlayGoBack:"_20r1E",defaultViewOverlayPanel:"fOEpx",gradientViewOverlayPanel:"VmOOi",onboardingPanel:"_2MGhh",defaultViewOverlayHeader:"civcO",defaultViewOverlayContent:"_2bKbb",gradientViewOverlayContent:"_3GMhV",logo:"_3HWWb",onboardingPanelContent:"_2OSAG",onboardingBanner:"_31lP9",onboardingBannerImage:"_3GEtW",onboardingHeader:"_21vy0",onboardingBannerMessage:"_13zKm",onboardingContent:"_2_FA9",heatmap:"Qcuqf",gettingStartedButton:"_1Qgvx"}},82318:e=>{e.exports={viewOverlay:"_24v8y",content:"_1GUCQ",footer:"_VXnz",viewOverlayGoBack:"_2vYal",defaultViewOverlayPanel:"_181-n",gradientViewOverlayPanel:"_30LCU",defaultViewOverlayHeader:"_2YCIK",defaultViewOverlayContent:"_1T1GW",gradientViewOverlayContent:"_2hMw0",logo:"_1wpBP",cardList:"_2M4t-",headerGroup:"Qwt6V",questionMarkButton:"_2U3v1",questionMarkIcon:"_3hiB8",summaryWrapper:"_3f-rw",message:"_2UO09",inlineButton:"_1-m6b"}},91574:e=>{e.exports={settingsDoneButton:"_3hYyu"}},35327:e=>{e.exports={summary_heading:"_28Zxw",summary_wrapper:"_3qF24",summary_fadein:"_1OTrB",fadein:"_1ETLE",summary_fadeout:"GJSzn",fadeout:"YHKQy"}},73008:e=>{e.exports={viewOverlay:"_8FYR8",content:"D8x8A",footer:"_1oEdF",viewOverlayGoBack:"_2IRn0",defaultViewOverlayPanel:"_3wpsL",gradientViewOverlayPanel:"_2zadI",defaultViewOverlayHeader:"_3Y5Ie",defaultViewOverlayContent:"_1FPwk",gradientViewOverlayContent:"_2WqSK",logo:"oiRsy"}},62513:e=>{e.exports={compactSuccessLens:"_1G56p",compactSuccessLensContainer:"_1cOu3"}},47476:e=>{e.exports={cardWrapper:"_1RweD",bundleCardWrapper:"_11UJn"}},74880:e=>{e.exports={cardList:"_2bCPN"}},30509:e=>{e.exports={premiumLens:"_2XK23"}},879:e=>{e.exports={successLens:"_1mbLA"}},79850:e=>{e.exports={wrapper:"_2PLre"}},75259:e=>{e.exports={container:"_2D4XC",baseGrid:"_2pCwn",bottomLeft:"_3_LGs",bottomRight:"_2tHhO",top:"_2Qg0A",notificationWrapper:"_3waR1"}},67129:e=>{e.exports={sidebarContainer:"_1_f6i"}},71527:e=>{e.exports={selected:"_3Ibej",label:"EKNV1",option:"ygVjN"}},66402:e=>{e.exports={american:"pyFmV",australian:"_2WGo3",british:"_1nkJZ",canadian:"_35Lt7"}},68089:e=>{e.exports={hover_blocker:"_1b9OS"}},26485:e=>{e.exports={select_checkbox:"_3jXk9",beta:"_2D7H7",new:"_3Lqg-",checkbox:"_2nj-e",checkbox_check:"_28S0f",on:"UigB5",off:"_30ryz",checkbox_check_round:"_1PwEM",checkbox_control_wrapper:"_1KIp6",grayOut:"ZleQc",on_off:"_3mcZ6",disabled:"_1Sp_7",bottom_line:"NahjE",setting_item:"_3JLH2"}},6304:e=>{e.exports={line:"_2vgUt",disabled:"_3kA-F",dialectPicker:"_2v6OJ"}},47740:e=>{e.exports={container:"_1eoMt",contant:"_255K3",title:"_3hI6a",spacer:"_2uzpC"}},17324:e=>{e.exports={windows:"_2wKpF",setting_item:"_6eFop",fixing:"_3sQF9",thin_text:"_2m369",footer:"AIrzw",gr_popup_settings:"_18flg",footer_btn:"_16bxQ",short_border:"FqAkb",top:"_2N9kH",show_news:"_3gR-M",news:"_1cBf5",news_content:"_3szOJ",close_news:"_8vCda",upgraded:"_1D3x1",content:"_36NTm",since:"dfV8r",business:"Nb2Rp",my_grammarly:"_1NXBN",new_document:"bpEGW",unsupported_site:"iBAYN",unsupported_item:"_13zLn",unsupported_title:"_3rfYX",domain:"_1tlAE",domain_in_details:"_2z4_y",unsupported_temporary:"Xw4Jp",unsupported_permanently:"_27hK2",unsupported_grammarly:"_2xTYa",diamond:"p3X6p",userPanel:"_3cZ8t",email:"bBX3_",link:"_3ko8g",blue:"b4yKe",edc_stripe:"_1wkrp",line:"_2_8JS",not_supported:"kU9B_",site_switcher:"_2KZQq",upgrade:"_1zI1G",def_switcher:"_29_cp",on:"_2JO5i",off:"_3f4Zs",favicon:"sjSDn",hotkeys:"DWDpl",shortcut_title:"rI_db",shortcut:"ynWKZ",summary:"_1cNov",upgrade_title:"_3aOe6"}},23345:e=>{e.exports={line:"NMkwQ",content:"lWYTI",upgrade:"_2GRJe"}},16569:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});const s="chrome-extension://__MSG_@@extension_id__/src/images/d657c003000c65041a4ee3bdff85f8f6/proofreader-review.svg"},58947:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});const s="chrome-extension://__MSG_@@extension_id__/src/images/7d9261bd2b318187ad1c072a261520e4/proofreaders.svg"},80300:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});const s="chrome-extension://__MSG_@@extension_id__/src/images/4c9871d74987ca4155d3df470174f4e3/spinner.svg"}}]);